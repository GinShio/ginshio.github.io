

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Doom Emacs 配置文件 - iris</title><meta name="Description" content="GinShio | GinShio&#39;s Doom Emacs Configuration"><meta property="og:title" content="Doom Emacs 配置文件" />
<meta property="og:description" content="GinShio | GinShio&#39;s Doom Emacs Configuration" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.ginshio.org/2022/doom_emacs_configuration/" /><meta property="og:image" content="https://blog.ginshio.org/avatar.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-08T22:13:23+08:00" />
<meta property="article:modified_time" content="2022-04-30T17:06:59+08:00" /><meta property="og:site_name" content="iris | GinShio的个人博客" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.ginshio.org/avatar.webp"/>

<meta name="twitter:title" content="Doom Emacs 配置文件"/>
<meta name="twitter:description" content="GinShio | GinShio&#39;s Doom Emacs Configuration"/>
<meta name="application-name" content="iris">
<meta name="apple-mobile-web-app-title" content="iris">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.ginshio.org/2022/doom_emacs_configuration/" /><link rel="prev" href="https://blog.ginshio.org/2022/hp_printer_driver/" /><link rel="next" href="https://blog.ginshio.org/2022/compilerprinciple_005/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.1d6e6517c44074bf1c692657d249d106a5e98bb9db25f7773715b24eda7aa575354611c095c23092aa17916f1b5be527.css" integrity="sha384-HW5lF8RAdL8caSZX0knRBqXpi7nbJfd3NxWyTtp6pXU1RhHAlcIwkqoXkW8bW&#43;Un"><link rel="stylesheet" href="/css/color.34e5eb0ed3195c558eb6994b94f6ce01b4d7121bda08365c4f94b70d178301efdb761cb63c963c02c67c45152c3c9498.css" integrity="sha384-NOXrDtMZXFWOtplLlPbOAbTXEhvaCDZcT5S3DReDAe/bdhy2PJY8AsZ8RRUsPJSY"><link rel="stylesheet" href="/css/style.min.71903c93e482438bcb694a21934b32795f3f9dc2c7076dadfa66ca836805f90335eae546d168ddaa1c5de8eda3532d79.css" integrity="sha384-cZA8k&#43;SCQ4vLaUohk0syeV8/ncLHB22t&#43;mbKg2gF&#43;QM16uVG0Wjdqhxd6O2jUy15"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.2cba216129d7b04299cad0e4a8bb0eb317de61d6e2489778de53950bfcb59fa58d01a258c9e2675ffa3c07c058996f2d.css" integrity="sha384-LLohYSnXsEKZytDkqLsOsxfeYdbiSJd43lOVC/y1n6WNAaJYyeJnX/o8B8BYmW8t">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.2cba216129d7b04299cad0e4a8bb0eb317de61d6e2489778de53950bfcb59fa58d01a258c9e2675ffa3c07c058996f2d.css" integrity="sha384-LLohYSnXsEKZytDkqLsOsxfeYdbiSJd43lOVC/y1n6WNAaJYyeJnX/o8B8BYmW8t"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.1aedca555d87f5dfb2038403a5507b55c3b284994056b717774b61123af82b39df6853cb7b4c50272a2757138d6b8642.css" integrity="sha384-Gu3KVV2H9d&#43;yA4QDpVB7VcOyhJlAVrcXd0thEjr4KznfaFPLe0xQJyonVxONa4ZC">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.1aedca555d87f5dfb2038403a5507b55c3b284994056b717774b61123af82b39df6853cb7b4c50272a2757138d6b8642.css" integrity="sha384-Gu3KVV2H9d&#43;yA4QDpVB7VcOyhJlAVrcXd0thEjr4KznfaFPLe0xQJyonVxONa4ZC"></noscript>
    
    
    
    <meta name="google-site-verification" content="fbzw9fQcZyEFrrrUtxLfzYW-qhZ5TMEZKHHSp9NeLBw" /><meta name="msvalidate.01" content="EC9CEC799D42793C414AE7BDB0D0205C" /><meta name="yandex-verification" content="c0b808dd3e49f730" /><meta name="baidu-site-verification" content="code-RhPhu2ccLc" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Doom Emacs 配置文件",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.ginshio.org\/2022\/doom_emacs_configuration\/"
        },"image": ["https:\/\/blog.ginshio.org\/screenshot.png"],"genre": "posts","keywords": "Doom, OrgMode","wordcount":  26348 ,
        "url": "https:\/\/blog.ginshio.org\/2022\/doom_emacs_configuration\/","datePublished": "2022-04-08T22:13:23+08:00","dateModified": "2022-04-30T17:06:59+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "GinShio","logo": "https:\/\/blog.ginshio.org\/avatar.webp"},"authors": [{
                        "@type": "Person",
                        "name": "GinShio"                    
                    }],"description": "GinShio | GinShio's Doom Emacs Configuration"
    }
    </script><script src="//instant.page/5.1.1" defer type="module" integrity="sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme; }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('light' === 'light' || 'light' === 'dark' || 'light' === 'black') setTheme('light'), saveTheme('light'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="iris"><span class="header-title-pre"><i class="fas fa-terminal"></i></span>iris</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class="fa fa-archive faa-wrench"></i> 归档 </a><a class="menu-item" href="/tags/"><i class="fa fa-tag faa-wrench"></i> 标签 </a><a class="menu-item" href="/categories/"><i class="fa fa-folder-open faa-wrench"></i> 分类 </a><a class="menu-item" href="/series/"><i class="fas fa-object-group"></i> 系列 </a><a class="menu-item" href="/about/"><i class="fa fa-info-circle faa-wrench"></i> 关于 </a><a class="menu-item" href="/links/"><i class="fa fa-user-friends faa-wrench"></i> 友人帐 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="iris"><span class="header-title-pre"><i class="fas fa-terminal"></i></span>iris</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title=""><i class="fa fa-archive faa-wrench"></i>归档</a><a class="menu-item" href="/tags/" title=""><i class="fa fa-tag faa-wrench"></i>标签</a><a class="menu-item" href="/categories/" title=""><i class="fa fa-folder-open faa-wrench"></i>分类</a><a class="menu-item" href="/series/" title=""><i class="fas fa-object-group"></i>系列</a><a class="menu-item" href="/about/" title=""><i class="fa fa-info-circle faa-wrench"></i>关于</a><a class="menu-item" href="/links/" title=""><i class="fa fa-user-friends faa-wrench"></i>友人帐</a><a href="#" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#引言">引言</a>
      <ul>
        <li><a href="#why-emacs">Why Emacs</a></li>
        <li><a href="#issues">Issues</a></li>
      </ul>
    </li>
    <li><a href="#基础配置">基础配置</a>
      <ul>
        <li><a href="#设置默认值">设置默认值</a></li>
        <li><a href="#doom-配置">Doom 配置</a>
          <ul>
            <li><a href="#模组">模组</a></li>
            <li><a href="#视觉设置">视觉设置</a></li>
            <li><a href="#辅助宏">辅助宏</a></li>
            <li><a href="#允许-cli-运行-org-babel-程序">允许 CLI 运行 org-babel 程序</a></li>
            <li><a href="#dashboard">dashboard</a></li>
          </ul>
        </li>
        <li><a href="#其他设置">其他设置</a>
          <ul>
            <li><a href="#窗口标题">窗口标题</a></li>
            <li><a href="#启动界面">启动界面</a></li>
            <li><a href="#守护进程">守护进程</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#包">包</a>
      <ul>
        <li><a href="#加载结构">加载结构</a></li>
        <li><a href="#工具">工具</a>
          <ul>
            <li><a href="#缩写">缩写</a></li>
            <li><a href="#hungry-delete">hungry delete</a></li>
            <li><a href="#dired">DIRED</a></li>
            <li><a href="#magit">Magit</a></li>
            <li><a href="#补全">补全</a></li>
            <li><a href="#consult">Consult</a></li>
            <li><a href="#marginalia">Marginalia</a></li>
            <li><a href="#lsp">LSP</a></li>
            <li><a href="#拼写检查">拼写检查</a></li>
            <li><a href="#string-inflection">String Inflection</a></li>
            <li><a href="#tramp">TRAMP</a></li>
            <li><a href="#vterm">VTerm</a></li>
            <li><a href="#yasnippet">YASnippet</a></li>
            <li><a href="#screenshot">Screenshot</a></li>
            <li><a href="#ebooks">Ebooks</a></li>
          </ul>
        </li>
        <li><a href="#ui">UI</a>
          <ul>
            <li><a href="#nyan">Nyan</a></li>
            <li><a href="#eros">Eros</a></li>
            <li><a href="#theme-magic">Theme Magic</a></li>
            <li><a href="#emojify">Emojify</a></li>
            <li><a href="#tabs">Tabs</a></li>
            <li><a href="#treemacs">Treemacs</a></li>
            <li><a href="#hl-todo">hl todo</a></li>
          </ul>
        </li>
        <li><a href="#有趣的生活">有趣的生活</a>
          <ul>
            <li><a href="#xkcd">xkcd</a></li>
            <li><a href="#打字机">打字机</a></li>
            <li><a href="#wakatime">wakatime</a></li>
            <li><a href="#elcord">Elcord</a></li>
            <li><a href="#irc">IRC</a></li>
            <li><a href="#字典">字典</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#编程语言配置">编程语言配置</a>
      <ul>
        <li><a href="#纯文本">纯文本</a></li>
        <li><a href="#org">Org Mode</a>
          <ul>
            <li><a href="#系统设置">系统设置</a></li>
            <li><a href="#功能增强">功能增强</a></li>
            <li><a href="#视觉">视觉</a></li>
            <li><a href="#导出通用设置">导出通用设置</a></li>
            <li><a href="#html-导出">HTML 导出</a></li>
            <li><a href="#latex-导出">LaTeX 导出</a></li>
            <li><a href="#幻灯片导出">幻灯片导出</a></li>
            <li><a href="#ascii-导出">ASCII 导出</a></li>
            <li><a href="#markdown-导出">Markdown 导出</a></li>
            <li><a href="#hugo">Hugo</a></li>
          </ul>
        </li>
        <li><a href="#LaTeX">LaTeX</a>
          <ul>
            <li><a href="#编译">编译</a></li>
            <li><a href="#引用">引用</a></li>
            <li><a href="#视觉">视觉</a></li>
            <li><a href="#fixes">Fixes</a></li>
          </ul>
        </li>
        <li><a href="#markdown">Markdown</a></li>
        <li><a href="#c-plus-plus">C++</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Doom Emacs 配置文件</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><i class="author fas fa-user-circle fa-fw"></i><span class='screen-reader-text'>  </span><a href='https://blog.ginshio.org/authors/ginshio'>GinShio</a></span>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/emacs/"><i class="far fa-folder fa-fw"></i>Emacs</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="04-08">04-08</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="04-30">04-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 26348 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 53 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#引言">引言</a>
      <ul>
        <li><a href="#why-emacs">Why Emacs</a></li>
        <li><a href="#issues">Issues</a></li>
      </ul>
    </li>
    <li><a href="#基础配置">基础配置</a>
      <ul>
        <li><a href="#设置默认值">设置默认值</a></li>
        <li><a href="#doom-配置">Doom 配置</a>
          <ul>
            <li><a href="#模组">模组</a></li>
            <li><a href="#视觉设置">视觉设置</a></li>
            <li><a href="#辅助宏">辅助宏</a></li>
            <li><a href="#允许-cli-运行-org-babel-程序">允许 CLI 运行 org-babel 程序</a></li>
            <li><a href="#dashboard">dashboard</a></li>
          </ul>
        </li>
        <li><a href="#其他设置">其他设置</a>
          <ul>
            <li><a href="#窗口标题">窗口标题</a></li>
            <li><a href="#启动界面">启动界面</a></li>
            <li><a href="#守护进程">守护进程</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#包">包</a>
      <ul>
        <li><a href="#加载结构">加载结构</a></li>
        <li><a href="#工具">工具</a>
          <ul>
            <li><a href="#缩写">缩写</a></li>
            <li><a href="#hungry-delete">hungry delete</a></li>
            <li><a href="#dired">DIRED</a></li>
            <li><a href="#magit">Magit</a></li>
            <li><a href="#补全">补全</a></li>
            <li><a href="#consult">Consult</a></li>
            <li><a href="#marginalia">Marginalia</a></li>
            <li><a href="#lsp">LSP</a></li>
            <li><a href="#拼写检查">拼写检查</a></li>
            <li><a href="#string-inflection">String Inflection</a></li>
            <li><a href="#tramp">TRAMP</a></li>
            <li><a href="#vterm">VTerm</a></li>
            <li><a href="#yasnippet">YASnippet</a></li>
            <li><a href="#screenshot">Screenshot</a></li>
            <li><a href="#ebooks">Ebooks</a></li>
          </ul>
        </li>
        <li><a href="#ui">UI</a>
          <ul>
            <li><a href="#nyan">Nyan</a></li>
            <li><a href="#eros">Eros</a></li>
            <li><a href="#theme-magic">Theme Magic</a></li>
            <li><a href="#emojify">Emojify</a></li>
            <li><a href="#tabs">Tabs</a></li>
            <li><a href="#treemacs">Treemacs</a></li>
            <li><a href="#hl-todo">hl todo</a></li>
          </ul>
        </li>
        <li><a href="#有趣的生活">有趣的生活</a>
          <ul>
            <li><a href="#xkcd">xkcd</a></li>
            <li><a href="#打字机">打字机</a></li>
            <li><a href="#wakatime">wakatime</a></li>
            <li><a href="#elcord">Elcord</a></li>
            <li><a href="#irc">IRC</a></li>
            <li><a href="#字典">字典</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#编程语言配置">编程语言配置</a>
      <ul>
        <li><a href="#纯文本">纯文本</a></li>
        <li><a href="#org">Org Mode</a>
          <ul>
            <li><a href="#系统设置">系统设置</a></li>
            <li><a href="#功能增强">功能增强</a></li>
            <li><a href="#视觉">视觉</a></li>
            <li><a href="#导出通用设置">导出通用设置</a></li>
            <li><a href="#html-导出">HTML 导出</a></li>
            <li><a href="#latex-导出">LaTeX 导出</a></li>
            <li><a href="#幻灯片导出">幻灯片导出</a></li>
            <li><a href="#ascii-导出">ASCII 导出</a></li>
            <li><a href="#markdown-导出">Markdown 导出</a></li>
            <li><a href="#hugo">Hugo</a></li>
          </ul>
        </li>
        <li><a href="#LaTeX">LaTeX</a>
          <ul>
            <li><a href="#编译">编译</a></li>
            <li><a href="#引用">引用</a></li>
            <li><a href="#视觉">视觉</a></li>
            <li><a href="#fixes">Fixes</a></li>
          </ul>
        </li>
        <li><a href="#markdown">Markdown</a></li>
        <li><a href="#c-plus-plus">C++</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition warning open">
                <div class="details-summary admonition-title">
                    <i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i>
                </div>
                <div class="details-content">
                    <div class="admonition-content">
                        本文最后更新于 <span class="timeago" datetime="2022-04-30T17:06:59" title="April 30, 2022">04-30</span>，文中内容可能已过时。</div>
                </div>
            </div><div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>信息<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>本篇是基于 <a href="http://tecosaur.com/" target="_blank" rel="noopener noreferrer">tecosaur</a> 的 <a href="https://github.com/tecosaur/emacs-config" target="_blank" rel="noopener noreferrer">Emacs 配置</a> 大幅缩减版本，如果你对 Org Mode 感兴趣可以看他制作的 <a href="https://blog.tecosaur.com/tmio/" target="_blank" rel="noopener noreferrer">This Month in Org</a>。</p>
<p>本篇标题和副标题均采用原标题的中译</p>
<ul>
<li><strong>Title</strong>: Doom Emacs Configuration</li>
<li><strong>Subtitle</strong>: The Methods, Management, and Menagerie of Madness &mdash; in meticulous detail</li>
</ul>
</div>
        </div>
    </div>
<blockquote>
<p>让我们改变对程序构建的传统态度：与其想象我们的主要任务是指导计算机做什么，不如专注于向人们解释我们想让计算机做什么。
&mdash; 高德纳</p>
</blockquote>
<h2 id="引言" class="headerLink">
    <a href="#%e5%bc%95%e8%a8%80" class="header-mark"></a>引言</h2><p>与其说不喜欢 IDE，倒不如说现在太菜了用不上 IDE，况且 Linux 下除了 JetBrains 家的也没其他能用的了。</p>
<p>不过这都是后话了，最初用的是 <code>Dev-C++</code> 和 <code>VS 2017</code> ，说实话 VS 好看但太大了，对我这种写 <em>Hello World</em> 的人来说太浪费了。其实简单说就是，VS 太大不会用，JetBrains
太贵买不起，虽然是学生可以申请免费全家桶，但 <code>CLion</code> 不像 <em>Intellij IDEA</em> 或者
<em>PyCharm</em> 它没免费版啊。也就尝试着 <code>Notepad++</code> 了，当时并没什么政治倾向。也就当一个自带高亮的记事本， <code>Dev-C++</code> 改用还得用啊。</p>
<p>在用编辑器时听闻了 <code>Vim</code> 、 <code>Linux</code> 等软件，爷投 <code>*nix</code> 了！所以 <code>Notepad++</code> 也用不上了，选来选去选了个 <strong>Emacs</strong> ，多少开始离谱起来了，因为我觉得 Vim 的且模式好麻烦。不过好在这种玩意一招鲜吃遍天，你可以为其添加任意语言的支持，什么 <em>Intellij IDEA</em> 、
<em>PyCharm</em> 还要分，太麻烦了，就问你能加 <code>Erlang</code> 、 <code>Elixir</code> 、 <code>Haskell</code> 等支持吗 (这不巧了吗，还都能加)。况且用 shell 时默认的快捷键也是和 Emacs 一致的。</p>
<p>怎么不用 Vim，因为我不喜欢切换模式啊。所以我现在也不用 <code>evil</code> 或 <a href="https://github.com/meow-edit/meow" target="_blank" rel="noopener noreferrer">meow</a> ，不过很推荐尝试一下 meow。怎么不用 <code>VSCode</code> ，其实当时也没什么 VSCode， <code>Atom</code> 用不用啊，
<code>Sublime</code> 用不用啊。那当然是不用啊，不想再要一个 Chromium 啊，也不想买授权。hhhh</p>
<p>至于 Lisp 会不会啊，那肯定也是不会的啊，就只学会了 <code>New Jersey style</code> 和
<code>The MIT approach</code> 两个名词，干什么用，可以装 B 可以嘲讽你说有用吗。</p>
<h3 id="why-emacs" class="headerLink">
    <a href="#why-emacs" class="header-mark"></a>Why Emacs</h3><p>网上对于 Emacs 的推荐的文章很多，我就不说了，我就一菜鸡。</p>
<p>这里看看 <a href="https://github.com/tecosaur" target="_blank" rel="noopener noreferrer">@tecosaur</a> 对于几个编辑器的比较</p>
<table>
<thead>
<tr>
<th>Editor</th>
<th>Extensibility</th>
<th>Ecosystem</th>
<th>Ease of Use</th>
<th>Comfort</th>
<th>Completion</th>
<th>Performance</th>
</tr>
</thead>
<tbody>
<tr>
<td>IDLE</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>VSCode</td>
<td>3</td>
<td>3</td>
<td>4</td>
<td>3.5</td>
<td>4</td>
<td>3</td>
</tr>
<tr>
<td>Brackets</td>
<td>2.5</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>2.5</td>
<td>2</td>
</tr>
<tr>
<td>Emacs</td>
<td>4</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>3.5</td>
<td>3</td>
</tr>
<tr>
<td>Komodo Edit</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>
<figure class="invertible"><img src="/images/editor-comparison.svg"
         alt="Radar chart comparing my thoughts on a few editors." width="80%"/>
</figure>

<p>这种表有很强的主观印象，不过对于编辑器，还是推荐 VSCode、Emacs 和 Vim。我只是喜欢编辑器在编辑方面极强的扩展优势，对于 Everything (比如 mu4e, EAF)，我的兴趣并不高，或许因为它们又麻烦又没有 FF / Thunderbird 好用？</p>
<p>最后还是要说一下，Emacs 的优势，</p>
<ul>
<li>递归编辑</li>
<li>普遍的文档字符串，以及完全的内省性</li>
<li>在可变环境中的増量修改</li>
<li>无需特定应用启用功能</li>
<li>允许客户端、服务器分离，启动守护进程，提供几乎无感知的启动时间</li>
</ul>
<p>尤其是 <strong>Org-mode</strong> ，全球独此一家！</p>
<h3 id="issues" class="headerLink">
    <a href="#issues" class="header-mark"></a>Issues</h3><ul>
<li>Emacs 有一些令人厌烦的奇怪操作</li>
<li>某些方面很暴露年龄 (名称约定、API 等)</li>
<li>Emacs <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Threads.html" target="_blank" rel="noopener noreferrer">几乎</a> 是单线程的，这意味着一些不当的操作将阻塞整个应用</li>
<li>一些其他方面的干扰……</li>
</ul>
<p>说实话，我是个 Emacs 「低手」，并不是高手。所以 ELisp 有点痛苦，不过还好吧，起码会算 <code>(+ 1 1)</code>。</p>
<h2 id="基础配置" class="headerLink">
    <a href="#%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae" class="header-mark"></a>基础配置</h2><p>创建词法绑定可以 (稍微) 加速配置文件的运行。 (更多内容可以查看 <a href="https://nullprogram.com/blog/2016/12/22/" target="_blank" rel="noopener noreferrer">这篇博客</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; config.el -*- lexical-binding: t; -*-</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>配置有用且基础的个人信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nf">user-full-name</span> <span class="s">&#34;GinShio&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">user-mail-address</span> <span class="s">&#34;ginshio78@gmail.com&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">user-gpg-key</span> <span class="s">&#34;9E2949D214995C7E&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">wakatime-api-key</span> <span class="s">&#34;cb5cccd0-e5a0-4922-abfd-748a42a96cae&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-directory</span> <span class="s">&#34;~/org&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>显然这可以被 GPG 或其他程序使用。</p>
<h3 id="设置默认值" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4%e5%80%bc" class="header-mark"></a>设置默认值</h3><p>尝试一下别人的默认值，比如 <a href="https://github.com/angrybacon/dotemacs/blob/master/dotemacs.org#use-better-defaults" target="_blank" rel="noopener noreferrer">angrybacon/dotemacs</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span>
</span></span><span class="line"><span class="cl"> <span class="nv">delete-by-moving-to-trash</span> <span class="no">t</span>        <span class="c1">; 将文件删除到回收站</span>
</span></span><span class="line"><span class="cl"> <span class="nv">window-combination-resize</span> <span class="no">t</span>        <span class="c1">; 从其他窗口获取新窗口的大小</span>
</span></span><span class="line"><span class="cl"> <span class="nv">x-stretch-cursor</span> <span class="no">t</span>                 <span class="c1">; 将光标拉伸到字形宽度</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">undo-limit</span> <span class="mi">104857600</span>         <span class="c1">; 重置撤销限制到 100 MiB</span>
</span></span><span class="line"><span class="cl">       <span class="nv">auto-save-default</span> <span class="no">t</span>          <span class="c1">; 没有人喜欢丢失工作，我也是如此</span>
</span></span><span class="line"><span class="cl">       <span class="nv">truncate-string-ellipsis</span> <span class="s">&#34;…&#34;</span> <span class="c1">; Unicode 省略号相比 ascii 更好</span>
</span></span><span class="line"><span class="cl">				    <span class="c1">; 同时节省 /宝贵的/ 空间</span>
</span></span><span class="line"><span class="cl">       <span class="nv">password-cache-expiry</span> <span class="no">nil</span>    <span class="c1">; 我能信任我的电脑 ... 或不能?</span>
</span></span><span class="line"><span class="cl">       <span class="c1">; scroll-preserve-screen-position &#39;always</span>
</span></span><span class="line"><span class="cl">				    <span class="c1">; 不要让 `点&#39; (光标) 跳来跳去</span>
</span></span><span class="line"><span class="cl">       <span class="nv">scroll-margin</span> <span class="mi">2</span>              <span class="c1">; 适当保持一点点边距</span>
</span></span><span class="line"><span class="cl">       <span class="nv">gc-cons-threshold</span> <span class="mi">1073741824</span>
</span></span><span class="line"><span class="cl">       <span class="nv">read-process-output-max</span> <span class="mi">1048576</span>
</span></span><span class="line"><span class="cl">       <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;text-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">visual-line-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;text-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">auto-fill-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;window-setup-hook</span> <span class="nf">#&#39;</span><span class="nv">toggle-frame-fullscreen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="c1">; 设置最大化启动</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(display-time-mode t)             ; 开启时间状态栏</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;battery</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">battery-status-function</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">&#34;N/A&#34;</span>
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="nv">battery-format</span> <span class="s">&#34;%B&#34;</span>
</span></span><span class="line"><span class="cl">						<span class="p">(</span><span class="nf">funcall</span> <span class="nv">battery-status-function</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">display-battery-mode</span> <span class="mi">1</span><span class="p">))</span>         <span class="c1">; 知道还剩多少 ⚡️ 很重要</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-subword-mode</span> <span class="mi">1</span><span class="p">)</span>             <span class="c1">; 识别驼峰，而不是傻瓜前进</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-unset-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-z&#34;</span><span class="p">))</span>      <span class="c1">; 关闭 &#34;C-z&#34; 最小化</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define-key!</span> <span class="nv">global-map</span> <span class="s">&#34;C-s&#34;</span> <span class="nf">#&#39;</span><span class="nv">+default/search-buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span> <span class="p">(</span><span class="nb">:leader</span> <span class="p">(</span><span class="nb">:desc</span> <span class="s">&#34;load a saved workspace&#34;</span> <span class="nb">:g</span> <span class="s">&#34;wr&#34;</span> <span class="nf">#&#39;</span><span class="nv">+workspace/load</span><span class="p">)))</span> <span class="c1">;; workspace load keybind</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="nv">IS-WINDOWS</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">buffer-file-coding-system</span> <span class="ss">&#39;utf-8-unix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-default-coding-systems</span> <span class="ss">&#39;utf-8-unix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">prefer-coding-system</span> <span class="ss">&#39;utf-8-unix</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				    <span class="c1">; 将 Windows 上的编码改为 UTF-8 Unix 换行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-variables</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">delete-selection-mode</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; delete when you select region and modify</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&#39;</span><span class="p">(</span><span class="nv">delete-by-moving-to-trash</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; delete &amp;&amp; move to transh</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&#39;</span><span class="p">(</span><span class="nv">inhibit-compacting-font-caches</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; don’t compact font caches during GC.</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&#39;</span><span class="p">(</span><span class="nv">gc-cons-percentage</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;prog-mode-hook</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">show-trailing-whitespace</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">				    <span class="c1">; 编程模式下让结尾的空白符亮起</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义一个自己的 key leader，或许没什么用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">general</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">general-create-definer</span> <span class="nv">ginshio/leader</span> <span class="nb">:prefix</span> <span class="s">&#34;s-y&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况下通过自定义界面所做的修改会被添加到 <code>init.el</code> 中。不过正常的方法是将它们放在 <code>.custom.el</code> 中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">custom-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;.custom.el&#34;</span> <span class="nv">doom-private-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">custom-file</span><span class="p">)</span> <span class="p">(</span><span class="nf">load</span> <span class="nv">custom-file</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置一个方便的在 window 之间进行切换的快捷键。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">ctl-x-map</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;left&gt;&#34;</span>   <span class="nf">#&#39;</span><span class="nv">windmove-left</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;down&gt;&#34;</span>   <span class="nf">#&#39;</span><span class="nv">windmove-down</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;up&gt;&#34;</span>     <span class="nf">#&#39;</span><span class="nv">windmove-up</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;right&gt;&#34;</span>  <span class="nf">#&#39;</span><span class="nv">windmove-right</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果是 evil 用户可以改为下面这种</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">evil-window-map</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;SPC&#34;</span> <span class="nf">#&#39;</span><span class="nv">rotate-layout</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; 方向</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;left&gt;&#34;</span>   <span class="nf">#&#39;</span><span class="nv">evil-window-left</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;down&gt;&#34;</span>   <span class="nf">#&#39;</span><span class="nv">evil-window-down</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;up&gt;&#34;</span>     <span class="nf">#&#39;</span><span class="nv">evil-window-up</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;right&gt;&#34;</span>  <span class="nf">#&#39;</span><span class="nv">evil-window-right</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; 交换窗口</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;C-&lt;left&gt;&#34;</span>   <span class="nf">#&#39;</span><span class="nv">+evil/window-move-left</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;C-&lt;down&gt;&#34;</span>   <span class="nf">#&#39;</span><span class="nv">+evil/window-move-down</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;C-&lt;up&gt;&#34;</span>     <span class="nf">#&#39;</span><span class="nv">+evil/window-move-up</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;C-&lt;right&gt;&#34;</span>  <span class="nf">#&#39;</span><span class="nv">+evil/window-move-right</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="doom-配置" class="headerLink">
    <a href="#doom-%e9%85%8d%e7%bd%ae" class="header-mark"></a>Doom 配置</h3><p>拉取 doom-emacs 仓库的分支</p>
<ul>
<li>git commit: <strong>aed2972d74</strong></li>
<li>doom-version: <strong>3.0.0-dev</strong></li>
<li>doom-modules-version: <strong>21.12.0-dev</strong></li>
</ul>
<h4 id="模组" class="headerLink">
    <a href="#%e6%a8%a1%e7%bb%84" class="header-mark"></a>模组</h4><p><a id="code-snippet--init.el"></a></p>
<div class="highlight" collapsed="t"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; init.el -*- lexical-binding: t; -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; This file controls what Doom modules are enabled and what order they load</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; in. Remember to run &#39;doom sync&#39; after modifying it!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; NOTE Press &#39;SPC h d h&#39; (or &#39;C-h d h&#39; for non-vim users) to access Doom&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;      documentation. There you&#39;ll find a link to Doom&#39;s Module Index where all</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;      of our modules are listed, including what flags they support.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; NOTE Move your cursor over a module&#39;s name (or its flags) and press &#39;K&#39; (or</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;      &#39;C-c c k&#39; for non-vim users) to view its documentation. This works on</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;      flags as well (those symbols that start with a plus).</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;      Alternatively, press &#39;gd&#39; (or &#39;C-c c d&#39;) on a module to browse its</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;      directory (for easy access to its source code).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">doom!</span> <span class="nb">:input</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-input&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:completion</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-completion&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:ui</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-ui&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:editor</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-editor&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:emacs</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-emacs&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:term</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-term&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:checkers</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-checkers&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:tools</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-tools&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:os</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-os&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:lang</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-lang&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:email</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-email&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:app</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-app&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">       <span class="nv">&lt;&lt;doom-config&gt;&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!--list-separator-->
<ul>
<li>
<p>结构</p>
<p>这是一篇文学编程，同时也是 Doom Emacs 的配置文件。Doom 对其支持良好，更多详情可以通过 <code>literate</code> (文学) 模块了解。</p>
<p><a id="code-snippet--doom-config"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="nv">literate</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">default</span> <span class="nv">+bindings</span> <span class="nv">+smartparens</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>接口</p>
<p>可以做很多事来增强 Emacs 的功能，。</p>
<p>输入
: 中日文输入与键盘布局，我主要依赖系统输入法 fcitx 且不输入法语，因此不开此选项
<a id="code-snippet--doom-input"></a>
<code>emacs-lisp ;;chinese ;;japanese ;;layout                     ; auie,ctsrnm is the superior home row </code></p>
<p>补全
: 或许叫补全有点不合适，不过也就这样了。另外说一下， <code>helm</code> 、 <code>ido</code> 、 <code>ivy</code> 以及 <code>vertico</code> 是功能一致的，生态不同的四个包
<a id="code-snippet--doom-completion"></a>
<code>emacs-lisp company             ; the ultimate code completion backend ;;helm              ; the *other* search engine for love and life ;;ido               ; the other *other* search engine... ;;(ivy              ; a search engine for love and life ;; +icons           ; ... icons are nice ;; +prescient)      ; ... I know what I want(ed) (vertico +icons)    ; the search engine of the future </code></p>
<p>UI
: 好不好看就看你这么配置了
<a id="code-snippet--doom-ui"></a>
<code>emacs-lisp ;;deft              ; notational velocity for Emacs doom                ; what makes DOOM look the way it does doom-dashboard      ; a nifty splash screen for Emacs doom-quit           ; DOOM quit-message prompts when you quit Emacs (emoji +unicode +github)  ; 🙂 hl-todo             ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW ;;hydra ;;indent-guides     ; highlighted indent columns (ligatures +extra)  ; ligatures and symbols to make your code pretty again ;;minimap           ; show a map of the code on the side modeline            ; snazzy, Atom-inspired modeline, plus API nav-flash           ; blink cursor line after big motions ;;neotree           ; a project drawer, like NERDTree for vim ophints             ; highlight the region an operation acts on (popup              ; tame sudden yet inevitable temporary windows +all               ; catch all popups that start with an asterix +defaults)         ; default popup rules ;;tabs              ; a tab bar for Emacs treemacs            ; a project drawer, like neotree but cooler ;;unicode           ; extended unicode support for various languages vc-gutter           ; vcs diff in the fringe vi-tilde-fringe     ; fringe tildes to mark beyond EOB (window-select      ; visually switch windows +numbers) workspaces          ; tab emulation, persistence &amp; separate workspaces zen                 ; distraction-free coding or writing </code></p>
<p>编辑器
: <strong>VI VI VI Editor of the Beast</strong>
<a id="code-snippet--doom-editor"></a>
<code>emacs-lisp ;;(evil +everywhere); come to the dark side, we have cookies file-templates      ; auto-snippets for empty files fold                ; (nigh) universal code folding (format +onsave)    ; automated prettiness ;;god               ; run Emacs commands without modifier keys ;;lispy             ; vim for lisp, for people who don't like vim multiple-cursors    ; editing in many places at once ;;objed             ; text object editing for the innocent ;;parinfer          ; turn lisp into python, sort of rotate-text         ; cycle region at point between text candidates snippets            ; my elves. They type so I don't have to ;;word-wrap         ; soft wrapping with language-aware indent </code></p>
<p>Emacs
: 增强一下吧，不然真的是笔记本了 (其实不是
<a id="code-snippet--doom-emacs"></a>
<code>emacs-lisp (dired +icons)      ; making dired pretty [functional] electric            ; smarter, keyword-based electric-indent (ibuffer +icons)    ; interactive buffer management undo                ; persistent, smarter undo for your inevitable mistakes vc                  ; version-control and Emacs, sitting in a tree </code></p>
<p>终端
: 也许我应该卸载掉我的 <code>Konsole</code>
<a id="code-snippet--doom-term"></a>
<code>emacs-lisp ;;eshell            ; the elisp shell that works everywhere ;;shell             ; simple shell REPL for Emacs ;;term              ; basic terminal emulator for Emacs vterm               ; the best terminal emulation in Emacs </code></p>
<p>检测
: 可以告诉我哪里不对，但我觉得我应该先好好背背单词或者看看 PEP8
<a id="code-snippet--doom-checkers"></a>
<code>emacs-lisp syntax              ; tasing you for every semicolon you forget (:if (or (executable-find &quot;hunspell&quot;) (executable-find &quot;aspell&quot;)) spell) ; tasing you for misspelling mispelling ;;grammar           ; tasing grammar mistake every you make </code></p>
<p>工具
: Workflow in Emacs!
<a id="code-snippet--doom-tools"></a>
<code>emacs-lisp ansible biblio              ; Writes a PhD for you (citation needed) (debugger +lsp)     ; FIXME stepping through code, to help you add bugs ;;direnv ;;docker ;;editorconfig      ; let someone else argue about tabs vs spaces ;;ein               ; tame Jupyter notebooks with emacs (eval +overlay)     ; run code, run (also, repls) ;;gist              ; interacting with github gists (lookup             ; helps you navigate your code and documentation +dictionary        ; dictionary/thesaurus is nice +docsets)          ; ...or in Dash docsets locally (lsp +peek)         ; M-x vscode (magit              ; a git porcelain for Emacs +forge)            ; interface with git forges make                ; run make tasks from Emacs ;;pass              ; password manager for nerds pdf                 ; pdf enhancements ;;prodigy           ; FIXME managing external services &amp; code builders rgb                 ; creating color strings ;;taskrunner        ; taskrunner for all your projects ;;terraform         ; infrastructure as code ;;tmux              ; an API for interacting with tmux ;;upload            ; map local to remote projects via ssh/ftp </code></p>
<p>OS
: 有个问题，我会用 MAC 吗
<a id="code-snippet--doom-os"></a>
<code>emacs-lisp (:if IS-MAC macos)  ; improve compatibility with macOS tty                 ; improve the terminal Emacs experience </code></p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>编程语言支持</p>
<p>最爽的事情就是，我可以在 Emacs 中编写任何语言 (的 <code>Hello World</code>)</p>
<p><a id="code-snippet--doom-lang"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;agda              ; types of types of types of types...</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;beancount         ; mind the GAAP</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">cc</span> <span class="nv">+lsp</span><span class="p">)</span>           <span class="c1">; C &gt; C++ == 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;clojure           ; java with a lisp</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;common-lisp       ; if you&#39;ve seen one lisp, you&#39;ve seen them all</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;coq               ; proofs-as-programs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;crystal           ; ruby at the speed of c</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;csharp            ; unity, .NET, and mono shenanigans</span>
</span></span><span class="line"><span class="cl"><span class="nv">data</span>                <span class="c1">; config/data formats</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(dart +flutter)   ; paint ui and not much else</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;dhall</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">elixir</span> <span class="nv">+lsp</span><span class="p">)</span>       <span class="c1">; erlang done right</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;elm               ; care for a cup of TEA?</span>
</span></span><span class="line"><span class="cl"><span class="nv">emacs-lisp</span>          <span class="c1">; drown in parentheses</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">erlang</span> <span class="nv">+lsp</span><span class="p">)</span>       <span class="c1">; an elegant language for a more civilized age</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ess               ; emacs speaks statistics</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;factor</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;faust             ; dsp, but you get to keep your soul</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;fortran           ; in FORTRAN, GOD is REAL (unless declared INTEGER)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;fsharp            ; ML stands for Microsoft&#39;s Language</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;fstar             ; (dependent) types and (monadic) effects and Z3</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;gdscript          ; the language you waited for</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(go +lsp)         ; the hipster dialect</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(haskell +lsp)    ; a language that&#39;s lazier than I am</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;hy                ; readability of scheme w/ speed of python</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;idris             ; a language you can depend on</span>
</span></span><span class="line"><span class="cl"><span class="nv">json</span>                <span class="c1">; At least it ain&#39;t XML</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(java +lsp)       ; the poster child for carpal tunnel syndrome</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">javascript</span> <span class="nv">+lsp</span><span class="p">)</span>   <span class="c1">; all(hope(abandon(ye(who(enter(here))))))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;julia             ; a better, faster MATLAB</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;kotlin            ; a better, slicker Java(Script)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">latex</span>              <span class="c1">; writing papers in Emacs has never been so fun</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+latexmk</span>           <span class="c1">; what else would you use?</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+cdlatex</span>           <span class="c1">; quick maths symbols</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+fold</span><span class="p">)</span>             <span class="c1">; fold the clutter away nicities</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;lean              ; for folks with too much to prove</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ledger            ; be audit you can be</span>
</span></span><span class="line"><span class="cl"><span class="nv">lua</span>                 <span class="c1">; one-based indices? one-based indices</span>
</span></span><span class="line"><span class="cl"><span class="nv">markdown</span>            <span class="c1">; writing docs for people to ignore</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;nim               ; python + lisp at the speed of c</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;nix               ; I hereby declare &#34;nix geht mehr!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;ocaml             ; an objective camel</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">org</span>                <span class="c1">; organize your plain life in plain text</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+pretty</span>            <span class="c1">; yessss my pretties! (nice unicode symbols)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+dragndrop</span>         <span class="c1">; drag &amp; drop files/images into org buffers</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+hugo</span>              <span class="c1">; use Emacs for hugo blogging</span>
</span></span><span class="line"><span class="cl"> <span class="c1">;;+noter           ; enhanced PDF notetaking</span>
</span></span><span class="line"><span class="cl"> <span class="c1">;;+jupyter         ; ipython/jupyter support for babel</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+pandoc</span>            <span class="c1">; export-with-pandoc support</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+gnuplot</span>           <span class="c1">; who doesn&#39;t like pretty pictures</span>
</span></span><span class="line"><span class="cl"> <span class="c1">;;+pomodoro        ; be fruitful with the tomato technique</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+present</span>           <span class="c1">; using org-mode for presentations</span>
</span></span><span class="line"><span class="cl"> <span class="c1">;; +roam2          ; wander around notes</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;php               ; perl&#39;s insecure younger brother</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;plantuml          ; diagrams for confusing people more</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;purescript        ; javascript, but functional</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">python</span>             <span class="c1">; beautiful is better than ugly</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+pyenv</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+lsp</span>
</span></span><span class="line"><span class="cl"> <span class="nv">+pyright</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">qt</span>                  <span class="c1">; the &#39;cutest&#39; gui framework ever</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;racket            ; a DSL for DSLs</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;raku              ; the artist formerly known as perl6</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;rest              ; Emacs as a REST client</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;rst               ; ReST in peace</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(ruby +rails)     ; 1.step {|i| p &#34;Ruby is #{i.even? ? &#39;love&#39; : &#39;life&#39;}&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(rust +lsp)       ; Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;scala             ; java, but good</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(scheme +guile)   ; a fully conniving family of lisps</span>
</span></span><span class="line"><span class="cl"><span class="nv">sh</span>                  <span class="c1">; she sells {ba,z,fi}sh shells on the C xor</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;sml</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;solidity          ; do you need a blockchain? No.</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;swift             ; who asked for emoji variables?</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;terra             ; Earth and Moon in alignment for performance.</span>
</span></span><span class="line"><span class="cl"><span class="nv">web</span>                 <span class="c1">; the tubes</span>
</span></span><span class="line"><span class="cl"><span class="nv">yaml</span>                <span class="c1">; JSON, but readable</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;zig               ; C, but simpler</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>Everything in Emacs</p>
<p><strong>leave</strong> Emacs</p>
<p>邮件
: 说实话，我想用 <code>Thunderbird</code>
<a id="code-snippet--doom-email"></a>
<code>emacs-lisp ;;(mu4e +org +gmail) ;;notmuch ;;(wanderlust +gmail) </code></p>
<p>应用
: 可以在 Emacs 中上网看新闻。或许我可以用 irc 聊天
<a id="code-snippet--doom-app"></a>
<code>emacs-lisp ;;calendar ;;emms everywhere          ; *leave* Emacs!? You must be joking irc                 ; how neckbeards socialize ;;(rss +org)        ; emacs as an RSS reader ;;twitter           ; twitter client https://twitter.com/vnought </code></p>
</li>
</ul>
<h4 id="视觉设置" class="headerLink">
    <a href="#%e8%a7%86%e8%a7%89%e8%ae%be%e7%bd%ae" class="header-mark"></a>视觉设置</h4><!--list-separator-->
<ul>
<li>
<p>字体设置</p>
<p>&lsquo;Source Code Pro&rsquo; 和 &lsquo;Fira Code&rsquo; 的效果都很不错，&lsquo;JetBrains Mono&rsquo; 和 &lsquo;IBM Plex Mono&rsquo;
或许也不错。还是比较推荐 Mono 字体，等宽看代码舒服。</p>
<p>Unicode 字体为什么不试试 &lsquo;JuliaMono&rsquo; 呢？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="s">&#34;Source Code Pro&#34;</span> <span class="nb">:size</span> <span class="mi">15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-big-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="s">&#34;Source Code Pro&#34;</span> <span class="nb">:size</span> <span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-variable-pitch-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="s">&#34;Source Code Variable&#34;</span> <span class="nb">:size</span> <span class="mi">15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-unicode-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="s">&#34;JuliaMono&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nv">doom-serif-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="s">&#34;TeX Gyre Cursor&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>不过这都是西文字体，没有考虑过 CJK 用户的感受吗！！在后面的
<a href="#%e6%9d%82%e9%a1%b9" rel="">杂项</a> 中，将详细说一下 CJK 字体的配置。</p>
<p>除了这些字体外，字体 <a href="https://github.com/SorkinType/Merriweather/" target="_blank" rel="noopener noreferrer">Merriweather</a> 还被用于 <code>nov.el</code> 中，字体 <a href="https://github.com/huertatipografica/Alegreya" target="_blank" rel="noopener noreferrer">Alegreya</a> 作为衬线比例字体被用于 Org 文件的 <code>writeroom-mode</code> 中的 <code>mixed-pitch-mode</code> 。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>主题和 modeline</p>
<p><code>doom-one</code> 是 Doom 自带的大而全的主题，里面实在太多好看的主题了，干嘛还要自己找。这里我想在众多我喜欢的主题中，启动时随机选取一款。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-theme</span> <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">themes</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">doom-vibrant</span>
</span></span><span class="line"><span class="cl">				 <span class="nv">doom-fairy-floss</span>
</span></span><span class="line"><span class="cl">				 <span class="nv">doom-dracula</span>
</span></span><span class="line"><span class="cl">				 <span class="nv">doom-Iosvkem</span>
</span></span><span class="line"><span class="cl">				 <span class="nv">doom-moonlight</span>
</span></span><span class="line"><span class="cl">				 <span class="nv">doom-monokai-pro</span>
</span></span><span class="line"><span class="cl">				 <span class="nv">doom-tokyo-night</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">elt</span> <span class="nv">themes</span> <span class="p">(</span><span class="nf">random</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">themes</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然你不喜欢这样，可以直接指定一款。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-theme</span> <span class="ss">&#39;doom-vibrant</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置一下 modeline，比如说图标、文件名称以及彩虹猫 (Nyan cat)！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">doom-modeline</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">custom-set-variables</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">doom-modeline-buffer-file-name-style</span> <span class="ss">&#39;relative-to-project</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">&#39;</span><span class="p">(</span><span class="nv">doom-modeline-major-mode-icon</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">&#39;</span><span class="p">(</span><span class="nv">doom-modeline-modal-icon</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">nyan-mode</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>杂项</p>
<p>相对行号可以很好的知道距离目标行有多远，然后用快捷键 <code>C-u num &lt;UP&gt;</code> 或
<code>ESC num &lt;UP&gt;</code> 到达你想去的行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">display-line-numbers-type</span> <span class="ss">&#39;relative</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我想设置一下更好看的默认缓冲区名称</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">doom-fallback-buffer-name</span> <span class="s">&#34;► Doom&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">+doom-dashboard-name</span> <span class="s">&#34;► Doom&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>再来说说初始化 doom 时，UI 上其实还有很多能做的，比如说关闭丑的不行的 <code>menu-bar</code> ，设置光标模式，以及 CJK 字体等。</p>
<p>需要说明一下，字体在 GUI 下是有效的，TUI 下使用的应该是终端设置。另外，使用 mono
字体时，CJK 一般是西文字号的 <code>1.2</code> 倍，这样一个 CJK 符号将是西文符号的 <code>2</code> 倍。比较建议西文字体设置为 <code>5</code> 的倍数，这样得到的 CJK 字符都能是一个整数值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ginshio/doom-init-ui-misc</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">menu-bar-mode</span> <span class="mi">-1</span><span class="p">)</span>               <span class="c1">;; disable menu-bar</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">cursor-type</span> <span class="ss">&#39;box</span><span class="p">)</span>  <span class="c1">;; set box style cursor</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">blink-cursor-mode</span> <span class="mi">-1</span><span class="p">)</span>           <span class="c1">;; cursor not blink</span>
</span></span><span class="line"><span class="cl">  <span class="nv">&lt;&lt;doom-dashboard-layout&gt;&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">display-graphic-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">	<span class="c1">;; NOTE: ONLY GUI</span>
</span></span><span class="line"><span class="cl">	<span class="c1">;; set font</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">charset</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">kana</span> <span class="nv">han</span> <span class="nv">symbol</span> <span class="nv">cjk-misc</span> <span class="nv">bopomofo</span> <span class="nv">gb18030</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nf">set-fontset-font</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;font</span><span class="p">)</span> <span class="nv">charset</span>
</span></span><span class="line"><span class="cl">			    <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="s">&#34;Source Han Mono&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">appendq!</span> <span class="nv">face-font-rescale-alist</span>
</span></span><span class="line"><span class="cl">		  <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;Source Han Mono&#34;</span> <span class="o">.</span> <span class="mf">1.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nv">&lt;&lt;doom-image-banner&gt;&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">;; random banner image from bing.com, NOTE: https://emacs-china.org/t/topic/264/33</span>
</span></span><span class="line"><span class="cl">	<span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; NOTE: ONLY TUI</span>
</span></span><span class="line"><span class="cl">      <span class="nv">&lt;&lt;doom-ascii-banner&gt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;doom-init-ui-hook</span> <span class="nf">#&#39;</span><span class="nv">ginshio/doom-init-ui-misc</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="辅助宏" class="headerLink">
    <a href="#%e8%be%85%e5%8a%a9%e5%ae%8f" class="header-mark"></a>辅助宏</h4><p>这些是 doom 添加的一些非常有用的宏</p>
<ul>
<li><code>load!</code> 可以相对于本文件进行外部 <code>.el</code> 文件的加载</li>
<li><code>use-package!</code> 用于配置包</li>
<li><code>add-load-path!</code> 将指定目录添加到 <code>load-path</code> 中，可以让 Emacs 在使用
<code>require</code> 和 <code>use-package</code> 时在 <code>load-path</code> 中进行查找</li>
<li><code>map!</code> 用于绑定新的快捷键</li>
</ul>
<h4 id="允许-cli-运行-org-babel-程序" class="headerLink">
    <a href="#%e5%85%81%e8%ae%b8-cli-%e8%bf%90%e8%a1%8c-org-babel-%e7%a8%8b%e5%ba%8f" class="header-mark"></a>允许 CLI 运行 org-babel 程序</h4><p>在 Org 中有时会写一点代码，<a href="https://orgmode.org/worg/org-contrib/babel" target="_blank" rel="noopener noreferrer">Org-Babel</a> 就是各个语言在 Org-mode 中的巴别塔。大家都可以通过它来直接运行。</p>
<p>但是在配置文件也会有一些代码，如果在 CLI 中执行 <code>doom sync</code> 之类的操作，大量的代码块输出会直接污染输出。这不能忍！</p>
<p>好在 DOOM 提供了每次运行 CLI 前读取 <code>$DOOMDIR/cli.el</code> 的特性，我们可以不再手动确认是否运行某个代码块 (<code>org-confirm-babel-evaluate</code>)，并且用
<code>org-babel-execute-src-block</code> 来沉默这些代码块，避免污染输出。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; cli.el -*- lexical-binding: t; -*-</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-confirm-babel-evaluate</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-babel-execute-src-block</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nv">quiet!</span> <span class="p">(</span><span class="nf">apply</span> <span class="nv">orig-fn</span> <span class="nv">args</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="dashboard" class="headerLink">
    <a href="#dashboard" class="header-mark"></a>dashboard</h4><p>Dashboard 是打开 Emacs 的主页，在这里添加一些常用命令是很舒服的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">+doom-dashboard-mode-map</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;org agenda&#34;</span> <span class="s">&#34;a&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-agenda</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;find file&#34;</span> <span class="s">&#34;f&#34;</span> <span class="nf">#&#39;</span><span class="nv">find-file</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;recent session&#34;</span> <span class="s">&#34;R&#34;</span> <span class="nf">#&#39;</span><span class="nv">doom/quickload-session</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;recent files&#34;</span> <span class="s">&#34;r&#34;</span> <span class="nf">#&#39;</span><span class="nv">counsel-recentf</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;config dir&#34;</span> <span class="s">&#34;C&#34;</span> <span class="nf">#&#39;</span><span class="nv">doom/open-private-config</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;open config.org&#34;</span> <span class="s">&#34;c&#34;</span> <span class="p">(</span><span class="nv">cmd!</span> <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;config.org&#34;</span> <span class="nv">doom-private-dir</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; :desc &#34;open dotfile&#34; &#34;.&#34; (cmd! (doom-project-find-file &#34;~/.config/&#34;))</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;notes (roam)&#34;</span> <span class="s">&#34;n&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-roam-node-find</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;switch buffer&#34;</span> <span class="s">&#34;b&#34;</span> <span class="nf">#&#39;</span><span class="nv">+vertico/switch-workspace-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; :desc &#34;switch buffers (all)&#34; &#34;B&#34; #&#39;consult-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;ibuffer&#34;</span> <span class="s">&#34;i&#34;</span> <span class="nf">#&#39;</span><span class="nv">ibuffer</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;open project&#34;</span> <span class="s">&#34;p&#34;</span> <span class="nf">#&#39;</span><span class="nv">counsel-projectile-switch-project</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; :desc &#34;set theme&#34; &#34;t&#34; #&#39;consult-theme</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;quit&#34;</span> <span class="s">&#34;q&#34;</span> <span class="nf">#&#39;</span><span class="nv">save-buffers-kill-terminal</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;documentation&#34;</span> <span class="s">&#34;H&#34;</span> <span class="nf">#&#39;</span><span class="nv">doom/help</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;show keybindings&#34;</span> <span class="s">&#34;h&#34;</span> <span class="p">(</span><span class="nv">cmd!</span> <span class="p">(</span><span class="nv">which-key-show-major-mode</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>那现在 dashboard 所展示的命令并不是很有用了，移除掉它们</p>
<p><a id="code-snippet--doom-dashboard-layout"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;+doom-dashboard-functions</span>
</span></span><span class="line"><span class="cl">	     <span class="nf">#&#39;</span><span class="nv">doom-dashboard-widget-shortmenu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;+doom-dashboard-mode-hook</span> <span class="p">(</span><span class="nv">hide-mode-line-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">hl-line-mode</span> <span class="mi">1</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="其他设置" class="headerLink">
    <a href="#%e5%85%b6%e4%bb%96%e8%ae%be%e7%bd%ae" class="header-mark"></a>其他设置</h3><h4 id="窗口标题" class="headerLink">
    <a href="#%e7%aa%97%e5%8f%a3%e6%a0%87%e9%a2%98" class="header-mark"></a>窗口标题</h4><p>我更喜欢窗口展示缓冲区的名字，然后是项目文件夹 (如果可用)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">frame-title-format</span>
</span></span><span class="line"><span class="cl">      <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;%b – Doom Emacs&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">:eval</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">project-name</span> <span class="p">(</span><span class="nv">projectile-project-name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;-&#34;</span> <span class="nv">project-name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;  -  [%s]&#34;</span> <span class="nv">project-name</span><span class="p">))))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动界面" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8%e7%95%8c%e9%9d%a2" class="header-mark"></a>启动界面</h4><p><a href="https://github.com/tecosaur" target="_blank" rel="noopener noreferrer">@tecosaur</a> 做了一个相当棒的启动画面，心动！但是太复杂了。我只是想简单的在每次重启时更换 banner，仅此而已。</p>
<p><a id="code-snippet--doom-image-banner"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">fancy-splash-image</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">banners</span> <span class="p">(</span><span class="nf">directory-files</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;banners&#34;</span> <span class="nv">doom-private-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				       <span class="ss">&#39;full</span> <span class="p">(</span><span class="nb">rx</span> <span class="s">&#34;.png&#34;</span> <span class="nv">eos</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">elt</span> <span class="nv">banners</span> <span class="p">(</span><span class="nf">random</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">banners</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，不要忘记 ASCII banner</p>
<p><a id="code-snippet--doom-ascii-banner"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">ginshio/+doom-dashbord-ascii-banner</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">split-string</span> <span class="p">(</span><span class="nb">with-output-to-string</span>
</span></span><span class="line"><span class="cl">		       <span class="p">(</span><span class="nf">call-process</span> <span class="s">&#34;cat&#34;</span> <span class="no">nil</span> <span class="nv">standard-output</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">banners</span> <span class="p">(</span><span class="nf">directory-files</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;banners&#34;</span> <span class="nv">doom-private-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">								     <span class="ss">&#39;full</span> <span class="p">(</span><span class="nb">rx</span> <span class="s">&#34;.txt&#34;</span> <span class="nv">eos</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">				       <span class="p">(</span><span class="nf">elt</span> <span class="nv">banners</span> <span class="p">(</span><span class="nf">random</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">banners</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">		     <span class="s">&#34;\n&#34;</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">+doom-dashboard-ascii-banner-fn</span>
</span></span><span class="line"><span class="cl">       <span class="nf">#&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">mapc</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">propertize</span> <span class="p">(</span><span class="nv">+doom-dashboard--center</span> <span class="nv">+doom-dashboard--width</span> <span class="nv">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				       <span class="ss">&#39;face</span> <span class="ss">&#39;doom-dashboard-banner</span><span class="p">)</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		 <span class="nv">ginshio/+doom-dashbord-ascii-banner</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="守护进程" class="headerLink">
    <a href="#%e5%ae%88%e6%8a%a4%e8%bf%9b%e7%a8%8b" class="header-mark"></a>守护进程</h4><p>守护进程是个好东西，可惜我用的是 WSL，没有 <code>systemd</code> ，不过 <a href="https://www.emacswiki.org/emacs/EmacsAsDaemon" target="_blank" rel="noopener noreferrer">EmacsWiki</a> 中还是列出了各种 Daemon 的方法。</p>
<dl>
<dt>Systemd (Not WSL)</dt>
<dd><code>~/.config/systemd/user/emacs.service</code></dd>
</dl>
<!--listend-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[Unit]
</span></span><span class="line"><span class="cl">Description=Emacs text editor
</span></span><span class="line"><span class="cl">Documentation=info:emacs man:emacs(1) https://gnu.org/software/emacs/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Service]
</span></span><span class="line"><span class="cl">Type=forking
</span></span><span class="line"><span class="cl">ExecStart=/usr/bin/emacs --daemon
</span></span><span class="line"><span class="cl">ExecStop=/usr/bin/emacsclient --no-wait --eval &#34;(progn (setq kill-emacs-hook &#39;nil) (kill-emacs))&#34;
</span></span><span class="line"><span class="cl">Restart=on-failure
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Install]
</span></span><span class="line"><span class="cl">WantedBy=default.target
</span></span></code></pre></td></tr></table>
</div>
</div><dl>
<dt>Launchd (MacOS)</dt>
<dd><code>/Library/LaunchAgents/gnu.emacs.daemon.plist</code></dd>
</dl>
<!--listend-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34;
</span></span><span class="line"><span class="cl">    &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;
</span></span><span class="line"><span class="cl"> &lt;plist version=&#34;1.0&#34;&gt;
</span></span><span class="line"><span class="cl">  &lt;dict&gt;
</span></span><span class="line"><span class="cl">    &lt;key&gt;Label&lt;/key&gt;
</span></span><span class="line"><span class="cl">    &lt;string&gt;gnu.emacs.daemon&lt;/string&gt;
</span></span><span class="line"><span class="cl">    &lt;key&gt;ProgramArguments&lt;/key&gt;
</span></span><span class="line"><span class="cl">    &lt;array&gt;
</span></span><span class="line"><span class="cl">      &lt;string&gt;/Applications/Emacs.app/Contents/MacOS/Emacs&lt;/string&gt;
</span></span><span class="line"><span class="cl">      &lt;string&gt;--daemon&lt;/string&gt;
</span></span><span class="line"><span class="cl">    &lt;/array&gt;
</span></span><span class="line"><span class="cl">    &lt;key&gt;RunAtLoad&lt;/key&gt;
</span></span><span class="line"><span class="cl">    &lt;true/&gt;
</span></span><span class="line"><span class="cl">    &lt;key&gt;ServiceDescription&lt;/key&gt;
</span></span><span class="line"><span class="cl">    &lt;string&gt;Gnu Emacs Daemon&lt;/string&gt;
</span></span><span class="line"><span class="cl">  &lt;/dict&gt;
</span></span><span class="line"><span class="cl"> &lt;/plist&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><dl>
<dt>rc.d (FreeBSD)</dt>
<dd>这来自 FreeBSD 论坛的<a href="https://forums.freebsd.org/threads/rc-d-daemon-as-user-emacs.83055/post-558902" target="_blank" rel="noopener noreferrer">讨论</a> <code>/etc/init.d/emacsd</code>
<a id="code-snippet--emacsdaemon rc.d (freebsd) service"></a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PROVIDE: emacsd</span>
</span></span><span class="line"><span class="cl"><span class="c1"># REQUIRE: LOGIN</span>
</span></span><span class="line"><span class="cl"><span class="c1"># KEYWORD: shutdown</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. /etc/rc.subr
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span><span class="s2">&#34;emacsd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">rcvar</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2">_enable&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">start_precmd</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2">_prestart&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">load_rc_config <span class="nv">$name</span>
</span></span><span class="line"><span class="cl">: <span class="s2">&#34;</span><span class="si">${</span><span class="nv">emacsd_enable</span><span class="p">:=</span><span class="s2">&#34;NO&#34;</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">: <span class="s2">&#34;</span><span class="si">${</span><span class="nv">emacsd_user</span><span class="p">:=</span><span class="s2">&#34;nobody&#34;</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">piddir</span><span class="o">=</span><span class="s2">&#34;/var/run/</span><span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">pidfile</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">piddir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2">_daemon.pid&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">pidfile_child</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">piddir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2">_emacs.pid&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">user_id</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>id -u <span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">emacsd_env=&#34;</span><span class="k">$(</span>env -iL <span class="si">${</span><span class="nv">user_id</span><span class="si">}</span> <span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span>/var/run/user/<span class="si">${</span><span class="nv">user_id</span><span class="si">}</span> <span class="nv">HOME</span><span class="o">=</span>/home/<span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span> <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39; &#39;</span><span class="k">)</span><span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">proc_cmd=&#34;</span>/usr/local/bin/emacs<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">proc_args=&#34;</span>--fg-daemon -u <span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">command=&#34;</span>/usr/sbin/daemon<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">command_args=&#34;</span>-f -P <span class="si">${</span><span class="nv">pidfile</span><span class="si">}</span> -p <span class="si">${</span><span class="nv">pidfile_child</span><span class="si">}</span> -r <span class="si">${</span><span class="nv">proc_cmd</span><span class="si">}</span> <span class="si">${</span><span class="nv">proc_args</span><span class="si">}</span><span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">emacsd_prestart()
</span></span></span><span class="line"><span class="cl"><span class="s2">{
</span></span></span><span class="line"><span class="cl"><span class="s2">    [ -z &#34;</span><span class="si">${</span><span class="nv">XDG_RUNTIME_DIR</span><span class="si">}</span><span class="s2">&#34; ] &amp;&amp; XDG_RUNTIME_DIR=&#34;</span>/var/run/user/<span class="k">$(</span>id -u <span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    ! [ -d &#34;</span><span class="si">${</span><span class="nv">XDG_RUNTIME_DIR</span><span class="si">}</span><span class="s2">&#34; ] &amp;&amp; \
</span></span></span><span class="line"><span class="cl"><span class="s2">    install -d -o &#34;</span><span class="k">$(</span>id -u <span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34; -m 0700 &#34;</span><span class="si">${</span><span class="nv">XDG_RUNTIME_DIR</span><span class="si">}</span><span class="s2">&#34; -
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    ! [ -d &#34;</span><span class="si">${</span><span class="nv">piddir</span><span class="si">}</span><span class="s2">&#34; ] &amp;&amp; \
</span></span></span><span class="line"><span class="cl"><span class="s2">    install -d -o &#34;</span><span class="k">$(</span>id -u <span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34; -g &#34;</span><span class="k">$(</span>id -u <span class="si">${</span><span class="nv">emacsd_user</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34; &#34;</span><span class="si">${</span><span class="nv">piddir</span><span class="si">}</span><span class="s2">&#34; -
</span></span></span><span class="line"><span class="cl"><span class="s2">    return 0
</span></span></span><span class="line"><span class="cl"><span class="s2">}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">run_rc_command &#34;</span><span class="nv">$1</span><span class="s2">&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div></dd>
<dt>rc.d (Linux, Maybe WSL)</dt>
<dd>这是 EmacsWiki 上为 GNU/Debian 创建的 rc.d 脚本，或许 WSL 也能用， <code>/etc/init.d/emacsd</code>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">### BEGIN INIT INFO</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Provides:          emacsd</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Required-Start:    $remote_fs $syslog</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Required-Stop:     $remote_fs $syslog</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Default-Start:     2 3 4 5</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Default-Stop:      0 1 6</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Short-Description: Start emacsd at boot time</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Description:       Enable service provided by daemon.</span>
</span></span><span class="line"><span class="cl"><span class="c1">### END INIT INFO</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Local Settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">PATH</span><span class="o">=</span>/usr/local/bin:/usr/bin:/bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># emacs location.</span>
</span></span><span class="line"><span class="cl"><span class="nv">emacs</span><span class="o">=</span><span class="s2">&#34;emacs&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">emacsclient</span><span class="o">=</span><span class="s2">&#34;emacsclient&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># EE code</span>
</span></span><span class="line"><span class="cl"><span class="nv">EE_EMACS_NOT_FOUND</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">EE_INVALID_OPTION</span><span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="nv">EE_EMACS_FAIL_TO_START</span><span class="o">=</span><span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="nv">EE_EMACS_FAIL_TO_STOP</span><span class="o">=</span><span class="m">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Real code begins here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -z <span class="sb">`</span>which emacs<span class="sb">`</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">    log_daemon_msg <span class="s2">&#34;Error: Emacs not found. emacsd will now exit.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="nv">$EE_EMACS_NOT_FOUND</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># TODO Start emacs as normal user &#34;emacsd&#34; or &#34;daemon&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#emacs run under this uid</span>
</span></span><span class="line"><span class="cl"><span class="nv">emacsd_uid</span><span class="o">=</span><span class="s2">&#34;1000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">socket_file</span><span class="o">=</span><span class="s2">&#34;/tmp/emacs</span><span class="si">${</span><span class="nv">emacsd_uid</span><span class="si">}</span><span class="s2">/server&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">    start<span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">#check whether already started</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="o">[</span> -e <span class="s2">&#34;</span><span class="nv">$socket_file</span><span class="s2">&#34;</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> <span class="s2">&#34;Error: emacsd already started.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="nv">$EE_EMACSD_ALREADY_STARTED</span>
</span></span><span class="line"><span class="cl">	<span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;Start emacs daemon ...&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> sudo -u<span class="s2">&#34;#&#34;</span><span class="nv">$emacsd_uid</span> <span class="nv">$emacs</span> --daemon
</span></span><span class="line"><span class="cl">	<span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> <span class="s2">&#34;emacsd is up.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> <span class="s2">&#34;Error: emacsd failed to start.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="nv">$EE_EMACS_FAIL_TO_START</span>
</span></span><span class="line"><span class="cl">	<span class="k">fi</span>
</span></span><span class="line"><span class="cl">	<span class="p">;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    stop<span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">#options=&#34;-s $socket_file&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nv">options</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nv">lispcode</span><span class="o">=</span><span class="s2">&#34;(kill-emacs)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> sudo -u<span class="s2">&#34;#&#34;</span><span class="nv">$emacsd_uid</span> <span class="nv">$emacsclient</span> <span class="nv">$options</span> --eval <span class="nv">$lispcode</span>
</span></span><span class="line"><span class="cl">	<span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> <span class="s2">&#34;emacsd is down.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> <span class="s2">&#34;Error: emacsd failed to stop.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="nv">$EE_EMACS_FAIL_TO_STOP</span>
</span></span><span class="line"><span class="cl">	<span class="k">fi</span>
</span></span><span class="line"><span class="cl">	<span class="p">;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    restart<span class="p">|</span>force-reload<span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="o">[</span> -e <span class="s2">&#34;</span><span class="nv">$socket_file</span><span class="s2">&#34;</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">$0</span> stop
</span></span><span class="line"><span class="cl">	<span class="k">fi</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$0</span> start
</span></span><span class="line"><span class="cl">	<span class="nb">exit</span> <span class="nv">$?</span>
</span></span><span class="line"><span class="cl">	<span class="p">;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    *<span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;Usage: /etc/init.d/emacsd {start|stop|restart|force-reload}&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> ! <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> <span class="s2">&#34;No such option:&#34;</span> <span class="nv">$*</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="nv">$EE_INVALID_OPTION</span>
</span></span><span class="line"><span class="cl">	<span class="k">fi</span>
</span></span><span class="line"><span class="cl">	<span class="p">;;</span>
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span></code></pre></td></tr></table>
</div>
</div></dd>
</dl>
<p>好了，让其开机启动吧！</p>
<ul>
<li>Systemd (Not WSL)
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl --user <span class="nb">enable</span> emacs.service
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>Launchd (MacOS)
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">launchctl load -w ~/Library/LaunchAgents/gnu.emacs.daemon.plist
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>剩下两个实在不会了。。。</p>
<p>做一个 desktop 文件，可以直接从桌面启动，再添加一些打来文件的默认应用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[Desktop Entry]
</span></span><span class="line"><span class="cl">Name=Emacs client
</span></span><span class="line"><span class="cl">GenericName=Text Editor
</span></span><span class="line"><span class="cl">Comment=A flexible platform for end-user applications
</span></span><span class="line"><span class="cl">MimeType=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
</span></span><span class="line"><span class="cl">Exec=emacsclient -create-frame --alternate-editor=&#34;&#34; --no-wait %F
</span></span><span class="line"><span class="cl">Icon=emacs
</span></span><span class="line"><span class="cl">Type=Application
</span></span><span class="line"><span class="cl">Terminal=false
</span></span><span class="line"><span class="cl">Categories=TextEditor;Utility;
</span></span><span class="line"><span class="cl">StartupWMClass=Emacs
</span></span><span class="line"><span class="cl">Keywords=Text;Editor;
</span></span><span class="line"><span class="cl">X-KDE-StartupNotify=false
</span></span></code></pre></td></tr></table>
</div>
</div><p>emacsclient 似乎不会开始于 dashboard，修复一下这个让我不爽的问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">daemonp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;server-after-make-frame-hook</span> <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="nv">+doom-dashboard-name</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>既然有了 emacsclient，那就抄一下 <a href="https://github.com/tecosaur" target="_blank" rel="noopener noreferrer">@tecosaur</a> 的启动脚本吧</p>
<p><a id="code-snippet--e"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">force_tty</span><span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl"><span class="nv">force_wait</span><span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl"><span class="nv">stdin_mode</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">args</span><span class="o">=()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> :<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">	-t <span class="p">|</span> -nw <span class="p">|</span> --tty<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">force_tty</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">shift</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">	-w <span class="p">|</span> --wait<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">force_wait</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">shift</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">	-m <span class="p">|</span> --mode<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">stdin_mode</span><span class="o">=</span><span class="s2">&#34; (</span><span class="nv">$2</span><span class="s2">-mode)&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">shift</span> <span class="m">2</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">	-h <span class="p">|</span> --help<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">echo</span> -e <span class="s2">&#34;\033[1mUsage: e [-t] [-m MODE] [OPTIONS] FILE [-]\033[0m
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Emacs client convenience wrapper.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">\033[1mOptions:\033[0m
</span></span></span><span class="line"><span class="cl"><span class="s2">\033[0;34m-h, --help\033[0m            Show this message
</span></span></span><span class="line"><span class="cl"><span class="s2">\033[0;34m-t, -nw, --tty\033[0m        Force terminal mode
</span></span></span><span class="line"><span class="cl"><span class="s2">\033[0;34m-w, --wait\033[0m            Don&#39;t supply \033[0;34m--no-wait\033[0m to graphical emacsclient
</span></span></span><span class="line"><span class="cl"><span class="s2">\033[0;34m-\033[0m                     Take \033[0;33mstdin\033[0m (when last argument)
</span></span></span><span class="line"><span class="cl"><span class="s2">\033[0;34m-m MODE, --mode MODE\033[0m  Mode to open \033[0;33mstdin\033[0m with
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Run \033[0;32memacsclient --help\033[0m to see help for the emacsclient.&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">exit</span> <span class="m">0</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">	--*<span class="o">=</span>*<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">set</span> -- <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">1</span><span class="p">%%=*</span><span class="si">}</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">1</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">shift</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">	*<span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$#</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		break<span class="p">;</span> <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">args</span><span class="o">+=(</span><span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">shift</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="si">${#</span><span class="nv">args</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">args</span><span class="p">[-1]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;-&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">unset</span> <span class="s1">&#39;args[-1]&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">TMP</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>mktemp /tmp/emacsstdin-XXX<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    cat &gt; <span class="s2">&#34;</span><span class="nv">$TMP</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">args</span><span class="o">+=(</span>--eval <span class="s2">&#34;(let ((b (generate-new-buffer \&#34;*stdin*\&#34;))) (switch-to-buffer b) (insert-file-contents \&#34;</span><span class="nv">$TMP</span><span class="s2">\&#34;) (delete-file \&#34;</span><span class="nv">$TMP</span><span class="s2">\&#34;)</span><span class="si">${</span><span class="nv">stdin_mode</span><span class="si">}</span><span class="s2">)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$DISPLAY</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">||</span> <span class="nv">$force_tty</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># detect terminals with sneaky 24-bit support</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">{</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$COLORTERM</span><span class="s2">&#34;</span> <span class="o">=</span> truecolor <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$COLORTERM</span><span class="s2">&#34;</span> <span class="o">=</span> 24bit <span class="o">]</span><span class="p">;</span> <span class="o">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	<span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>tput colors 2&gt;/dev/null<span class="k">)</span><span class="s2">&#34;</span> -lt <span class="m">257</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$TERM</span><span class="s2">&#34;</span> <span class="p">|</span> grep -q <span class="s2">&#34;^\w\+-[0-9]&#34;</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">termstub</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">TERM</span><span class="p">%%-*</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">else</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">termstub</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">TERM</span><span class="p">#*-</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> infocmp <span class="s2">&#34;</span><span class="nv">$termstub</span><span class="s2">-direct&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span>1<span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">TERM</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$termstub</span><span class="s2">-direct&#34;</span><span class="p">;</span> <span class="k">else</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">TERM</span><span class="o">=</span><span class="s2">&#34;xterm-direct&#34;</span><span class="p">;</span> <span class="k">fi</span> <span class="c1"># should be fairly safe</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    emacsclient --tty -create-frame --alternate-editor<span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> ! <span class="nv">$force_wait</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nv">args</span><span class="o">+=(</span>--no-wait<span class="o">)</span><span class="p">;</span> <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    emacsclient -create-frame --alternate-editor<span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="包" class="headerLink">
    <a href="#%e5%8c%85" class="header-mark"></a>包</h2><h3 id="加载结构" class="headerLink">
    <a href="#%e5%8a%a0%e8%bd%bd%e7%bb%93%e6%9e%84" class="header-mark"></a>加载结构</h3><p>doom 通过 <code>packages.el</code> 来安装包，非常简单，只需要 <code>package!</code> 就可以安装。需要注意，不应该将该文件编译为字节码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; -*- no-byte-compile: t; -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; $DOOMDIR/packages.el</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>警告</strong>: 不要禁用 <code>~/.emacs.d/core/packages.el</code> 中列出的包。Doom 依赖这些，禁用它们可能出现严重问题。</p>
<ul>
<li>从官方的源 <a href="https://melpa.org/" target="_blank" rel="noopener noreferrer">MELPA</a> / <a href="http://elpa.gnu.org/" target="_blank" rel="noopener noreferrer">GNU ELPA</a> / <a href="https://emacsmirror.net/" target="_blank" rel="noopener noreferrer">emacsmirror</a> 安装
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">some-package</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>关闭某些包
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">some-package</span> <span class="nb">:disable</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>从 Git Repo 安装
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; github</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">github-package</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;username/repo&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; gitlab</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">gitlab-package</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">gitlab</span> <span class="nb">:repo</span> <span class="s">&#34;username/repo&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; other</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">other-package</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="no">nil</span> <span class="nb">:repo</span> <span class="s">&#34;https://example.com/repo&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div>如果 repo 仅中只有某个 / 某些文件是你需要的
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">some-package</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;username/repo&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:files</span> <span class="p">(</span><span class="s">&#34;some-file.el&#34;</span> <span class="s">&#34;src/elisp/*.el&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div>如果需要指定某个 <code>commit</code> 或某个 <code>branch</code>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; commit</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">some-package</span> <span class="nb">:pin</span> <span class="s">&#34;abcdefghijk&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; branch</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">some-package</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:branch</span> <span class="s">&#34;stable&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>使用本地的 repo
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">some-package</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:local-repo</span> <span class="s">&#34;/path/to/repo&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="工具" class="headerLink">
    <a href="#%e5%b7%a5%e5%85%b7" class="header-mark"></a>工具</h3><h4 id="缩写" class="headerLink">
    <a href="#%e7%bc%a9%e5%86%99" class="header-mark"></a>缩写</h4><p>Emacs Stack Exchange 上的<a href="https://emacs.stackexchange.com/questions/45462/use-a-single-abbrev-table-for-multiple-modes/45476#45476" target="_blank" rel="noopener noreferrer">在多种模式下使用统一的缩写表</a>，是一个很好的思路</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;doom-first-buffer-hook</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">defun</span> <span class="nv">+abbrev-file-name</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">abbrev-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">setq</span> <span class="nv">abbrev-file-name</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;abbrev.el&#34;</span> <span class="nv">doom-private-dir</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="hungry-delete" class="headerLink">
    <a href="#hungry-delete" class="header-mark"></a>hungry delete</h4><p>一次 <code>backspace</code> 吃掉所有空白符 (当前光标限定)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">hungry-delete</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;nflath/hungry-delete&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">hungry-delete</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">hungry-delete-chars-to-skip</span> <span class="s">&#34; \t\v&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;after-init-hook</span> <span class="nf">#&#39;</span><span class="nv">global-hungry-delete-mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="dired" class="headerLink">
    <a href="#dired" class="header-mark"></a>DIRED</h4><p>emacs 自带的强大文件管理器，和之后提到的 <a href="#magit" rel="">Magit</a>、<a href="#tramp" rel="">TRAMP</a> 都是 Emacs 的杀手级应用。还出现了很多增强性的包来增加其能力，不过对我来说，稍微修改一下也就够了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">dired</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;dired-async</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;RET&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-find-alternate-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;C&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-async-do-copy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;H&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-async-do-hardlink</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;R&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-async-do-rename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;S&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-async-do-symlink</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;n&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-next-marked-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;p&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-prev-marked-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;=&#34;</span> <span class="nf">#&#39;</span><span class="nv">ginshio/dired-ediff-files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">dired-mode-map</span> <span class="s">&#34;&lt;mouse-2&gt;&#34;</span> <span class="nf">#&#39;</span><span class="nv">dired-mouse-find-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ginshio/dired-ediff-files</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Mark files and ediff in dired mode, you can mark 1, 2 or 3 files and diff.
</span></span></span><span class="line"><span class="cl"><span class="s">see: https://oremacs.com/2017/03/18/dired-ediff/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">files</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	    <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">files</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">file1</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">files</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">file2</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;file: &#34;</span> <span class="p">(</span><span class="nv">dired-dwim-target-directory</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">ediff-files</span> <span class="nv">file1</span> <span class="nv">file2</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	    <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">files</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">file1</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">files</span><span class="p">))</span> <span class="p">(</span><span class="nv">file2</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">files</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">ediff-files</span> <span class="nv">file1</span> <span class="nv">file2</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	    <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">files</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">file1</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">files</span><span class="p">))</span> <span class="p">(</span><span class="nv">file2</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">files</span><span class="p">))</span> <span class="p">(</span><span class="nv">file3</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">files</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">ediff-files3</span> <span class="nv">file1</span> <span class="nv">file2</span> <span class="nv">file3</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;no more than 3 files should be marked&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">define-advice</span> <span class="nv">dired-do-print</span> <span class="p">(</span><span class="nb">:override</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">_</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;show/hide dotfiles in current dired
</span></span></span><span class="line"><span class="cl"><span class="s">see: https://www.emacswiki.org/emacs/DiredOmitMode&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;dired-dotfiles-show-p</span><span class="p">))</span> <span class="nv">dired-dotfiles-show-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">dired-dotfiles-show-p</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">dired-mark-files-regexp</span> <span class="s">&#34;^\\.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">dired-do-kill-lines</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">revert-buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">dired-dotfiles-show-p</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">define-advice</span> <span class="nv">dired-up-directory</span> <span class="p">(</span><span class="nb">:override</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">_</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;goto up directory in this buffer&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">find-alternate-file</span> <span class="s">&#34;..&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">define-advice</span> <span class="nv">dired-do-compress-to</span> <span class="p">(</span><span class="nb">:override</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">_</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Compress selected files and directories to an archive.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">output</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;Compress to: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">command-assoc</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">output</span> <span class="nv">dired-compress-files-alist</span> <span class="ss">&#39;string-match</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">files-str</span> <span class="p">(</span><span class="nf">mapconcat</span> <span class="ss">&#39;identity</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span> <span class="no">t</span><span class="p">)</span> <span class="s">&#34; &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">command-assoc</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;&#34;</span> <span class="nv">files-str</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">command</span> <span class="p">(</span><span class="nv">format-spec</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">command-assoc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="o">`</span><span class="p">((</span><span class="sc">?o</span> <span class="o">.</span> <span class="o">,</span><span class="nv">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="sc">?i</span> <span class="o">.</span> <span class="o">,</span><span class="nv">files-str</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nv">async-start</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">shell-command</span> <span class="nv">command</span><span class="p">))</span> <span class="no">nil</span><span class="p">))))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="magit" class="headerLink">
    <a href="#magit" class="header-mark"></a>Magit</h4><figure><img src="https://imgs.xkcd.com/comics/git.png"/>
</figure>

<p>这应该是 Emacs 的杀手应用之一了，感谢 <a href="https://github.com/tarsius" target="_blank" rel="noopener noreferrer">Jonas</a> 及其他贡献者。</p>
<!--list-separator-->
<ul>
<li>
<p>提交模板</p>
<p>现在并没有完成这部分，处于一种完全不会写提交的状态，以后大概率会增加一个提交模板。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>Delta</p>
<p><a href="https://github.com/dandavison/delta/" target="_blank" rel="noopener noreferrer">Delta</a> 是用 rust 实现的 git diff 语法高亮的工具。该作者还将其挂接到了 magit 的
diff 视图上 (默认不会有语法高亮)。不过这需要 <code>delta</code> 二进制文件，在 cargo 安装显得简单些，不过你也可以选择 <a href="https://github.com/dandavison/delta/releases/latest" target="_blank" rel="noopener noreferrer">GitHub Release</a>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cargo install git-delta
</span></span></code></pre></td></tr></table>
</div>
</div><p>简单地配置它就行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">magit-delta</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;dandavison/magit-delta&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">magit-delta</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">magit</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">magit-mode</span> <span class="o">.</span> <span class="nv">magit-delta-mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>冲突</p>
<p>在 Emacs 中处理冲突也是不错的体验，和或许可以尝试自己制造一点</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">smerge-repeatedly</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Perform smerge actions again and again&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">smerge-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">smerge-transient</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">transient</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">transient-define-prefix</span> <span class="nv">smerge-transient</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">[[</span><span class="s">&#34;Move&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;next&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-next</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="s">&#34;previous&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-prev</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))]</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s">&#34;Keep&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="s">&#34;base&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-keep-base</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;u&#34;</span> <span class="s">&#34;upper&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-keep-upper</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="s">&#34;lower&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-keep-lower</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="s">&#34;all&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-keep-all</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;RET&#34;</span> <span class="s">&#34;current&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-keep-current</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))]</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s">&#34;Diff&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;&lt;&#34;</span> <span class="s">&#34;upper/base&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-diff-base-upper</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;=&#34;</span> <span class="s">&#34;upper/lower&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-diff-upper-lower</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;&gt;&#34;</span> <span class="s">&#34;base/lower&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-diff-base-lower</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;R&#34;</span> <span class="s">&#34;refine&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-refine</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;E&#34;</span> <span class="s">&#34;ediff&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-ediff</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))]</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s">&#34;Other&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;c&#34;</span> <span class="s">&#34;combine&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-combine-with-next</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="s">&#34;resolve&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-resolve</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;k&#34;</span> <span class="s">&#34;kill current&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">smerge-kill-current</span><span class="p">))</span> <span class="p">(</span><span class="nv">smerge-repeatedly</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="s">&#34;quit&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nv">smerge-auto-leave</span><span class="p">)))]]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="补全" class="headerLink">
    <a href="#%e8%a1%a5%e5%85%a8" class="header-mark"></a>补全</h4><p>没有补全怎么写代码，尤其是 <code>Java</code> ！！！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">company</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">company-idle-delay</span> <span class="mf">0.3</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">company-minimum-prefix-length</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">company-show-numbers</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="c1">;; make aborting less annoying.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在改进大多来自 <code>先前选项</code> 的历史记录，所以我们改进以下历史记录。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">history-length</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl">	      <span class="nv">prescient-history-length</span> <span class="mi">1024</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>还有最要紧的事，让待选选项有数字提示，方便直接 <code>Alt+num</code> 选择</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-variables</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">company-show-numbers</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="consult" class="headerLink">
    <a href="#consult" class="header-mark"></a>Consult</h4><h4 id="marginalia" class="headerLink">
    <a href="#marginalia" class="header-mark"></a>Marginalia</h4><p>Doom 下 Marginalia 被调教的不错，如果遇到什么好玩的配置了，可以继续加。</p>
<h4 id="lsp" class="headerLink">
    <a href="#lsp" class="header-mark"></a>LSP</h4><p>这不是老色批！自从 lsp 普及开始，无论配置什么编辑器都不再复杂了。看了一圈
<a href="https://emacs-lsp.github.io/lsp-mode/tutorials/" target="_blank" rel="noopener noreferrer">lsp-mode tutorial</a> 甚至觉得不需要配置什么，估计 doom 也有相应的配置。问题就是，熟悉配置、操作的问题。</p>
<h4 id="拼写检查" class="headerLink">
    <a href="#%e6%8b%bc%e5%86%99%e6%a3%80%e6%9f%a5" class="header-mark"></a>拼写检查</h4><p><code>Ispell</code> 是一个古老的 Unix 拼写检查软件，当然你可以将其当作拼写检查软件的一种代称。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">set-company-backend!</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">(</span><span class="nv">text-mode</span>
</span></span><span class="line"><span class="cl">    <span class="nv">markdown-mode</span>
</span></span><span class="line"><span class="cl">    <span class="nv">gfm-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">(</span><span class="nb">:seperate</span>
</span></span><span class="line"><span class="cl">    <span class="nv">company-ispell</span>
</span></span><span class="line"><span class="cl">    <span class="nv">company-files</span>
</span></span><span class="line"><span class="cl">    <span class="nv">company-yasnippet</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Hunspell 还是 Aspell 都听不错，但是 Aspell 比较式微，故本配置使用的是前者，但是之后的配置是一样的</p>
<p>Hunspell 和 Aspell 都可以从  <a href="http://app.aspell.net/create" target="_blank" rel="noopener noreferrer">SCOWL Custom List / Dicionary Creator</a>
获取一个好用的大词典</p>
<dl>
<dt>size (大小)</dt>
<dd>95 (疯狂)</dd>
<dt>spellings (拼写)</dt>
<dd>英语 (美国) 和 英语 (英国, -ise)</dd>
<dt>spelling variants level (拼写变体等级)</dt>
<dd>0</dd>
<dt>diacritics (变音符号)</dt>
<dd>保留</dd>
<dt>extra lists (额外列表)</dt>
<dd>hacker、罗马数字</dd>
</dl>
<p>如果你用的是 Linux 且不想自己下载了，可以用用下面这个小脚本 (hunspell 不用)</p>
<ul>
<li>Hunspell
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /tmp
</span></span><span class="line"><span class="cl">wget -O <span class="s2">&#34;hunspell-en-custom.zip&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -c <span class="s1">&#39;http://app.aspell.net/create?max_size=95&amp;spelling=US&amp;spelling=GBs&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=tar.gz&amp;download=hunspell&#39;</span>
</span></span><span class="line"><span class="cl">unzip <span class="s2">&#34;hunspell-en-custom.zip&#34;</span>
</span></span><span class="line"><span class="cl">sudo chown root:root en-custom.*
</span></span><span class="line"><span class="cl">sudo mkdir -p /usr/share/hunspell/
</span></span><span class="line"><span class="cl">sudo mv en-custom.<span class="o">{</span>aff,dic<span class="o">}</span> /usr/share/hunspell/
</span></span><span class="line"><span class="cl">sudo ln -s /usr/share/hunspell/en-custom.aff /usr/share/hunspell/en_US.aff
</span></span><span class="line"><span class="cl">sudo ln -s /usr/share/hunspell/en-custom.dic /usr/share/hunspell/en_US.dic
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>Aspell
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /tmp
</span></span><span class="line"><span class="cl">wget -O <span class="s2">&#34;aspell6-en-custom.tar.bz2&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -c <span class="s1">&#39;http://app.aspell.net/create?max_size=95&amp;spelling=US&amp;spelling=GBs&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=tar.gz&amp;download=aspell&#39;</span>
</span></span><span class="line"><span class="cl">tar -xjf <span class="s2">&#34;aspell6-en-custom.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> aspell6-en-custom
</span></span><span class="line"><span class="cl">./configure <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> sudo make install
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>配置一下就能开始用了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">ispell-dictionary</span> <span class="s">&#34;en-custom&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="string-inflection" class="headerLink">
    <a href="#string-inflection" class="header-mark"></a>String Inflection</h4><p><del>变形汽车人！</del> 变形字符串！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">string-inflection</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">string-inflection</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:leader</span> <span class="nb">:prefix</span> <span class="p">(</span><span class="s">&#34;cS&#34;</span> <span class="o">.</span> <span class="s">&#34;naming convention&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;cycle&#34;</span> <span class="s">&#34;~&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-all-cycle</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;toggle&#34;</span> <span class="s">&#34;t&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-toggle</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;CamelCase&#34;</span> <span class="s">&#34;c&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-camelcase</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;downCase&#34;</span> <span class="s">&#34;d&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-lower-camelcase</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;kebab-case&#34;</span> <span class="s">&#34;k&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-kebab-case</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;under_score&#34;</span> <span class="s">&#34;u&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-underscore</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;Upper_Score&#34;</span> <span class="s">&#34;_&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-capital-underscore</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;UP_CASE&#34;</span> <span class="s">&#34;U&#34;</span> <span class="nf">#&#39;</span><span class="nv">string-inflection-upcase</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tramp" class="headerLink">
    <a href="#tramp" class="header-mark"></a>TRAMP</h4><p>关于其他很有用的功能，TRAMP 算一个，它是多协议透明远程访问 (<em>Transparent Remote
Access, Multiple Protocol</em>) 工具。简单说这是简单访问其他主机文件系统的方法。</p>
<p>如果你想使用 <code>ssh-key</code> ，建议开始使用 <code>ssh config</code> ，并用 <code>sshx:</code> 进行 tramp 连接。</p>
<!--list-separator-->
<ul>
<li>
<p>提示区域</p>
<p>不幸的是，TRAMP 对远程连接时 SHELL 的提示格式很挑剔，尝试使用 bash 并放宽松提示区域的识别。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">tramp</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setenv</span> <span class="s">&#34;SHELL&#34;</span> <span class="s">&#34;/bin/bash&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">tramp-shell-prompt-pattern</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;\\(?:^\\|
</span></span></span><span class="line"><span class="cl"><span class="s">\\)[^]#$%&gt;\n]*#?[]#$%&gt;] *\\(\\[[0-9;]*[a-zA-Z] *\\)*&#34;</span><span class="p">))</span>  <span class="c1">;; default + </span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>Guix</p>
<p><a href="https://guix.gnu.org/" target="_blank" rel="noopener noreferrer">Guix</a> 将一些 TRAMP 需要的二进制文件放置在了意想不到的位置。这不是个问题，我们可以手动帮助 TRAMP 找到它们。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">tramp</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">appendq!</span> <span class="nv">tramp-remote-path</span>
</span></span><span class="line"><span class="cl">	    <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;~/.guix-profile/bin&#34;</span> <span class="s">&#34;~/.guix-profile/sbin&#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;/run/current-system/profile/bin&#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;/run/current-system/profile/sbin&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="vterm" class="headerLink">
    <a href="#vterm" class="header-mark"></a>VTerm</h4><blockquote>
<p>As good as terminal emulation gets in Emacs</p>
</blockquote>
<p>VTerm 的安装相对麻烦一些，需要编译一些依赖。当然对于 Unix 用户，用系统库更加方便！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">vterm</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">vterm-module-cmake-args</span> <span class="s">&#34;-DUSE_SYSTEM_LIBVTERM=yes&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="yasnippet" class="headerLink">
    <a href="#yasnippet" class="header-mark"></a>YASnippet</h4><p>snippets 套娃谁用谁知道！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">yas-triggers-in-field</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="screenshot" class="headerLink">
    <a href="#screenshot" class="header-mark"></a>Screenshot</h4><div class="notes">
<p>screenshot 依赖于 <a href="https://imagemagick.org/index.php" target="_blank" rel="noopener noreferrer">ImageMagick</a></p>
</div>
<p>让截图变得轻而易举！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">screenshot</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;tecosaur/screenshot&#34;</span> <span class="nb">:build</span> <span class="p">(</span><span class="nb">:not</span> <span class="nv">compile</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">screenshot</span> <span class="nb">:defer</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.com/tecosaur/screenshot" target="_blank" rel="noopener noreferrer">原项目</a>暂时还没有修复 BUG，并且作者并没有打算添加 TUI 支持。</p>
<h4 id="ebooks" class="headerLink">
    <a href="#ebooks" class="header-mark"></a>Ebooks</h4><p>管理 Ebooks，还在用 <a href="https://calibre-ebook.com/" target="_blank" rel="noopener noreferrer">calibre</a> 吗？试试 Emacs 吧！虽然是 calibre 做后端 hhhhhh</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">calibredb</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>体验一下在 Emacs 中管理 Ebooks 的快乐。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">calibredb</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">calibredb-root-dir</span> <span class="s">&#34;~/library/ebooks&#34;</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">calibredb-db-dir</span> <span class="o">&#39;</span><span class="p">((</span><span class="nf">expand-file-name</span> <span class="s">&#34;metadata.db&#34;</span> <span class="nv">calibredb-root-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">calibredb-library-alist</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;~/library/ebooks&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				   <span class="p">(</span><span class="s">&#34;~/library/papers&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">calibredb-format-all-the-icons</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">calibredb-show-mode-map</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;?&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-entry-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;o&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-find-file</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;O&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-find-file-other-frame</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;V&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-open-file-with-default-tool</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;s&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;e&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-export-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;q&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-entry-quit</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;y&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-yank-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;.&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-open-dired</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="nv">tab</span><span class="p">]</span> <span class="nf">#&#39;</span><span class="nv">calibredb-toggle-view-at-point</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-t&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--tags</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-a&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--author_sort</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-A&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--authors</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-T&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--title</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-c&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--comments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">calibredb-search-mode-map</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="nv">mouse-3</span><span class="p">]</span> <span class="nf">#&#39;</span><span class="nv">calibredb-search-mouse</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;RET&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-find-file</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;?&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;a&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-add</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;A&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-add-dir</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;c&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-clone</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;d&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-remove</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;D&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-remove-marked-items</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;j&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-next-entry</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;k&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-previous-entry</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;l&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-virtual-library-list</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;L&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-library-list</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;n&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-virtual-library-next</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;N&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-library-next</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;p&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-virtual-library-previous</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;P&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-library-previous</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;s&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;S&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-switch-library</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;o&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-find-file</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;O&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-find-file-other-frame</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;v&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-view</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;V&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-open-file-with-default-tool</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;.&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-open-dired</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;y&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-yank-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;b&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-catalog-bib-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;e&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-export-dispatch</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;r&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-search-refresh-and-clear-filter</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;R&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-search-clear-filter</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;q&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-search-quit</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;m&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-mark-and-forward</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;f&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-toggle-favorite-at-point</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;x&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-toggle-archive-at-point</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;h&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-toggle-highlight-at-point</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;u&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-unmark-and-forward</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;i&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-edit-annotation</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;DEL&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-unmark-and-backward</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="nv">backtab</span><span class="p">]</span> <span class="nf">#&#39;</span><span class="nv">calibredb-toggle-view</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="nv">tab</span><span class="p">]</span> <span class="nf">#&#39;</span><span class="nv">calibredb-toggle-view-at-point</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-n&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-show-next-entry</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-p&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-show-previous-entry</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;/&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-search-live-filter</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-t&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--tags</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-a&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--author_sort</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-A&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--authors</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-T&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--title</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-c&#34;</span> <span class="nf">#&#39;</span><span class="nv">calibredb-set-metadata--comments</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>其实建立自己的书库相当快乐，当然在搜索解决方案时还在神社看到了用 calibre
管理本子 (也是相当快乐了 XD)</p>
<!--list-separator-->
<ul>
<li>
<p>cite</p>
<p>自己建立 <code>calibre</code> 最重要的一点就是引用时很方便，作者和 <code>org-ref</code> 梦幻联动了一波，你可以在 org-mode 中引用 calibre 的内容了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-ref</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-ref-get-pdf-filename-function</span> <span class="ss">&#39;org-ref-get-mendeley-filename</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>有些遗憾，虽然 calibre 可以什么都管理，但是 papers 还是用 <code>zotero</code> 吧，毕竟
cite 时 calibre 只能做 book。</p>
<p>当然可以 calibre 建一个 <code>Paper</code> 库，而引用使用 zotero 导出的 <code>bibtex</code> ，也算是一种解决方式。当然享受 <del>calibre</del> <code>calibre-web</code> 带来的管理便利。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>看书</p>
<p>很遗憾 Emacs 支持 pdf 但不支持 <code>epub</code> 之类的格式。如果你想要 emacs 支持这些格式，可以考虑 <code>nov.el</code> ，我觉得 <strong>Okular</strong> 和 <strong>Calibre</strong> 更好！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;;; add into packages.el</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">nov</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">nov</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:mode</span> <span class="p">(</span><span class="s">&#34;\\.epub\\&#39;&#34;</span> <span class="o">.</span> <span class="nv">nov-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">nov-mode-map</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:n</span> <span class="s">&#34;RET&#34;</span> <span class="nf">#&#39;</span><span class="nv">nov-scroll-up</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">doom-modeline-segment--nov-info</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34; &#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">propertize</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;creator</span> <span class="nv">nov-metadata</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="ss">&#39;face</span> <span class="ss">&#39;doom-modeline-project-parent-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34; &#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;title</span> <span class="nv">nov-metadata</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34; &#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">propertize</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%d/%d&#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nf">1+</span> <span class="nv">nov-documents-index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nf">length</span> <span class="nv">nov-documents</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="ss">&#39;face</span> <span class="ss">&#39;doom-modeline-info</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;nov-render-title</span> <span class="nb">:override</span> <span class="nf">#&#39;</span><span class="nv">ignore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">+nov-mode-setup</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">face-remap-add-relative</span> <span class="ss">&#39;variable-pitch</span>
</span></span><span class="line"><span class="cl">			     <span class="nb">:family</span> <span class="s">&#34;Merriweather&#34;</span>
</span></span><span class="line"><span class="cl">			     <span class="nb">:height</span> <span class="mf">1.4</span>
</span></span><span class="line"><span class="cl">			     <span class="nb">:width</span> <span class="ss">&#39;semi-expanded</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">face-remap-add-relative</span> <span class="ss">&#39;default</span> <span class="nb">:height</span> <span class="mf">1.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">line-spacing</span> <span class="mf">0.2</span>
</span></span><span class="line"><span class="cl">		<span class="nv">next-screen-context-lines</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">		<span class="nv">shr-use-colors</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;visual-fill-column</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">visual-fill-column-center-text</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">		<span class="nv">visual-fill-column-width</span> <span class="mi">81</span>
</span></span><span class="line"><span class="cl">		<span class="nv">nov-text-width</span> <span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">visual-fill-column-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">hl-line-mode</span> <span class="mi">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;+lookup-definition-functions</span> <span class="nf">#&#39;</span><span class="nv">+lookup/dictionary-definition</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">mode-line-format</span>
</span></span><span class="line"><span class="cl">		<span class="o">`</span><span class="p">((</span><span class="nb">:eval</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">doom-modeline-segment--workspace-name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nb">:eval</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">doom-modeline-segment--window-number</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nb">:eval</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">doom-modeline-segment--nov-info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		  <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span>
</span></span><span class="line"><span class="cl">		    <span class="s">&#34; %P &#34;</span>
</span></span><span class="line"><span class="cl">		    <span class="ss">&#39;face</span> <span class="ss">&#39;doom-modeline-buffer-minor-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span>
</span></span><span class="line"><span class="cl">		    <span class="s">&#34; &#34;</span>
</span></span><span class="line"><span class="cl">		    <span class="ss">&#39;face</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">doom-modeline--active</span><span class="p">)</span> <span class="ss">&#39;mode-line</span> <span class="ss">&#39;mode-line-inactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="ss">&#39;display</span> <span class="o">`</span><span class="p">((</span><span class="nv">space</span>
</span></span><span class="line"><span class="cl">				<span class="nb">:align-to</span>
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">right</span> <span class="nv">right-fringe</span> <span class="nv">right-margin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				   <span class="o">,</span><span class="p">(</span><span class="nf">*</span> <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">width</span> <span class="p">(</span><span class="nv">doom-modeline--font-width</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">					 <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">width</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					     <span class="p">(</span><span class="nf">/</span> <span class="nv">width</span> <span class="p">(</span><span class="nf">frame-char-width</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">				       <span class="p">(</span><span class="nf">string-width</span>
</span></span><span class="line"><span class="cl">					<span class="p">(</span><span class="nf">format-mode-line</span> <span class="p">(</span><span class="nf">cons</span> <span class="s">&#34;&#34;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:eval</span> <span class="p">(</span><span class="nv">doom-modeline-segment--major-mode</span><span class="p">))))))))))</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nb">:eval</span> <span class="p">(</span><span class="nv">doom-modeline-segment--major-mode</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;nov-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">+nov-mode-setup</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="ui" class="headerLink">
    <a href="#ui" class="header-mark"></a>UI</h3><h4 id="nyan" class="headerLink">
    <a href="#nyan" class="header-mark"></a>Nyan</h4><p>首先添加一下彩虹猫，这不能忘！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">nyan-mode</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;TeMPOraL/nyan-mode&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">nyan-mode</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">nyan-animate-nyancat</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	<span class="nv">nyan-wavy-trail</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	<span class="nv">nyan-cat-face-number</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">	<span class="nv">nyan-bar-length</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">	<span class="nv">nyan-minimum-window-width</span> <span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;doom-modeline-hook</span> <span class="nf">#&#39;</span><span class="nv">nyan-mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="eros" class="headerLink">
    <a href="#eros" class="header-mark"></a>Eros</h4><p>这个包可以修改 emacs lisp 内联执行的视觉效果，让这个结果的前缀更好看一点。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">eros-eval-result-prefix</span> <span class="s">&#34;⟹ &#34;</span><span class="p">)</span> <span class="c1">; default =&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可以用 <code>C-x C-e</code> 来对比一下前后变化</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">+</span> <span class="mi">1</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">*</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="theme-magic" class="headerLink">
    <a href="#theme-magic" class="header-mark"></a>Theme Magic</h4><p>非常神奇的是你可以在 Emacs 中用现有的 Theme，改变终端的 Theme，且 GUI 和 TUI 都可用！作者说 Linux 和 Mac 可用， <code>Windows Terminal</code> + <code>WSL</code> 同样适用，压力来到了纯 Windows 下的 Emacs。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">theme-magic</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个操作使用 <code>pywal</code> ，你可以通过仓库安装它，不过最简单的方式就是 <code>pip</code> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo python3 -m pip install pywal
</span></span></code></pre></td></tr></table>
</div>
</div><p>Theme Magic 提供了一个数字界面，尝试从饱和度、色彩差异来有效的选取八个颜色。然而，它可能会为 light 选择相同的颜色，并不总能够选取最佳颜色。我们可以用 Doom themes
提供的色彩工具来轻松获取合理的配色来生成 light 版本 &mdash; 现在就开始！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">theme-magic</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">+doom-dashboard</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">theme-magic--auto-extract-16-doom-colors</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:override</span> <span class="nf">#&#39;</span><span class="nv">theme-magic--auto-extract-16-colors</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">list</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">face-attribute</span> <span class="ss">&#39;default</span> <span class="nb">:background</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-color</span> <span class="ss">&#39;error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-color</span> <span class="ss">&#39;success</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-color</span> <span class="ss">&#39;type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-color</span> <span class="ss">&#39;keywords</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-color</span> <span class="ss">&#39;constants</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-color</span> <span class="ss">&#39;functions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">face-attribute</span> <span class="ss">&#39;default</span> <span class="nb">:foreground</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">face-attribute</span> <span class="ss">&#39;shadow</span> <span class="nb">:foreground</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-blend</span> <span class="ss">&#39;base8</span> <span class="ss">&#39;error</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-blend</span> <span class="ss">&#39;base8</span> <span class="ss">&#39;success</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-blend</span> <span class="ss">&#39;base8</span> <span class="ss">&#39;type</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-blend</span> <span class="ss">&#39;base8</span> <span class="ss">&#39;keywords</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-blend</span> <span class="ss">&#39;base8</span> <span class="ss">&#39;constants</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">doom-blend</span> <span class="ss">&#39;base8</span> <span class="ss">&#39;functions</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">face-attribute</span> <span class="ss">&#39;default</span> <span class="nb">:foreground</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="emojify" class="headerLink">
    <a href="#emojify" class="header-mark"></a>Emojify</h4><p>OOTB 的 emoji 模块！麻烦的一点是设置的有些默认字符，可能会显示为 emoji。直接从 emoji 表中删除它们 (除了有点暴力)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">emojify-disabled-emojis</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">(</span><span class="c1">;; Org</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;◼&#34;</span> <span class="s">&#34;☑&#34;</span> <span class="s">&#34;☸&#34;</span> <span class="s">&#34;⚙&#34;</span> <span class="s">&#34;⏩&#34;</span> <span class="s">&#34;⏪&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Org Heading</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;✙&#34;</span> <span class="s">&#34;♱&#34;</span> <span class="s">&#34;♰&#34;</span> <span class="s">&#34;☥&#34;</span> <span class="s">&#34;✞&#34;</span> <span class="s">&#34;✟&#34;</span> <span class="s">&#34;✝&#34;</span> <span class="s">&#34;†&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;☰&#34;</span> <span class="s">&#34;☱&#34;</span> <span class="s">&#34;☲&#34;</span> <span class="s">&#34;☳&#34;</span> <span class="s">&#34;☴&#34;</span> <span class="s">&#34;☵&#34;</span> <span class="s">&#34;☶&#34;</span> <span class="s">&#34;☷&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;☿&#34;</span> <span class="s">&#34;♀&#34;</span> <span class="s">&#34;♁&#34;</span> <span class="s">&#34;♂&#34;</span> <span class="s">&#34;♃&#34;</span> <span class="s">&#34;♄&#34;</span> <span class="s">&#34;♅&#34;</span> <span class="s">&#34;♆&#34;</span> <span class="s">&#34;♇&#34;</span> <span class="s">&#34;☽&#34;</span> <span class="s">&#34;☾&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;♈&#34;</span> <span class="s">&#34;♉&#34;</span> <span class="s">&#34;♊&#34;</span> <span class="s">&#34;♋&#34;</span> <span class="s">&#34;♌&#34;</span> <span class="s">&#34;♍&#34;</span> <span class="s">&#34;♎&#34;</span> <span class="s">&#34;♏&#34;</span> <span class="s">&#34;♐&#34;</span> <span class="s">&#34;♑&#34;</span> <span class="s">&#34;♒&#34;</span> <span class="s">&#34;♓&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;♔&#34;</span> <span class="s">&#34;♕&#34;</span> <span class="s">&#34;♖&#34;</span> <span class="s">&#34;♗&#34;</span> <span class="s">&#34;♘&#34;</span> <span class="s">&#34;♙&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;♚&#34;</span> <span class="s">&#34;♛&#34;</span> <span class="s">&#34;♜&#34;</span> <span class="s">&#34;♝&#34;</span> <span class="s">&#34;♞&#34;</span> <span class="s">&#34;♟&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Org Agenda</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;⚡&#34;</span> <span class="s">&#34;↑&#34;</span> <span class="s">&#34;↓&#34;</span> <span class="s">&#34;☕&#34;</span> <span class="s">&#34;❓&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; I just want to see this as text</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;©&#34;</span> <span class="s">&#34;™&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Characters that should never be affected by </span><span class="ss">`emojify-mode&#39;</span><span class="s">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">emojify-delete-from-data</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Ensure </span><span class="ss">`emojify-disabled-emojis&#39;</span><span class="s"> don&#39;t appear in </span><span class="ss">`emojify-emojis&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nf">#&#39;</span><span class="nv">emojify-set-emoji-data</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">emoji</span> <span class="nv">emojify-disabled-emojis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">remhash</span> <span class="nv">emoji</span> <span class="nv">emojify-emojis</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tabs" class="headerLink">
    <a href="#tabs" class="header-mark"></a>Tabs</h4><p>如果你想像现代编辑器一样拥有 tabs，或许你可以考虑一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">centaur-tabs</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">centaur-tabs-group-by-projectile-project</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">centaur-tabs-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">centaur-tabs-style</span> <span class="s">&#34;bar&#34;</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">centaur-tabs-set-icons</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">centaur-tabs-set-modified-marker</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">centaur-tabs-show-navigation-buttons</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">centaur-tabs-gray-out-icons</span> <span class="ss">&#39;buffer</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果想要 tabs 底下显示 <code>bar</code> ，需要开启 <code>x-underline-at-descent-line</code>，但是它在 <code>(after! ...)</code> 中不起作用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">centaur-tabs-set-bar</span> <span class="ss">&#39;under</span>
</span></span><span class="line"><span class="cl">       <span class="nv">x-underline-at-descent-line</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="treemacs" class="headerLink">
    <a href="#treemacs" class="header-mark"></a>Treemacs</h4><p>开启 <code>git-mode</code> 、 <code>follow-mode</code> 和 <code>indent-guide-mode</code> ，体验还是不错</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">treemacs</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">treemacs-indent-guide-mode</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">treemacs-show-hidden-files</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">doom-themes-treemacs-theme</span> <span class="s">&#34;doom-colors&#34;</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">treemacs-file-event-delay</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">treemacs-file-follow-delay</span> <span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">treemacs-follow-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (treemacs-filewatch-mode t)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">treemacs-git-mode</span> <span class="ss">&#39;deferred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">treemacs-hide-gitignored-files-mode</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可能是我的用法不对？ <code>filewatch-mode</code> 总是有问题，在外部修改 (不在 treemacs 中重命名、添加、删除等) 就会有问题，没法更新 tree。需要自己手动折叠一下。</p>
<h4 id="hl-todo" class="headerLink">
    <a href="#hl-todo" class="header-mark"></a>hl todo</h4><p><code>hl-todo</code> 允许你设置一些关键字，这些关键字将高亮并且便于查找。往往用于代码注释中强调某些内容。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-variables</span>
</span></span><span class="line"><span class="cl"> <span class="o">&#39;</span><span class="p">(</span><span class="nv">hl-todo-keyword-faces</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;NOTE&#34;</span> <span class="nv">font-lock-builtin-face</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; needs discussion or further investigation.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;REVIEW&#34;</span> <span class="nv">font-lock-keyword-face</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; review was conducted.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;HACK&#34;</span> <span class="nv">font-lock-variable-name-face</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; workaround a known problem.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;DEPRECATED&#34;</span> <span class="nv">region</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; why it was deprecated and to suggest an alternative.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;XXX+&#34;</span> <span class="nv">font-lock-constant-face</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; warn other programmers of problematic or misguiding code.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;TODO&#34;</span> <span class="nv">font-lock-function-name-face</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; tasks/features to be done.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;FIXME&#34;</span> <span class="nv">font-lock-warning-face</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; problematic or ugly code needing refactoring or cleanup.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;KLUDGE&#34;</span> <span class="nv">font-lock-preprocessor-face</span> <span class="nv">bold</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;BUG&#34;</span> <span class="ne">error</span> <span class="nv">bold</span><span class="p">)</span> <span class="c1">;; a known bug that should be corrected.</span>
</span></span><span class="line"><span class="cl">			   <span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="有趣的生活" class="headerLink">
    <a href="#%e6%9c%89%e8%b6%a3%e7%9a%84%e7%94%9f%e6%b4%bb" class="header-mark"></a>有趣的生活</h3><h4 id="xkcd" class="headerLink">
    <a href="#xkcd" class="header-mark"></a>xkcd</h4><p>也许你看过，但是现在让你看个够。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">xkcd</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">xkcd</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">xkcd-cache-dir</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;xkcd/&#34;</span> <span class="nv">doom-cache-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nv">xkcd-cache-latest</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">xkcd-cache-dir</span> <span class="s">&#34;latest&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">xkcd-cache-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">xkcd-cache-dir</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><img src="https://imgs.xkcd.com/comics/is_it_worth_the_time.png"/>
</figure>

<p>现在让 Org-Mode 可以支持 xkcd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-link-set-parameters</span> <span class="s">&#34;xkcd&#34;</span>
</span></span><span class="line"><span class="cl">			   <span class="nb">:image-data-fun</span> <span class="nf">#&#39;</span><span class="nv">+org-xkcd-image-fn</span>
</span></span><span class="line"><span class="cl">			   <span class="nb">:follow</span> <span class="nf">#&#39;</span><span class="nv">+org-xkcd-open-fn</span>
</span></span><span class="line"><span class="cl">			   <span class="nb">:export</span> <span class="nf">#&#39;</span><span class="nv">+org-xkcd-export</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;;###autoload</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ginshio/xkcd-file-info</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get xkcd image info&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;xkcd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">url</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;https://xkcd.com/%d/info.0.json&#34;</span> <span class="nv">num</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">json-assoc</span> <span class="p">(</span><span class="nv">json-read-from-string</span> <span class="p">(</span><span class="nv">xkcd-get-json</span> <span class="nv">url</span> <span class="nv">num</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="o">`</span><span class="p">(</span><span class="nb">:img</span> <span class="o">,</span><span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;img</span> <span class="nv">json-assoc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:alt</span> <span class="o">,</span><span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;alt</span> <span class="nv">json-assoc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:title</span> <span class="o">,</span><span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;title</span> <span class="nv">json-assoc</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;;###autoload</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+org-xkcd-open-fn</span> <span class="p">(</span><span class="nv">link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">+org-xkcd-image-fn</span> <span class="no">nil</span> <span class="nv">link</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;;###autoload</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+org-xkcd-image-fn</span> <span class="p">(</span><span class="nv">protocol</span> <span class="nv">link</span> <span class="nv">description</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get image data for xkcd num LINK&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">xkcd-info</span> <span class="p">(</span><span class="nv">ginshio/xkcd-file-info</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="nv">link</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">img</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">xkcd-info</span> <span class="nb">:img</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">alt</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">xkcd-info</span> <span class="nb">:alt</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">+org-image-file-data-fn</span> <span class="nv">protocol</span> <span class="p">(</span><span class="nv">xkcd-download</span> <span class="nv">img</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="nv">link</span><span class="p">))</span> <span class="nv">description</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;;###autoload</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+org-xkcd-export</span> <span class="p">(</span><span class="nv">num</span> <span class="nv">desc</span> <span class="nv">backend</span> <span class="nv">_com</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Convert xkcd to html/LaTeX/Markdown form&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">xkcd-info</span> <span class="p">(</span><span class="nv">ginshio/xkcd-file-info</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="nv">num</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">img</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">xkcd-info</span> <span class="nb">:img</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">alt</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">xkcd-info</span> <span class="nb">:alt</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">title</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">xkcd-info</span> <span class="nb">:title</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">xkcd-download</span> <span class="nv">img</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="nv">num</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;hugo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;<figure><img src="%25s"
         alt="%s"/>
</figure>
&#34;</span> <span class="nv">img</span> <span class="p">(</span><span class="nv">subst-char-in-string</span> <span class="sc">?\&#34;</span> <span class="sc">?“</span> <span class="nv">alt</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">((</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;img class=&#39;invertible&#39; src=&#39;%s&#39; title=\&#34;%s\&#34; alt=&#39;%s&#39;&gt;&#34;</span> <span class="nv">img</span> <span class="p">(</span><span class="nv">subst-char-in-string</span> <span class="sc">?\&#34;</span> <span class="sc">?“</span> <span class="nv">alt</span><span class="p">)</span> <span class="nv">title</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">((</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;latex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\begin{figure}[!htb]
</span></span></span><span class="line"><span class="cl"><span class="s">  \\centering
</span></span></span><span class="line"><span class="cl"><span class="s">  \\includegraphics[scale=0.4]{%s}%s
</span></span></span><span class="line"><span class="cl"><span class="s">\\end{figure}&#34;</span> <span class="nv">file</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">desc</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;xkcd:%s&#34;</span> <span class="nv">num</span><span class="p">))</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\n  \\caption*{\\label{xkcd:%s} %s}&#34;</span>
</span></span><span class="line"><span class="cl">			      <span class="nv">num</span>
</span></span><span class="line"><span class="cl">			      <span class="p">(</span><span class="nb">or</span> <span class="nv">desc</span>
</span></span><span class="line"><span class="cl">				  <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\textbf{%s} %s&#34;</span> <span class="nv">title</span> <span class="nv">alt</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">((</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;markdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;![%s](https://xkcd.com/%s)&#34;</span> <span class="p">(</span><span class="nv">subst-char-in-string</span> <span class="sc">?\&#34;</span> <span class="sc">?“</span> <span class="nv">alt</span><span class="p">)</span> <span class="nv">num</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;https://xkcd.com/%s&#34;</span> <span class="nv">num</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="打字机" class="headerLink">
    <a href="#%e6%89%93%e5%ad%97%e6%9c%ba" class="header-mark"></a>打字机</h4><p>或许你想听听打字机的声音，或者让身边人听听。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">selectric-mode</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">selectric-mode</span> <span class="nb">:defer</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然这是需要 <code>aplay</code> 的，如果你没有，可以找一下有没有 <code>alsa</code> 相关内容。但是我的 WSL ？没声？没声！</p>
<h4 id="wakatime" class="headerLink">
    <a href="#wakatime" class="header-mark"></a>wakatime</h4><p>Wakatime 可以帮助你记录在编程语言、编辑器、项目以及操作系统上所用的时间，并在
GitHub / GitLab 同名仓库下展示。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">wakatime-mode</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;wakatime/wakatime-mode&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-wakatime-mode</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="elcord" class="headerLink">
    <a href="#elcord" class="header-mark"></a>Elcord</h4><p>除非你不断告诉身边的每个人，不然你使用 Emacs 的意义是什么？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; (package! elcord)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; (use-package! elcord</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   :commands elcord-mode</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   :config</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (setq elcord-use-major-mode-as-main-icon t))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是国内好像用不上，到时候看看 steam。</p>
<h4 id="irc" class="headerLink">
    <a href="#irc" class="header-mark"></a>IRC</h4><p><code>circe</code> 是 Emacs 的 IRC 客户端 (这个名字+缩写简直太棒了)，还是将人变为怪物的希腊女神
&mdash; 喀耳刻。</p>
<p>还是用前面说的意思吧，用它与那些在线 <del>隐身</del> 的人聊天！</p>
<figure><img src="https://imgs.xkcd.com/comics/team_chat.png"/>
</figure>

<p>或许我们暂时用不上它，先这样吧</p>
<h4 id="字典" class="headerLink">
    <a href="#%e5%ad%97%e5%85%b8" class="header-mark"></a>字典</h4><p>我用了很久也不知道 doom 提供了字典，采用 <code>define-word</code> 和 <a href="https://github.com/gromnitsky/wordnut" target="_blank" rel="noopener noreferrer">wordnut</a> 提供服务，不过离线字典可能更符合本地的要求。</p>
<p>GoldenDict CLI 在 GitHub 上是 <a href="https://github.com/goldendict/goldendict/issues/37" target="_blank" rel="noopener noreferrer">相当好评的问题</a>，开发者已经将其加入 1.5 的待做事项，但 1.5 依旧难产，也许你可以考虑贡献一下。</p>
<p>我的配置也等 GoldenDict 吧。</p>
<h2 id="编程语言配置" class="headerLink">
    <a href="#%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80%e9%85%8d%e7%bd%ae" class="header-mark"></a>编程语言配置</h2><h3 id="纯文本" class="headerLink">
    <a href="#%e7%ba%af%e6%96%87%e6%9c%ac" class="header-mark"></a>纯文本</h3><p>Emacs 可以显示 ANSI 颜色代码。然而，在 Emacs 28 之前，如果不修改缓冲区是不可能做到这一点的，所以让我们以此为基础设置这个块。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">text-mode</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook!</span> <span class="ss">&#39;text-mode-hook</span>
</span></span><span class="line"><span class="cl">	     <span class="c1">;; Apply ANSI color codes</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">with-silent-modifications</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">ansi-color-apply-on-region</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="org" class="headerLink">
    <a href="#org" class="header-mark"></a>Org Mode</h3><p>Org Mode 无疑是 Emacs 的杀手级应用，其扩展能力以及 Emacs 的契合，让它吊打一众标记语言和富文本格式。当然 LaTeX 除外。</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>细粒度控制</th>
<th>上手易用性</th>
<th>语法简单</th>
<th>编辑器支持</th>
<th>集成度</th>
<th>易于参考</th>
<th>多功能性</th>
</tr>
</thead>
<tbody>
<tr>
<td>Word</td>
<td>2</td>
<td>4</td>
<td>4</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>LaTeX</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>3</td>
</tr>
<tr>
<td>Org Mode</td>
<td>4</td>
<td>2</td>
<td>3.5</td>
<td>1</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>Markdown</td>
<td>1</td>
<td>3</td>
<td>3</td>
<td>4</td>
<td>3</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>Markdown + Pandoc</td>
<td>2.5</td>
<td>2.5</td>
<td>2.5</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>除了标记语言 (Markup Language) 的优雅外，Emacs 集成了一场丰富的有趣的功能，比如说对当前任何技术都支持的文学编程。</p>
<p><a id="org-example-block--Literate programming workflow"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">      ╭─╴Code╶─╮            ╭─╴Raw Code╶─▶ Computer
</span></span><span class="line"><span class="cl">Ideas╺┥        ┝━▶ Org Mode╺┥
</span></span><span class="line"><span class="cl">      ╰─╴Text╶─╯            ╰─╴Document╶─▶ People
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 <code>.org</code> 文件可以包含代码块 (不支持 noweb 模板)，这些代码块可以与专用源代码文件纠缠在一起，并通过各种 (可扩展的) 方法编译成文档 (报告、文档、演示文稿等)。这些源块甚至可以创建要包含在文档中的图像或其他内容，或者生成源代码。</p>
<p><a id="org-example-block--Example Org Flowchart"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">                   ╭───────────────────────────────────▶ .pdf ⎫
</span></span><span class="line"><span class="cl">                  pdfLaTeX ▶╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╮                 ⎪
</span></span><span class="line"><span class="cl">                   ╿     ╿                  ┊                 ⎪
</span></span><span class="line"><span class="cl">                   │     ┊                  ┊                 ⎪
</span></span><span class="line"><span class="cl">                 .tex    ┊                  ┊                 ⎪
</span></span><span class="line"><span class="cl">                   ╿     ┊                  ┊                 ⎪
</span></span><span class="line"><span class="cl">                ╭──┴╌╌╮  ┊                  ┊ style.scss      ⎬ Weaving
</span></span><span class="line"><span class="cl">graphc.png ─╮   │  embedded TeX             ┊      ╽          ⎪ (Documents)
</span></span><span class="line"><span class="cl">image.jpeg ─┤ filters   ╿                   ┊    .css         ⎪
</span></span><span class="line"><span class="cl">            ╎     ╿     ┊                   ┊     ▾╎          ⎪
</span></span><span class="line"><span class="cl">figure.png╶─╧─▶ PROJECT.ORG ▶───╴filters╶───╧──────╪──▶ .html ⎪
</span></span><span class="line"><span class="cl">     ╿           ╿┊ ║ │ ╰╌╌╌▷╌╌ embedded html ▶╌╌╌╌╯          ⎪
</span></span><span class="line"><span class="cl">     ├╌╌╌╌╌╌╌▷╌╌╌╯┊ ║ │                                       ⎪
</span></span><span class="line"><span class="cl">    result╶╌╌╌╌╌╮ ┊ ║ ├──────╴filters╶────────────────▶ .txt  ⎪
</span></span><span class="line"><span class="cl">     ┊▴         ┊ ┊ ║ │                                       ⎪
</span></span><span class="line"><span class="cl">    execution   ┊ ┊ ║ ╰──────╴filters╶────────────────▶ .md   ⎭
</span></span><span class="line"><span class="cl">     ┊▴         ┊ ┊ ║
</span></span><span class="line"><span class="cl">    code blocks◀╯ ┊ ╟─────────────────────────────────▶ .c    ⎫
</span></span><span class="line"><span class="cl">     ╰╌╌╌╌◁╌╌╌╌╌╌╌╯ ╟─────────────────────────────────▶ .sh   ⎬ Tangling
</span></span><span class="line"><span class="cl">                    ╟─────────────────────────────────▶ .hs   ⎪ (Code)
</span></span><span class="line"><span class="cl">                    ╙─────────────────────────────────▶ .el   ⎭
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为这部分初始化时相当费时，我们需要将其放在 <code>(after! ...)</code> 中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="nv">&lt;&lt;org-conf&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="系统设置" class="headerLink">
    <a href="#%e7%b3%bb%e7%bb%9f%e8%ae%be%e7%bd%ae" class="header-mark"></a>系统设置</h4><!--list-separator-->
<ul>
<li>
<p>Mime 类型</p>
<p>默认情况下，Org 模式不会被识别为它自己的 MIME 类型，但可以使用以下文件轻松更改。 对于系统范围的更改，请尝试 <code>/usr/share/mime/packages/org.xml</code> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;mime-info</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.freedesktop.org/standards/shared-mime-info&#39;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;mime-type</span> <span class="na">type=</span><span class="s">&#34;text/org&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;comment&gt;</span>Emacs Org-mode File<span class="nt">&lt;/comment&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;glob</span> <span class="na">pattern=</span><span class="s">&#34;*.org&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;alias</span> <span class="na">type=</span><span class="s">&#34;text/org&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/mime-type&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/mime-info&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/commit/a10fb7f2423d5e30b9c4477416ccdc93c4f3849d" target="_blank" rel="noopener noreferrer">Papirus</a> 有一个 <code>text/org</code> 的图标，只需刷新 mime 数据库。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">update-mime-database ~/.local/share/mime
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在设置 emacs 为默认的编辑器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">xdg-mime default emacs.desktop text/org
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>Git diffs</p>
<p>Protesilaos 写了一篇 <a href="https://protesilaos.com/codelog/2021-01-26-git-diff-hunk-elisp-org/" target="_blank" rel="noopener noreferrer">非常有用的文章</a>，他在其中解释了如何将 git diff 块标题更改为比大块上方的直接行更有用的东西 &mdash; 就像父标题一样。</p>
<p>这可以通过首先在 <code>~/.config/git/attributes</code> 中为 git 添加新的差异模式来实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*.org   diff=org
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后为它添加一个正则表达式到 <code>~/.config/git/config</code> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[diff &#34;org&#34;]
</span></span><span class="line"><span class="cl">  xfuncname = &#34;^(\\*+ +.*)$&#34;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="功能增强" class="headerLink">
    <a href="#%e5%8a%9f%e8%83%bd%e5%a2%9e%e5%bc%ba" class="header-mark"></a>功能增强</h4><figure><img src="https://imgs.xkcd.com/comics/automation.png"/>
</figure>

<!--list-separator-->
<ul>
<li>
<p>标题结构</p>
<p>说起标题行，我注意到了一个非常棒的包，它可以浏览并管理标题结构。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">org-ol-tree</span> <span class="nb">:recipe</span> <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;Townk/org-ol-tree&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-ol-tree</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">org-mode-map</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:localleader</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;Outline&#34;</span> <span class="s">&#34;O&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-ol-tree</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>Agenda</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-agenda-dir</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">org-directory</span> <span class="s">&#34;/&#34;</span> <span class="s">&#34;agenda&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-agenda-todo-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;todo.org&#34;</span> <span class="nv">org-agenda-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-agenda-project-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;project.org&#34;</span> <span class="nv">org-agenda-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;urgancy|soon|as soon as possible|at some point|eventually</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-agenda-files</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">org-agenda-todo-file</span>
</span></span><span class="line"><span class="cl">			    <span class="o">,</span><span class="nv">org-agenda-project-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-agenda-skip-scheduled-if-done</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-agenda-skip-deadline-if-done</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-agenda-include-deadlines</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-agenda-block-separator</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-agenda-tags-column</span> <span class="mi">100</span> <span class="c1">;; from testing this seems to be a good value</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-agenda-compact-blocks</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>Capture</p>
<p>开始设置 Org-capture 模板吧，快速记录！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-capture</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ginshio/find-project-tree</span><span class="p">(</span><span class="nv">priority</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;find or create project headline
</span></span></span><span class="line"><span class="cl"><span class="s">https://www.zmonster.me/2018/02/28/org-mode-capture.html&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">hl</span> <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">headlines</span> <span class="p">(</span><span class="nv">org-element-map</span> <span class="p">(</span><span class="nv">org-element-parse-buffer</span> <span class="ss">&#39;headline</span><span class="p">)</span> <span class="ss">&#39;headline</span>
</span></span><span class="line"><span class="cl">				  <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">hl</span><span class="p">)</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:level</span> <span class="nv">hl</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					       <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:title</span> <span class="nv">hl</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nf">completing-read</span> <span class="s">&#34;Project Name: &#34;</span> <span class="nv">headlines</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">re-search-forward</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span> <span class="nv">org-complex-heading-regexp-format</span> <span class="p">(</span><span class="nf">regexp-quote</span> <span class="nv">hl</span><span class="p">))</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nv">point-at-bol</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">/=</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span> <span class="p">(</span><span class="nv">org-end-of-subtree</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;* %s :project:%s:\n:properties:\n:homepage: %s\n:repo: \
</span></span></span><span class="line"><span class="cl"><span class="s">%s\n🔚\n\n** urgancy :urgancy:\n\n** soon 🔜\n\n** as soon as\
</span></span></span><span class="line"><span class="cl"><span class="s"> possible :asap:\n\n** at some point :asp:\n\n** eventually :eventually:\n&#34;</span>
</span></span><span class="line"><span class="cl">			  <span class="nv">hl</span> <span class="nv">hl</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&#34;homepage: &#34;</span><span class="p">)</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&#34;repo: &#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nf">beginning-of-line</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nv">org-up-heading-safe</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">re-search-forward</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">format</span> <span class="nv">org-complex-heading-regexp-format</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nf">regexp-quote</span> <span class="nv">priority</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">save-excursion</span> <span class="p">(</span><span class="nv">org-end-of-subtree</span> <span class="no">t</span> <span class="no">t</span><span class="p">))</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-end-of-subtree</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-capture-dir</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;capture&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-capture-snippet-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;snippets.org&#34;</span> <span class="nv">org-capture-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-capture-comment-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;comments.org&#34;</span> <span class="nv">org-capture-dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-capture-note-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;notes.org&#34;</span> <span class="nv">org-capture-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; http://www.howardism.org/Technical/Emacs/journaling-org.html</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; https://www.zmonster.me/2018/02/28/org-mode-capture.html</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-capture-templates</span>
</span></span><span class="line"><span class="cl">	<span class="o">`</span><span class="p">((</span><span class="s">&#34;c&#34;</span> <span class="s">&#34;Comment&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;cb&#34;</span> <span class="s">&#34;Book&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+weektree</span> <span class="o">,</span><span class="nv">org-capture-comment-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* %^{book} 📖%\\1:\n%?&#34;</span> <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;cm&#34;</span> <span class="s">&#34;Movie&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+weektree</span> <span class="o">,</span><span class="nv">org-capture-comment-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* %^{movie} :movie:%\\1:\n%?&#34;</span> <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;g&#34;</span> <span class="s">&#34;GTD&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;gt&#34;</span> <span class="s">&#34;Todo&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="nv">org-agenda-todo-file</span> <span class="s">&#34;Personal&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* TODO [#%^{priority|A|B|C|D|E}] %^{task}\n  SCHEDULED: %^T DEADLINE: %^T\n:properties:\n🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;gi&#34;</span> <span class="s">&#34;Interview&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-agenda-todo-file</span> <span class="s">&#34;Interview&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* WAIT [#%^{priority|B|A|C|D}] %^{company} - %^{position}\t:%\\2:\nSCHEDULED: %^T DEADLINE: %^T\n:properties:\n:url: %^{link}\n🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:prepend</span> <span class="no">t</span> <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;gd&#34;</span> <span class="s">&#34;Daily&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-agenda-todo-file</span> <span class="s">&#34;Daily&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* TODO [#%^{priority|C|A|B|D|E}] %^{task}\n SCHEDULED:  %&lt;&lt;%Y-%m-%d %a %H:%M ++1d&gt;&gt;\n:properties:\n🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;gw&#34;</span> <span class="s">&#34;Weekly&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-agenda-todo-file</span> <span class="s">&#34;Weekly&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* TODO [#%^{priority|B|A|C|D|E}] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M ++1w&gt;&gt;\n:properties:\n🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;gm&#34;</span> <span class="s">&#34;Monthly&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-agenda-todo-file</span> <span class="s">&#34;Monthly&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* TODO [#%^{priority|C|A|B|D|E}] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M ++1m&gt;&gt;\n:properties:\n🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;Note&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;nc&#34;</span> <span class="s">&#34;Computer&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-capture-note-file</span> <span class="s">&#34;Computer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* %^{heading} %^g\n%?\n&#34;</span> <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;ne&#34;</span> <span class="s">&#34;Emacs&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-capture-note-file</span> <span class="s">&#34;Emacs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* %^{heading} %^g\n%?\n&#34;</span> <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;ng&#34;</span> <span class="s">&#34;Game&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file+headline</span> <span class="o">,</span><span class="nv">org-capture-note-file</span> <span class="s">&#34;Game&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* %^{heading} %^g\n%?\n&#34;</span> <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;; (&#34;p&#34; &#34;Project&#34;)</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;; (&#34;pa&#34; &#34;Urgance&#34; entry (file+function ,org-agenda-project-file</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;                                      (lambda () (ginshio/find-project-tree &#34;urgancy&#34;)))</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  &#34;*** TODO [#A] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M&gt;&gt; DEADLINE: %^T\n    :properties:\n    🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  :empty-lines 1)</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;; (&#34;pb&#34; &#34;Soon&#34; entry (file+function ,org-agenda-project-file</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;                                   (lambda () (ginshio/find-project-tree &#34;soon&#34;)))</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  &#34;*** TODO [#B] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M&gt;&gt; DEADLINE: %^T\n    :properties:\n    🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  :empty-lines 1)</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;; (&#34;pc&#34; &#34;As Soon As Possiple&#34; entry (file+function ,org-agenda-project-file</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;                                                  (lambda () (ginshio/find-project-tree &#34;as soon as possiple&#34;)))</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  &#34;*** TODO [#C] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M&gt;&gt; DEADLINE: %^T\n    :properties:\n    🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  :empty-lines 1)</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;; (&#34;pd&#34; &#34;At Some Point&#34; entry (file+function ,org-agenda-project-file</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;                                            (lambda () (ginshio/find-project-tree &#34;at some point&#34;)))</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  &#34;*** TODO [#D] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M&gt;&gt; DEADLINE: %^T\n    :properties:\n    🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  :empty-lines 1)</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;; (&#34;pe&#34; &#34;Eventually&#34; entry (file+function ,org-agenda-project-file</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;                                         (lambda () (ginshio/find-project-tree &#34;eventually&#34;)))</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  &#34;*** TODO [#E] %^{task}\n SCHEDULED: %&lt;&lt;%Y-%m-%d %a %H:%M&gt;&gt; DEADLINE: %^T\n    :properties:\n    🔚\n%?&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="c1">;;  :empty-lines 1)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="s">&#34;Code Snippet&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="nv">org-capture-snippet-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;* %^{heading} :code:%\\2:\n:properties:\n:language: %^{language}\n🔚\n\n#+begin_src %\\2\n%?\n#+end_src&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="nb">:empty-lines</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>修改默认值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-use-property-inheritance</span> <span class="no">t</span>         <span class="c1">; it&#39;s convenient to have properties inherited</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-log-done</span> <span class="ss">&#39;time</span>                     <span class="c1">; having the time a item is done sounds convenient</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-list-allow-alphabetical</span> <span class="no">t</span>          <span class="c1">; have a. A. a) A) list bullets</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-export-in-background</span> <span class="no">t</span>             <span class="c1">; run export processes in external emacs process</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-catch-invisible-edits</span> <span class="ss">&#39;smart</span>       <span class="c1">; try not to accidently do weird stuff in invisible regions</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-export-with-sub-superscripts</span> <span class="ss">&#39;{}</span><span class="p">)</span>  <span class="c1">; don&#39;t treat lone _ / ^ as sub/superscripts, require _{} / ^{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>零宽度工具</p>
<p>偶尔在用 Org 是你希望将两个分开的块放在一起，这点有点烦人。比如将加<strong>重</strong>一个单词的一部分，或者说在内联源码块之前放一些符号。有一个可以解决的方法 &mdash; 零宽空格。由于这是 Emacs，我们可以为 org-mode 做一个很小的改动将其添加到快捷键上 🙂。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">org-mode-map</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:desc</span> <span class="s">&#34;zero-width-space&#34;</span> <span class="s">&#34;C-c SPC&#34;</span> <span class="p">(</span><span class="nv">cmd!</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\u200B&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>不过在导出时，我并不想要它，加一个简单的过滤器将其过滤掉。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+org-export-remove-zero-width-space</span> <span class="p">(</span><span class="nv">text</span> <span class="nv">_backend</span> <span class="nv">_info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Remove zero width spaces from TEXT.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="ss">&#39;org</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;\u200B&#34;</span> <span class="s">&#34;&#34;</span> <span class="nv">text</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-export-filter-final-output-functions</span> <span class="nf">#&#39;</span><span class="nv">+org-export-remove-zero-width-space</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>引用</p>
<p>偶尔会引用某些东西，当然还有之前的 <code>calibre</code> 。设置一下，让 <code>org</code> 、 <code>LaTeX</code> 以及 <code>markdown</code> 可以使用 citar。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">citar</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="p">(</span><span class="nb">:any</span> <span class="nv">org</span> <span class="nv">TeX</span> <span class="nv">markdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">citar-symbols</span>
</span></span><span class="line"><span class="cl">	 <span class="o">`</span><span class="p">((</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nv">all-the-icons-faicon</span> <span class="s">&#34;file-o&#34;</span> <span class="nb">:face</span> <span class="ss">&#39;all-the-icons-green</span> <span class="nb">:v-adjust</span> <span class="mf">-0.1</span><span class="p">)</span> <span class="o">.</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">note</span> <span class="o">,</span><span class="p">(</span><span class="nv">all-the-icons-material</span> <span class="s">&#34;speaker_notes&#34;</span> <span class="nb">:face</span> <span class="ss">&#39;all-the-icons-blue</span> <span class="nb">:v-adjust</span> <span class="mf">-0.3</span><span class="p">)</span> <span class="o">.</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">link</span> <span class="o">,</span><span class="p">(</span><span class="nv">all-the-icons-octicon</span> <span class="s">&#34;link&#34;</span> <span class="nb">:face</span> <span class="ss">&#39;all-the-icons-orange</span> <span class="nb">:v-adjust</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">.</span> <span class="s">&#34; &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">citar-symbol-separator</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="p">(</span><span class="nv">org-mode-map</span> <span class="nv">TeX-mode-map</span> <span class="nv">markdown-mode-map</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;C-c b&#34;</span> <span class="nf">#&#39;</span><span class="nv">citar-insert-citation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">minibuffer-local-map</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;M-b&#34;</span> <span class="nf">#&#39;</span><span class="nv">citar-insert-preset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (org-cite-global-bibliography &#39;(&#34;~/library/ebooks/catalog.bib&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;                                 &#34;~/library/papers/catalog.bib&#34;))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-cite-insert-processor</span> <span class="ss">&#39;citar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-cite-follow-processor</span> <span class="ss">&#39;citar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-cite-activate-processor</span> <span class="ss">&#39;citar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">citar-bibliography</span> <span class="nv">org-cite-global-bibliography</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;citar-major-mode-functions</span>
</span></span><span class="line"><span class="cl">	       <span class="o">&#39;</span><span class="p">((</span><span class="nv">gfm-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">insert-keys</span> <span class="o">.</span> <span class="nv">citar-markdown-insert-keys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">insert-citation</span> <span class="o">.</span> <span class="nv">citar-markdown-insert-citation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">insert-edit</span> <span class="o">.</span> <span class="nv">citar-markdown-insert-edit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">key-at-point</span> <span class="o">.</span> <span class="nv">citar-markdown-key-at-point</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">citation-at-point</span> <span class="o">.</span> <span class="nv">citar-markdown-citation-at-point</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">list-keys</span> <span class="o">.</span> <span class="nv">citar-markdown-list-keys</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>主要为了引用的灵活性，这里并没有设置全局 bib，如果想在 Org 里引用某些 bib 文件可以采用以下方法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#+bibliography: ~/library/ebooks/catalog.bib
</span></span><span class="line"><span class="cl">#+bibliography: ~/library/papers/catalog.bib
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然这配置很简单，只不过功能很强大，关于 <code>org-cite</code> 和 <code>citar</code> 要学的还有很多。可以看看 <a href="https://blog.tecosaur.com/tmio/2021-07-31-citations.html" target="_blank" rel="noopener noreferrer">这篇</a>。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>TOC</p>
<p>生成目录的需求并不大，但是像 <code>GitHub</code> 的环境下 TOC 可能成为必要，采用 <code>toc-org</code>
来生成。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">toc-org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="p">(</span><span class="nb">:any</span> <span class="nv">org</span> <span class="nv">markdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">toc-org-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook!</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-mode-hook</span> <span class="nv">markdown-mode-hook</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">toc-org-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">org-mode-map</span> <span class="s">&#34;C-c C-i&#34;</span> <span class="nf">#&#39;</span><span class="nv">toc-org-insert-toc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">define-key!</span> <span class="nv">markdown-mode-map</span> <span class="s">&#34;C-c M-t&#34;</span> <span class="nf">#&#39;</span><span class="nv">toc-org-insert-toc</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>toc-org</code> 会清空带有 <code>TOC</code> 标签的 heading，并生成目录。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>加密</p>
<p><code>org-crypt</code> 可以用 <code>GPG</code> 加密 Org Mode 的某些 heading，当然是带有 <code>crypt</code> 标签的。现在来设置一下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-crypt</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-crypt-key</span> <span class="nv">user-gpg-key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-tags-exclude-from-inheritance</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;crypt&#34;</span><span class="p">))</span> <span class="c1">;; avoid repeated encryption</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-crypt-use-before-save-magic</span><span class="p">)</span> <span class="c1">;; encrypt when writing back to the hard disk</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">org-mode-map</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:leader</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;org-encrypt&#34;</span> <span class="s">&#34;C&#34;</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;encrypt current&#34;</span> <span class="s">&#34;C e&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-encrypt-entry</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;encrypt all&#34;</span> <span class="s">&#34;C E&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-encrypt-entries</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;decrypt current&#34;</span> <span class="s">&#34;C d&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-decrypt-entry</span>
</span></span><span class="line"><span class="cl">	<span class="nb">:desc</span> <span class="s">&#34;decrypt all&#34;</span> <span class="s">&#34;C D&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-decrypt-entries</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果想用其他密钥加密，可以设置 <code>cryptkey</code> 属性。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">* Totally secret :crypt:
</span></span><span class="line"><span class="cl">:properties:
</span></span><span class="line"><span class="cl">:cryptkey: 0x0123456789012345678901234567890123456789
</span></span><span class="line"><span class="cl">🔚
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="视觉" class="headerLink">
    <a href="#%e8%a7%86%e8%a7%89" class="header-mark"></a>视觉</h4><!--list-separator-->
<ul>
<li>
<p>符号</p>
<p>更改用于折叠项目的字符也很好 (默认情况下 <code>…</code>)，我认为用 <code>▾</code> 更适合指示 「折叠部分」。并在默认的四个列表中添加一个额外的 <code>org-bullet</code> 。对了，别忘记优先级也要修改。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-superstar</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-superstar-headline-bullets-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;♇&#34;</span> <span class="s">&#34;♆&#34;</span> <span class="s">&#34;♅&#34;</span> <span class="s">&#34;♄&#34;</span> <span class="s">&#34;♃&#34;</span> <span class="s">&#34;♂&#34;</span> <span class="s">&#34;♀&#34;</span> <span class="s">&#34;☿&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="nv">org-superstar-prettify-item-bullets</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-fancy-priorities</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">custom-set-variables</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-lowest-priority</span> <span class="sc">?E</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-fancy-priorities-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;⚡&#34;</span> <span class="s">&#34;↑&#34;</span> <span class="s">&#34;↓&#34;</span> <span class="s">&#34;☕&#34;</span> <span class="s">&#34;❓&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-ellipsis</span> <span class="s">&#34; ▾ &#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-hide-leading-stars</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-priority-highest</span> <span class="sc">?A</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-priority-lowest</span> <span class="sc">?E</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-priority-faces</span>
</span></span><span class="line"><span class="cl">       <span class="o">&#39;</span><span class="p">((</span><span class="sc">?A</span> <span class="o">.</span> <span class="ss">&#39;all-the-icons-red</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="sc">?B</span> <span class="o">.</span> <span class="ss">&#39;all-the-icons-orange</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="sc">?C</span> <span class="o">.</span> <span class="ss">&#39;all-the-icons-yellow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="sc">?D</span> <span class="o">.</span> <span class="ss">&#39;all-the-icons-green</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="sc">?E</span> <span class="o">.</span> <span class="ss">&#39;all-the-icons-blue</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>将 Unicode 字符用于复选框和其他命令也很好。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">appendq!</span> <span class="nv">+ligatures-extra-symbols</span>
</span></span><span class="line"><span class="cl">	  <span class="o">`</span><span class="p">(</span><span class="nb">:checkbox</span>      <span class="s">&#34;☐&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:pending</span>       <span class="s">&#34;◼&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:checkedbox</span>    <span class="s">&#34;☑&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:list_property</span> <span class="s">&#34;∷&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:em_dash</span>       <span class="s">&#34;—&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:ellipses</span>      <span class="s">&#34;…&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:arrow_right</span>   <span class="s">&#34;→&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:arrow_left</span>    <span class="s">&#34;←&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:title</span>         <span class="s">&#34;𝙏&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:subtitle</span>      <span class="s">&#34;𝙩&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:author</span>        <span class="s">&#34;𝘼&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:date</span>          <span class="s">&#34;𝘿&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:property</span>      <span class="s">&#34;☸&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:options</span>       <span class="s">&#34;⌥&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:startup</span>       <span class="s">&#34;⏻&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:macro</span>         <span class="s">&#34;𝓜&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:html_head</span>     <span class="s">&#34;🅷&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:html</span>          <span class="s">&#34;🅗&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:latex_class</span>   <span class="s">&#34;🄻&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:latex_header</span>  <span class="s">&#34;🅻&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:beamer_header</span> <span class="s">&#34;🅑&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:latex</span>         <span class="s">&#34;🅛&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:attr_latex</span>    <span class="s">&#34;🄛&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:attr_html</span>     <span class="s">&#34;🄗&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:attr_org</span>      <span class="s">&#34;⒪&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:begin_quote</span>   <span class="s">&#34;❝&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:end_quote</span>     <span class="s">&#34;❞&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:caption</span>       <span class="s">&#34;☰&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:header</span>        <span class="s">&#34;›&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:results</span>       <span class="s">&#34;🠶&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:begin_export</span>  <span class="s">&#34;⏩&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:end_export</span>    <span class="s">&#34;⏪&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:properties</span>    <span class="s">&#34;⚙&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:end</span>           <span class="s">&#34;∎&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:priority_a</span>   <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;⚑&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;all-the-icons-red</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:priority_b</span>   <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;⬆&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;all-the-icons-orange</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:priority_c</span>   <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;■&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;all-the-icons-yellow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:priority_d</span>   <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;⬇&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;all-the-icons-green</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nb">:priority_e</span>   <span class="o">,</span><span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;❓&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;all-the-icons-blue</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">set-ligatures!</span> <span class="ss">&#39;org-mode</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:merge</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:checkbox</span>      <span class="s">&#34;[ ]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:pending</span>       <span class="s">&#34;[-]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:checkedbox</span>    <span class="s">&#34;[X]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:list_property</span> <span class="s">&#34;::&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:em_dash</span>       <span class="s">&#34;---&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ellipsis</span>      <span class="s">&#34;...&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:arrow_right</span>   <span class="s">&#34;-&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:arrow_left</span>    <span class="s">&#34;&lt;-&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:title</span>         <span class="s">&#34;#+title:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:subtitle</span>      <span class="s">&#34;#+subtitle:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:author</span>        <span class="s">&#34;#+author:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:date</span>          <span class="s">&#34;#+date:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:property</span>      <span class="s">&#34;#+property:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:options</span>       <span class="s">&#34;#+options:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:startup</span>       <span class="s">&#34;#+startup:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:macro</span>         <span class="s">&#34;#+macro:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:html_head</span>     <span class="s">&#34;#+html_head:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:html</span>          <span class="s">&#34;#+html:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:latex_class</span>   <span class="s">&#34;#+latex_class:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:latex_header</span>  <span class="s">&#34;#+latex_header:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:beamer_header</span> <span class="s">&#34;#+beamer_header:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:latex</span>         <span class="s">&#34;#+latex:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:attr_latex</span>    <span class="s">&#34;#+attr_latex:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:attr_html</span>     <span class="s">&#34;#+attr_html:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:attr_org</span>      <span class="s">&#34;#+attr_org:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:begin_quote</span>   <span class="s">&#34;#+begin_quote&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:end_quote</span>     <span class="s">&#34;#+end_quote&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:caption</span>       <span class="s">&#34;#+caption:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:header</span>        <span class="s">&#34;#+header:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:begin_export</span>  <span class="s">&#34;#+begin_export&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:end_export</span>    <span class="s">&#34;#+end_export&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:results</span>       <span class="s">&#34;#+RESULTS:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:property</span>      <span class="s">&#34;:PROPERTIES:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:end</span>           <span class="s">&#34;:END:&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:priority_a</span>    <span class="s">&#34;[#A]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:priority_b</span>    <span class="s">&#34;[#B]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:priority_c</span>    <span class="s">&#34;[#C]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:priority_d</span>    <span class="s">&#34;[#D]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:priority_e</span>    <span class="s">&#34;[#E]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">plist-put</span> <span class="nv">+ligatures-extra-symbols</span> <span class="nb">:name</span> <span class="s">&#34;⁍&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>LaTeX 片段</p>
<p>让公式稍稍好看一点点</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-highlight-latex-and-related</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">native</span> <span class="nv">script</span> <span class="nv">entities</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>理想情况下 <code>org-src-font-lock-fontify-block</code> 不会添加 <code>org-block</code> ，但我们可以通过添加带有 <code>:inherit default</code> 面来避免整个功能，这将覆盖背景颜色。</p>
<p>检查 <code>org-do-latex-and-related</code> 显示 <code>&quot;latex&quot;</code> 是传递的语言参数，因此我们可以如上所述覆盖背景。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-src-block-faces</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;latex&#34;</span> <span class="p">(</span><span class="nb">:inherit</span> <span class="nv">default</span> <span class="nb">:extend</span> <span class="no">t</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>比语法高亮的 LaTeX 更好的是 <em>呈现</em> LaTeX，我们可以使用 <code>org-fragtog</code> 自动执行此操作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package!</span> <span class="nv">org-fragtog</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">use-package!</span> <span class="nv">org-fragtog</span> <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="nv">org-fragtog-mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>自定义 LaTeX 片段的外观很舒适，这样它们就更适合文本了 &mdash; 比如这个
\(\sqrt{\beta^2+3}-\sum_{\phi=1}^\infty \frac{x^\phi-1}{\Gamma(a)}\) 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-preview-latex-default-process</span> <span class="ss">&#39;dvisvgm</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-preview-latex-process-alist</span>
</span></span><span class="line"><span class="cl">       <span class="o">&#39;</span><span class="p">((</span><span class="nv">dvipng</span> <span class="nb">:programs</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="s">&#34;lualatex&#34;</span> <span class="s">&#34;dvipng&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="nb">:description</span> <span class="s">&#34;dvi &gt; png&#34;</span> <span class="nb">:message</span> <span class="s">&#34;you need to install the programs: latex and dvipng.&#34;</span> <span class="nb">:image-input-type</span> <span class="s">&#34;dvi&#34;</span> <span class="nb">:image-output-type</span> <span class="s">&#34;png&#34;</span> <span class="nb">:image-size-adjust</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="mf">1.0</span> <span class="o">.</span> <span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="nb">:latex-compiler</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="s">&#34;lualatex -output-format dvi -interaction nonstopmode -output-directory %o %f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="nb">:image-converter</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="s">&#34;dvipng -D %D -T tight -bg Transparent -o %O %f&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">dvisvgm</span> <span class="nb">:programs</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="s">&#34;latex&#34;</span> <span class="s">&#34;dvisvgm&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">:description</span> <span class="s">&#34;dvi &gt; svg&#34;</span> <span class="nb">:message</span> <span class="s">&#34;you need to install the programs: latex and dvisvgm.&#34;</span> <span class="nb">:use-xcolor</span> <span class="no">t</span> <span class="nb">:image-input-type</span> <span class="s">&#34;xdv&#34;</span> <span class="nb">:image-output-type</span> <span class="s">&#34;svg&#34;</span> <span class="nb">:image-size-adjust</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="mf">1.7</span> <span class="o">.</span> <span class="mf">1.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">:latex-compiler</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="s">&#34;xelatex -no-pdf -interaction nonstopmode -output-directory %o %f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">:image-converter</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="s">&#34;dvisvgm %f -n -b min -c %S -o %O&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">imagemagick</span> <span class="nb">:programs</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="s">&#34;latex&#34;</span> <span class="s">&#34;convert&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		      <span class="nb">:description</span> <span class="s">&#34;pdf &gt; png&#34;</span> <span class="nb">:message</span> <span class="s">&#34;you need to install the programs: latex and imagemagick.&#34;</span> <span class="nb">:use-xcolor</span> <span class="no">t</span> <span class="nb">:image-input-type</span> <span class="s">&#34;pdf&#34;</span> <span class="nb">:image-output-type</span> <span class="s">&#34;png&#34;</span> <span class="nb">:image-size-adjust</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="mf">1.0</span> <span class="o">.</span> <span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		      <span class="nb">:latex-compiler</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="s">&#34;xelatex -no-pdf -interaction nonstopmode -output-directory %o %f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		      <span class="nb">:image-converter</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="s">&#34;convert -density %D -trim -antialias %f -quality 100 %O&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-format-latex-header</span> <span class="s">&#34;\\documentclass{article}
</span></span></span><span class="line"><span class="cl"><span class="s">\\usepackage[usenames]{xcolor}
</span></span></span><span class="line"><span class="cl"><span class="s">\\usepackage[T1]{fontenc}
</span></span></span><span class="line"><span class="cl"><span class="s">\\usepackage{booktabs}
</span></span></span><span class="line"><span class="cl"><span class="s">\\pagestyle{empty}             % do not remove
</span></span></span><span class="line"><span class="cl"><span class="s">% The settings below are copied from fullpage.sty
</span></span></span><span class="line"><span class="cl"><span class="s">\\setlength{\\textwidth}{\\paperwidth}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\textwidth}{-3cm}
</span></span></span><span class="line"><span class="cl"><span class="s">\\setlength{\\oddsidemargin}{1.5cm}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\oddsidemargin}{-2.54cm}
</span></span></span><span class="line"><span class="cl"><span class="s">\\setlength{\\evensidemargin}{\\oddsidemargin}
</span></span></span><span class="line"><span class="cl"><span class="s">\\setlength{\\textheight}{\\paperheight}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\textheight}{-\\headheight}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\textheight}{-\\headsep}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\textheight}{-\\footskip}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\textheight}{-3cm}
</span></span></span><span class="line"><span class="cl"><span class="s">\\setlength{\\topmargin}{1.5cm}
</span></span></span><span class="line"><span class="cl"><span class="s">\\addtolength{\\topmargin}{-2.54cm}
</span></span></span><span class="line"><span class="cl"><span class="s">\\usepackage{amsmath,amsxtra,mathtools,upgreek,extarrows}
</span></span></span><span class="line"><span class="cl"><span class="s">\\usepackage{arev}
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-format-latex-options</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">plist-put</span> <span class="nv">org-format-latex-options</span> <span class="nb">:background</span> <span class="s">&#34;Transparent&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="导出通用设置" class="headerLink">
    <a href="#%e5%af%bc%e5%87%ba%e9%80%9a%e7%94%a8%e8%ae%be%e7%bd%ae" class="header-mark"></a>导出通用设置</h4><p>默认情况下，Org 仅将前三个级别的标题导出为标题。当使用 <code>article</code> 时，LaTeX 标题从 <code>\section</code> 、 <code>\subsection</code> 、 <code>\subsubsection</code> 和 <code>\paragraph</code> 、
<code>\subgraph</code> &mdash; <em>五</em> 个级别。HTML5 有六级标题 (<code>&lt;h1&gt;</code> 到 <code>&lt;h6&gt;</code>)，但第一级 Org
标题被导出为 <code>&lt;h2&gt;</code> 元素 &mdash; 剩下 <em>五</em> 个可用级别。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-export-headline-levels</span> <span class="mi">5</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="html-导出" class="headerLink">
    <a href="#html-%e5%af%bc%e5%87%ba" class="header-mark"></a>HTML 导出</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-html</span>
</span></span><span class="line"><span class="cl">  <span class="nv">&lt;&lt;ox-html-conf&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">define-minor-mode</span> <span class="nv">org-fancy-html-export-mode</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Toggle my fabulous org export tweaks. While this mode itself does a little bit,
</span></span></span><span class="line"><span class="cl"><span class="s">the vast majority of the change in behaviour comes from switch statements in:
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html-template-fancier&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html--build-meta-info-extended&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html-src-block-collapsable&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html-block-collapsable&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html-table-wrapped&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html--format-toc-headline-colapseable&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-html--toc-text-stripped-leaves&#39;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> - </span><span class="ss">`org-export-html-headline-anchor&#39;</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:global</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init-value</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="nv">org-fancy-html-export-mode</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-html-style-default</span> <span class="nv">org-html-style-fancy</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">org-html-meta-tags</span> <span class="nf">#&#39;</span><span class="nv">org-html-meta-tags-fancy</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">org-html-checkbox-type</span> <span class="ss">&#39;html-span</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-html-style-default</span> <span class="nv">org-html-style-plain</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">org-html-meta-tags</span> <span class="nf">#&#39;</span><span class="nv">org-html-meta-tags-default</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">org-html-checkbox-type</span> <span class="ss">&#39;html</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!--list-separator-->
<ul>
<li>
<p>额外的 head</p>
<p>在主体的开头添加更多信息，在页眉中添加日期和作者，实现仅 CSS 的亮/暗主题切换，以及一些
<a href="https://ogp.me/" target="_blank" rel="noopener noreferrer">Open Graph</a> 元数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-html-template-fancier</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return complete document string after HTML conversion.
</span></span></span><span class="line"><span class="cl"><span class="s">CONTENTS is the transcoded contents string.  INFO is a plist
</span></span></span><span class="line"><span class="cl"><span class="s">holding export options. Adds a few extra things to the body
</span></span></span><span class="line"><span class="cl"><span class="s">compared to the default implementation.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-html-template</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">org-fancy-html-export-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">org-msg-export-in-progress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">org-html-html5-p</span> <span class="nv">info</span><span class="p">))</span> <span class="p">(</span><span class="nv">org-html-xhtml-p</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">xml-declaration</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-xml-declaration</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nv">decl</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">xml-declaration</span><span class="p">)</span> <span class="nv">xml-declaration</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-extension</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="nv">xml-declaration</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;html&#34;</span> <span class="nv">xml-declaration</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">decl</span><span class="p">)</span> <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;&#34;</span> <span class="nv">decl</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s\n&#34;</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">format</span> <span class="nv">decl</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">org-html-coding-system</span>
</span></span><span class="line"><span class="cl">				    <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;coding-system-get</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="p">(</span><span class="nv">coding-system-get</span> <span class="nv">org-html-coding-system</span> <span class="ss">&#39;mime-charset</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			       <span class="s">&#34;utf-8&#34;</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-html-doctype</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;&lt;html&#34;</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">org-html-xhtml-p</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nf">format</span>
</span></span><span class="line"><span class="cl">		     <span class="s">&#34; xmlns=\&#34;http://www.w3.org/1999/xhtml\&#34; lang=\&#34;%s\&#34; xml:lang=\&#34;%s\&#34;&#34;</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:language</span><span class="p">)</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:language</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		   <span class="p">((</span><span class="nv">org-html-html5-p</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34; lang=\&#34;%s\&#34;&#34;</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:language</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	     <span class="s">&#34;&gt;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;&lt;head&gt;\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-html--build-meta-info</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-html--build-head</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-html--build-mathjax-config</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;&lt;/head&gt;\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;&lt;body&gt;\n&lt;input type=&#39;checkbox&#39; id=&#39;theme-switch&#39;&gt;&lt;div id=&#39;page&#39;&gt;&lt;label id=&#39;switch-label&#39; for=&#39;theme-switch&#39;&gt;&lt;/label&gt;&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">link-up</span> <span class="p">(</span><span class="nv">org-trim</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-link-up</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">link-home</span> <span class="p">(</span><span class="nv">org-trim</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-link-home</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">link-up</span> <span class="s">&#34;&#34;</span><span class="p">)</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">link-home</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">format</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-home/up-format</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">or</span> <span class="nv">link-up</span> <span class="nv">link-home</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">or</span> <span class="nv">link-home</span> <span class="nv">link-up</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Preamble.</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-html--build-pre/postamble</span> <span class="ss">&#39;preamble</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Document contents.</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">div</span> <span class="p">(</span><span class="nf">assq</span> <span class="ss">&#39;content</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-divs</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;%s id=\&#34;%s\&#34;&gt;\n&#34;</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">div</span><span class="p">)</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">div</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Document title.</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">title</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			 <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:title</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">subtitle</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:subtitle</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">html5-fancy</span> <span class="p">(</span><span class="nv">org-html--html5-fancy-p</span> <span class="nv">info</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nb">when</span> <span class="nv">title</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">format</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">if</span> <span class="nv">html5-fancy</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;&lt;header class=\&#34;page-header\&#34;&gt;%s\n&lt;h1 class=\&#34;title\&#34;&gt;%s&lt;/h1&gt;\n%s&lt;/header&gt;&#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;&lt;h1 class=\&#34;title\&#34;&gt;%s%s&lt;/h1&gt;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-author</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;&lt;div class=\&#34;page-meta\&#34;&gt;&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nv">org-export-data</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:date</span><span class="p">)</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-date</span><span class="p">)</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-author</span><span class="p">))</span> <span class="s">&#34;, &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-author</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nv">org-export-data</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:author</span><span class="p">)</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;&lt;/div&gt;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nv">org-export-data</span> <span class="nv">title</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">if</span> <span class="nv">subtitle</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nf">format</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">if</span> <span class="nv">html5-fancy</span>
</span></span><span class="line"><span class="cl">		     <span class="s">&#34;&lt;p class=\&#34;subtitle\&#34; role=\&#34;doc-subtitle\&#34;&gt;%s&lt;/p&gt;\n&#34;</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\n&#34;</span> <span class="p">(</span><span class="nv">org-html-close-tag</span> <span class="s">&#34;br&#34;</span> <span class="no">nil</span> <span class="nv">info</span><span class="p">)</span> <span class="s">&#34;\n&#34;</span>
</span></span><span class="line"><span class="cl">			   <span class="s">&#34;&lt;span class=\&#34;subtitle\&#34;&gt;%s&lt;/span&gt;\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">org-export-data</span> <span class="nv">subtitle</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">     <span class="nv">contents</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;/%s&gt;\n&#34;</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">assq</span> <span class="ss">&#39;content</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-divs</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Postamble.</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-html--build-pre/postamble</span> <span class="ss">&#39;postamble</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Possibly use the Klipse library live code blocks.</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-klipsify-src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;&lt;script&gt;&#34;</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:html-klipse-selection-script</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	       <span class="s">&#34;&lt;/script&gt;&lt;script src=\&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	       <span class="nv">org-html-klipse-js</span>
</span></span><span class="line"><span class="cl">	       <span class="s">&#34;\&#34;&gt;&lt;/script&gt;&lt;link rel=\&#34;stylesheet\&#34; type=\&#34;text/css\&#34; href=\&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	       <span class="nv">org-html-klipse-css</span> <span class="s">&#34;\&#34;/&gt;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; Closing document.</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>自定义 CSS/JS</p>
<p><a href="https://lepisma.xyz" target="_blank" rel="noopener noreferrer">lepisma.xyz</a> 所做的导出风格非常讨喜。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;icon&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://tecosaur.com/resources/org/nib.ico&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;image/ico&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;font&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;font/woff2&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;font&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;font/woff2&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;font&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;font/woff2&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;font&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;font/woff2&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;font&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;font/woff2&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://tecosaur.com/resources/org/Merriweather-TextBold.woff2&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-html-style-plain</span> <span class="nv">org-html-style-default</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-html-htmlize-output-type</span> <span class="ss">&#39;css</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-html-doctype</span> <span class="s">&#34;html5&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-html-html5-fancy</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-html-reload-fancy-style</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-html-style-fancy</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">f-read-text</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;misc/org-export-header.html&#34;</span> <span class="nv">doom-private-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;&lt;script&gt;\n&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nv">f-read-text</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;misc/org-css/main.js&#34;</span> <span class="nv">doom-private-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;&lt;/script&gt;\n&lt;style&gt;\n&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nv">f-read-text</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;misc/org-css/main.min.css&#34;</span> <span class="nv">doom-private-dir</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;&lt;/style&gt;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="nv">org-fancy-html-export-mode</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-html-style-default</span> <span class="nv">org-html-style-fancy</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">org-html-reload-fancy-style</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>可折叠的 src 和示例块</p>
<p>通过将 <code>&lt;pre&gt;</code> 元素包装在 <code>&lt;details&gt;</code> 块中，我们可以得到没有 CSS 的可折叠块，尽管我们会稍微折腾一下，让这看起来有点漂亮。</p>
<p>由于默认情况下对某些代码块启用可折叠性似乎很有用，因此如果您可以使用
<code>#+attr_html: :collapsed t</code> 设置它会更好。</p>
<p>如果有一个相应的全局/会话本地方式来设置它会很好，但我还没能让它正常工作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-html-export-collapsed</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">eval</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">cl-pushnew</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:collapsed</span> <span class="s">&#34;COLLAPSED&#34;</span> <span class="s">&#34;collapsed&#34;</span> <span class="nv">org-html-export-collapsed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">org-export-backend-options</span> <span class="p">(</span><span class="nv">org-export-get-backend</span> <span class="ss">&#39;html</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-default-properties</span> <span class="s">&#34;EXPORT_COLLAPSED&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们可以进一步修改 src 块，并在 src 块的一侧添加一个块，其中包含引用当前块的锚点和复制块内容的按钮。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-html-src-block-collapsable</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Wrap the usual &lt;pre&gt; block in a &lt;details&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-html-src-block</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">org-fancy-html-export-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">org-msg-export-in-progress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">properties</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">lang</span> <span class="p">(</span><span class="nv">mode-name-to-lang-name</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">properties</span> <span class="nb">:language</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">name</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">properties</span> <span class="nb">:name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">ref</span> <span class="p">(</span><span class="nv">org-export-get-reference</span> <span class="nv">src-block</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">collapsed-p</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-export-read-attribute</span> <span class="nb">:attr_html</span> <span class="nv">src-block</span> <span class="nb">:collapsed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:collapsed</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;y&#34;</span> <span class="s">&#34;yes&#34;</span> <span class="s">&#34;t&#34;</span> <span class="no">t</span> <span class="s">&#34;true&#34;</span> <span class="s">&#34;all&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">format</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;details id=&#39;%s&#39; class=&#39;code&#39;%s&gt;&lt;summary%s&gt;%s&lt;/summary&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;div class=&#39;gutter&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;a href=&#39;#%s&#39;&gt;#&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;button title=&#39;Copy to clipboard&#39; onclick=&#39;copyPreToClipbord(this)&#39;&gt;⎘&lt;/button&gt;\
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">%s
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/details&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">ref</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">if</span> <span class="nv">collapsed-p</span> <span class="s">&#34;&#34;</span> <span class="s">&#34; open&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">if</span> <span class="nv">name</span> <span class="s">&#34; class=&#39;named&#39;&#34;</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">when</span> <span class="nv">name</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;&lt;span class=\&#34;name\&#34;&gt;&#34;</span> <span class="nv">name</span> <span class="s">&#34;&lt;/span&gt;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;&lt;span class=\&#34;lang\&#34;&gt;&#34;</span> <span class="nv">lang</span> <span class="s">&#34;&lt;/span&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="nv">ref</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">if</span> <span class="nv">name</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;pre\\( class=\&#34;[^\&#34;]+\&#34;\\)? id=\&#34;%s\&#34;&gt;&#34;</span> <span class="nv">ref</span><span class="p">)</span> <span class="s">&#34;&lt;pre\\1&gt;&#34;</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">mode-name-to-lang-name</span> <span class="p">(</span><span class="nv">mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">mode</span>
</span></span><span class="line"><span class="cl">		   <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;asymptote&#34;</span> <span class="s">&#34;Asymptote&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;awk&#34;</span> <span class="s">&#34;Awk&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;C&#34;</span> <span class="s">&#34;C&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;clojure&#34;</span> <span class="s">&#34;Clojure&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;css&#34;</span> <span class="s">&#34;CSS&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;D&#34;</span> <span class="s">&#34;D&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ditaa&#34;</span> <span class="s">&#34;ditaa&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;dot&#34;</span> <span class="s">&#34;Graphviz&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;calc&#34;</span> <span class="s">&#34;Emacs Calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;emacs-lisp&#34;</span> <span class="s">&#34;Emacs Lisp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;fortran&#34;</span> <span class="s">&#34;Fortran&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;gnuplot&#34;</span> <span class="s">&#34;gnuplot&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;haskell&#34;</span> <span class="s">&#34;Haskell&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;hledger&#34;</span> <span class="s">&#34;hledger&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;java&#34;</span> <span class="s">&#34;Java&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;js&#34;</span> <span class="s">&#34;Javascript&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;latex&#34;</span> <span class="s">&#34;LaTeX&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ledger&#34;</span> <span class="s">&#34;Ledger&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;lisp&#34;</span> <span class="s">&#34;Lisp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;lilypond&#34;</span> <span class="s">&#34;Lilypond&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;lua&#34;</span> <span class="s">&#34;Lua&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;matlab&#34;</span> <span class="s">&#34;MATLAB&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;mscgen&#34;</span> <span class="s">&#34;Mscgen&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ocaml&#34;</span> <span class="s">&#34;Objective Caml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;octave&#34;</span> <span class="s">&#34;Octave&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;org&#34;</span> <span class="s">&#34;Org mode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;oz&#34;</span> <span class="s">&#34;OZ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;plantuml&#34;</span> <span class="s">&#34;Plantuml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;processing&#34;</span> <span class="s">&#34;Processing.js&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;python&#34;</span> <span class="s">&#34;Python&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;R&#34;</span> <span class="s">&#34;R&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ruby&#34;</span> <span class="s">&#34;Ruby&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;sass&#34;</span> <span class="s">&#34;Sass&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;scheme&#34;</span> <span class="s">&#34;Scheme&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;screen&#34;</span> <span class="s">&#34;Gnu Screen&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;sed&#34;</span> <span class="s">&#34;Sed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;sh&#34;</span> <span class="s">&#34;shell&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;sql&#34;</span> <span class="s">&#34;SQL&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;sqlite&#34;</span> <span class="s">&#34;SQLite&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;forth&#34;</span> <span class="s">&#34;Forth&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;io&#34;</span> <span class="s">&#34;IO&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;J&#34;</span> <span class="s">&#34;J&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;makefile&#34;</span> <span class="s">&#34;Makefile&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;maxima&#34;</span> <span class="s">&#34;Maxima&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;perl&#34;</span> <span class="s">&#34;Perl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;picolisp&#34;</span> <span class="s">&#34;Pico Lisp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;scala&#34;</span> <span class="s">&#34;Scala&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;shell&#34;</span> <span class="s">&#34;Shell Script&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ebnf2ps&#34;</span> <span class="s">&#34;ebfn2ps&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;cpp&#34;</span> <span class="s">&#34;C++&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;abc&#34;</span> <span class="s">&#34;ABC&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;coq&#34;</span> <span class="s">&#34;Coq&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;groovy&#34;</span> <span class="s">&#34;Groovy&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;bash&#34;</span> <span class="s">&#34;bash&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;csh&#34;</span> <span class="s">&#34;csh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ash&#34;</span> <span class="s">&#34;ash&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;dash&#34;</span> <span class="s">&#34;dash&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ksh&#34;</span> <span class="s">&#34;ksh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;mksh&#34;</span> <span class="s">&#34;mksh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;posh&#34;</span> <span class="s">&#34;posh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ada&#34;</span> <span class="s">&#34;Ada&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;asm&#34;</span> <span class="s">&#34;Assembler&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;caml&#34;</span> <span class="s">&#34;Caml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;delphi&#34;</span> <span class="s">&#34;Delphi&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;html&#34;</span> <span class="s">&#34;HTML&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;idl&#34;</span> <span class="s">&#34;IDL&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;mercury&#34;</span> <span class="s">&#34;Mercury&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;metapost&#34;</span> <span class="s">&#34;MetaPost&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;modula-2&#34;</span> <span class="s">&#34;Modula-2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;pascal&#34;</span> <span class="s">&#34;Pascal&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;ps&#34;</span> <span class="s">&#34;PostScript&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;prolog&#34;</span> <span class="s">&#34;Prolog&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;simula&#34;</span> <span class="s">&#34;Simula&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;tcl&#34;</span> <span class="s">&#34;tcl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;tex&#34;</span> <span class="s">&#34;LaTeX&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;plain-tex&#34;</span> <span class="s">&#34;TeX&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;verilog&#34;</span> <span class="s">&#34;Verilog&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;vhdl&#34;</span> <span class="s">&#34;VHDL&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;xml&#34;</span> <span class="s">&#34;XML&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;nxml&#34;</span> <span class="s">&#34;XML&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="s">&#34;conf&#34;</span> <span class="s">&#34;Configuration File&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="nv">mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>HTML 化的字体锁</p>
<p>Org 使用 <a href="https://github.com/hniksic/emacs-htmlize" target="_blank" rel="noopener noreferrer">htmlize.el</a> 导出带有语法高亮的缓冲区。</p>
<p>在大多数情况下这些格式非常棒。不需要加载提供字体锁定的次要模式，因此不会影响结果。</p>
<p>通过在 <code>htmlize-before-hook</code> 中启用这些模式，我们可以纠正这种行为。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">autoload</span> <span class="nf">#&#39;</span><span class="nv">highlight-numbers--turn-on</span> <span class="s">&#34;highlight-numbers&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;htmlize-before-hook</span> <span class="nf">#&#39;</span><span class="nv">highlight-numbers--turn-on</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>处理表溢出</p>
<p>为了适应宽表 &mdash; 尤其是在移动设备上 &mdash; 我们想要设置最大宽度和滚动溢出。不幸的是，这不能直接应用于 <code>表格</code> 元素，所以我们必须将它包装在一个 <code>div</code> 中。</p>
<p>当我们这样做时，我们可以像我们对 src 块所做的那样，设置一个链接块，并显示
<code>#+name</code> (如果有的话)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-html-table-wrapped</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">table</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Wrap the usual &lt;table&gt; in a &lt;div&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-html-table</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">org-fancy-html-export-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">org-msg-export-in-progress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">table</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">name</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">table</span><span class="p">)</span> <span class="nb">:name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">ref</span> <span class="p">(</span><span class="nv">org-export-get-reference</span> <span class="nv">table</span> <span class="nv">info</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;div id=&#39;%s&#39; class=&#39;table&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;div class=&#39;gutter&#39;&gt;&lt;a href=&#39;#%s&#39;&gt;#&lt;/a&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;div class=&#39;tabular&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">%s
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/div&gt;\
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/div&gt;&#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="nv">ref</span> <span class="nv">ref</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nb">if</span> <span class="nv">name</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;table id=\&#34;%s\&#34;&#34;</span> <span class="nv">ref</span><span class="p">)</span> <span class="s">&#34;&lt;table&#34;</span>
</span></span><span class="line"><span class="cl">					    <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">table</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">table</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">))))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>可展开的目录树</p>
<p>TOC 作为可折叠树更易于导航。不幸的是，我们不能单独使用 CSS 来实现这一点。值得庆幸的是，我们可以通过调整 TOC 生成代码来为每个项目使用一个 <code>标签</code> ，以及一个隐藏的
<code>复选框</code> 来跟踪状态，从而避免使用 JS。</p>
<p>要添加它，我们需要在 <code>org-html--format-toc-headline</code> 中更改一行。</p>
<p>因为我们实际上可以通过在函数周围添加建议来实现所需的效果，而无需覆盖它 &mdash; 让我们这样做来减少这个配置的错误表面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-html--format-toc-headline-colapseable</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">headline</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Add a label and checkbox to </span><span class="ss">`org-html--format-toc-headline&#39;</span><span class="s">s usual output,
</span></span></span><span class="line"><span class="cl"><span class="s">to allow the TOC to be a collapseable tree.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-html--format-toc-headline</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">org-fancy-html-export-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">org-msg-export-in-progress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">headline</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">id</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:CUSTOM_ID</span> <span class="nv">headline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nv">org-export-get-reference</span> <span class="nv">headline</span> <span class="nv">info</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;input type=&#39;checkbox&#39; id=&#39;toc--%s&#39;/&gt;&lt;label for=&#39;toc--%s&#39;&gt;%s&lt;/label&gt;&#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="nv">id</span> <span class="nv">id</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">headline</span> <span class="nv">info</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，叶子 (没有子标题的标题) 不应该有 <code>标签项</code> 。实现这一点的明显方法是在
<code>org-html--format-toc-headline-colapseable</code> 中包含一些 (如果没有子项) 逻辑。不幸的是，我的 elisp 无法从 org 提供的大量信息中提取子标题的数量。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-html--toc-text-stripped-leaves</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">toc-entries</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Remove label&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-html--toc-text</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">org-fancy-html-export-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">org-msg-export-in-progress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">toc-entries</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;&lt;input [^&gt;]+&gt;&lt;label [^&gt;]+&gt;\\(.+?\\)&lt;/label&gt;&lt;/li&gt;&#34;</span> <span class="s">&#34;\\1&lt;/li&gt;&#34;</span>
</span></span><span class="line"><span class="cl">			      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">toc-entries</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>使 verbatim 与 code 不同</p>
<p>让我们为 <code>varbatim</code> 和 <code>code</code> 添加一些差异。</p>
<p>我们可以将 <code>code</code> 专门用于代码片段和命令，例如：在 Emacs 的批处理模式中调用
<code>(message &quot;Hello&quot;)</code> 会像 <code>echo</code> 一样打印到标准输出。 可以对
<code>verbatim</code> 使用各种 &lsquo;其他等宽&rsquo;，例如键盘快捷键： <code>C-c C-c</code> 或 <code>C-g</code> 可能是
Emacs 中最有用的快捷键，或文件名：我将我的配置保存在 <code>~/.config/doom/</code> 中，其他情况则使用正常样式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-html-text-markup-alist</span>
</span></span><span class="line"><span class="cl">      <span class="o">&#39;</span><span class="p">((</span><span class="nv">bold</span> <span class="o">.</span> <span class="s">&#34;&lt;b&gt;%s&lt;/b&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">code</span> <span class="o">.</span> <span class="s">&#34;&lt;code&gt;%s&lt;/code&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">italic</span> <span class="o">.</span> <span class="s">&#34;&lt;i&gt;%s&lt;/i&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">strike-through</span> <span class="o">.</span> <span class="s">&#34;&lt;del&gt;%s&lt;/del&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">underline</span> <span class="o">.</span> <span class="s">&#34;&lt;span class=\&#34;underline\&#34;&gt;%s&lt;/span&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">verbatim</span> <span class="o">.</span> <span class="s">&#34;&lt;kbd&gt;%s&lt;/kbd&gt;&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>改变复选框类型</p>
<p>我们也想使用 HTML 复选框，但是我们想比默认的更漂亮</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">appendq!</span> <span class="nv">org-html-checkbox-types</span>
</span></span><span class="line"><span class="cl">	  <span class="o">&#39;</span><span class="p">((</span><span class="nv">html-span</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">on</span> <span class="o">.</span> <span class="s">&#34;&lt;span class=&#39;checkbox&#39;&gt;&lt;/span&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">off</span> <span class="o">.</span> <span class="s">&#34;&lt;span class=&#39;checkbox&#39;&gt;&lt;/span&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">trans</span> <span class="o">.</span> <span class="s">&#34;&lt;span class=&#39;checkbox&#39;&gt;&lt;/span&gt;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-html-checkbox-type</span> <span class="ss">&#39;html-span</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><i class="far fa-square fa-fw"></i> I&rsquo;m yet to do this</li>
<li>[-] Work in progress</li>
<li><i class="far fa-check-square fa-fw"></i> This is done</li>
</ul>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>额外的特殊字符串</p>
<p><code>org-html-special-string-regexps</code> 变量定义了以下内容的替换：</p>
<ul>
<li><code>\-</code>, shy 连字符</li>
<li><code>---</code>, 增强的破折号</li>
<li><code>--</code>, 破折号</li>
<li><code>...</code>, (水平的) 省略号</li>
</ul>
<p>但我认为如果还可以替换左/右箭头 (<code>-&gt;</code> 和 <code>&lt;-</code>) 那就更好了。 这是一个
<code>defconst</code> ，但正如你可以从这个配置中的大量建议中看出的那样，我并没有放弃我不 &lsquo;应该&rsquo; 做的事情。</p>
<p>唯一的小麻烦是在这个阶段的输出处理之前 <code>&lt;</code> 和 <code>&gt;</code> 被转换为 <code>&amp;lt;</code> 和 <code>&amp;gt;</code> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">pushnew!</span> <span class="nv">org-html-special-string-regexps</span>
</span></span><span class="line"><span class="cl">	  <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;-&amp;gt;&#34;</span> <span class="o">.</span> <span class="s">&#34;&amp;#8594;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&amp;lt;-&#34;</span> <span class="o">.</span> <span class="s">&#34;&amp;#8592;&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>标题锚点</p>
<p>一个 GitHub 风格的标题链接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-export-html-headline-anchor</span> <span class="p">(</span><span class="nv">text</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;re-reveal</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	     <span class="nv">org-fancy-html-export-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">org-msg-export-in-progress</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;h\\([0-9]\\) id=\&#34;\\([a-z0-9-]+\\)\&#34;&gt;\\(.*[^ ]\\)&lt;\\/h[0-9]&gt;&#34;</span> <span class="c1">; this is quite restrictive, but due to `org-reference-contraction&#39; I can do this</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;h\\1 id=\&#34;\\2\&#34;&gt;\\3&lt;a aria-hidden=\&#34;true\&#34; href=\&#34;#\\2\&#34;&gt;#&lt;/a&gt; &lt;/h\\1&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">text</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-export-filter-headline-functions</span>
</span></span><span class="line"><span class="cl">	     <span class="ss">&#39;org-export-html-headline-anchor</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>链接预览</p>
<p>有时让链接特别突出会很好，我认为像 Twitter 那样的嵌入 / 预览会很好。</p>
<p>我们可以通过添加一个与 <code>https</code> &mdash; <code>Https</code> 略有不同的新链接类型来轻松做到这点。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">org-link-set-parameters</span> <span class="s">&#34;Https&#34;</span>
</span></span><span class="line"><span class="cl">			 <span class="nb">:follow</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">url</span> <span class="nv">arg</span><span class="p">)</span> <span class="p">(</span><span class="nv">browse-url</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;https:&#34;</span> <span class="nv">url</span><span class="p">)</span> <span class="nv">arg</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			 <span class="nb">:export</span> <span class="nf">#&#39;</span><span class="nv">org-url-fancy-export</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-url-fancy-export</span> <span class="p">(</span><span class="nv">url</span> <span class="nv">_desc</span> <span class="nv">backend</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">metadata</span> <span class="p">(</span><span class="nv">org-url-unfurl-metadata</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;https:&#34;</span> <span class="nv">url</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">     <span class="p">((</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;div class=\&#34;link-preview\&#34;&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;a href=\&#34;%s\&#34;&gt;&#34;</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;https:&#34;</span> <span class="nv">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">metadata</span> <span class="nb">:image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;&lt;img src=\&#34;%s\&#34;/&gt;&#34;</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">metadata</span> <span class="nb">:image</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;small&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;//\\(?:www\\.\\)?\\([^/]+\\)/?.*&#34;</span> <span class="s">&#34;\\1&#34;</span> <span class="nv">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;/small&gt;&lt;p&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">metadata</span> <span class="nb">:title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;&lt;b&gt;&#34;</span> <span class="p">(</span><span class="nv">org-html-encode-plain-text</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">metadata</span> <span class="nb">:title</span><span class="p">))</span> <span class="s">&#34;&lt;/b&gt;&lt;/br&gt;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">metadata</span> <span class="nb">:description</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">org-html-encode-plain-text</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">metadata</span> <span class="nb">:description</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;&lt;/p&gt;&lt;/a&gt;&lt;/div&gt;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="no">t</span> <span class="nv">url</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们只需要实现元数据提取功能。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-url-unfurl-metadata--cache</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-url-unfurl-metadata</span> <span class="p">(</span><span class="nv">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">url</span> <span class="nv">org-url-unfurl-metadata--cache</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nb">push</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nf">cons</span>
</span></span><span class="line"><span class="cl">		  <span class="nv">url</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">head-data</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nv">-filter</span> <span class="nf">#&#39;listp</span>
</span></span><span class="line"><span class="cl">				   <span class="p">(</span><span class="nv">cdaddr</span>
</span></span><span class="line"><span class="cl">				    <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Fetching metadata from %s&#34;</span> <span class="nv">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">								<span class="p">(</span><span class="nv">url-retrieve-synchronously</span> <span class="nv">url</span> <span class="no">t</span> <span class="no">t</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nf">delete-region</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nf">search-forward</span> <span class="s">&#34;&lt;head&#34;</span><span class="p">)</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nf">delete-region</span> <span class="p">(</span><span class="nf">search-forward</span> <span class="s">&#34;&lt;/head&gt;&#34;</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&#34;&lt;script[^\u2800]+?&lt;/script&gt;&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">(</span><span class="nf">replace-match</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&#34;&lt;style[^\u2800]+?&lt;/style&gt;&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">(</span><span class="nf">replace-match</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nf">libxml-parse-html-region</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">			 <span class="p">(</span><span class="nv">meta</span> <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nf">mapcar</span>
</span></span><span class="line"><span class="cl">				      <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;meta</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">tag</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">					  <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;name</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">tag</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">						    <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;property</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">tag</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">						<span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="ss">&#39;content</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">tag</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">				      <span class="nv">head-data</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">title</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;og:title&#34;</span> <span class="nv">meta</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;twitter:title&#34;</span> <span class="nv">meta</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">assq</span> <span class="ss">&#39;title</span> <span class="nv">head-data</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nv">description</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;og:description&#34;</span> <span class="nv">meta</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">					   <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;twitter:description&#34;</span> <span class="nv">meta</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">					   <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;description&#34;</span> <span class="nv">meta</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nv">image</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;og:image&#34;</span> <span class="nv">meta</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;twitter:image&#34;</span> <span class="nv">meta</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="nb">when</span> <span class="nv">image</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nb">setq</span> <span class="nv">image</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
</span></span><span class="line"><span class="cl">				     <span class="s">&#34;^/&#34;</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;https://&#34;</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;//\\([^/]+\\)/?.*&#34;</span> <span class="s">&#34;\\1&#34;</span> <span class="nv">url</span><span class="p">)</span> <span class="s">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				     <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
</span></span><span class="line"><span class="cl">				      <span class="s">&#34;^//&#34;</span> <span class="s">&#34;https://&#34;</span>
</span></span><span class="line"><span class="cl">				      <span class="nv">image</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">		      <span class="p">(</span><span class="nf">list</span> <span class="nb">:title</span> <span class="nv">title</span> <span class="nb">:description</span> <span class="nv">description</span> <span class="nb">:image</span> <span class="nv">image</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">		 <span class="nv">org-url-unfurl-metadata--cache</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>LaTeX Rendering</p>
<p>如果使用 MathJax，就用 3 而不是 2。通过<a href="https://www.intmath.com/cg5/katex-mathjax-comparison.php" target="_blank" rel="noopener noreferrer">对比</a>我们发现它似乎快了 5 倍，而且它使用单个文件而不是多个文件，就是有点大而已。值得庆幸的是，这可以通过添加 <code>async</code> 属性来延迟加载来缓解。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-html-mathjax-options</span>
</span></span><span class="line"><span class="cl">      <span class="o">&#39;</span><span class="p">((</span><span class="nv">path</span> <span class="s">&#34;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js&#34;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">scale</span> <span class="s">&#34;1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">autonumber</span> <span class="s">&#34;ams&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">multlinewidth</span> <span class="s">&#34;85%&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">tagindent</span> <span class="s">&#34;.8em&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nv">tagside</span> <span class="s">&#34;right&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-html-mathjax-template</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&lt;script&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">MathJax = {
</span></span></span><span class="line"><span class="cl"><span class="s">  loader: {
</span></span></span><span class="line"><span class="cl"><span class="s">    load: [&#39;[tex]/ams&#39;, &#39;[tex]/upgreek&#39;, &#39;[tex]/mathtools&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s">  },
</span></span></span><span class="line"><span class="cl"><span class="s">  chtml: {
</span></span></span><span class="line"><span class="cl"><span class="s">    scale: %SCALE
</span></span></span><span class="line"><span class="cl"><span class="s">  },
</span></span></span><span class="line"><span class="cl"><span class="s">  svg: {
</span></span></span><span class="line"><span class="cl"><span class="s">    scale: %SCALE,
</span></span></span><span class="line"><span class="cl"><span class="s">    fontCache: \&#34;global\&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  },
</span></span></span><span class="line"><span class="cl"><span class="s">  tex: {
</span></span></span><span class="line"><span class="cl"><span class="s">    packages: {&#39;[+]&#39;: [&#39;ams&#39;, &#39;upgreek&#39;, &#39;mathtools&#39;]},
</span></span></span><span class="line"><span class="cl"><span class="s">    tags: \&#34;%AUTONUMBER\&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">    multlineWidth: \&#34;%MULTLINEWIDTH\&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">    tagSide: \&#34;%TAGSIDE\&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">    tagIndent: \&#34;%TAGINDENT\&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  }
</span></span></span><span class="line"><span class="cl"><span class="s">};
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/script&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;script id=\&#34;MathJax-script\&#34; async
</span></span></span><span class="line"><span class="cl"><span class="s">	src=\&#34;%PATH\&#34;&gt;&lt;/script&gt;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="latex-导出" class="headerLink">
    <a href="#latex-%e5%af%bc%e5%87%ba" class="header-mark"></a>LaTeX 导出</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-latex</span>
</span></span><span class="line"><span class="cl">  <span class="nv">&lt;&lt;ox-latex-conf&gt;&gt;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!--list-separator-->
<ul>
<li>
<p>编译</p>
<p>默认情况下，Org 使用 <code>pdflatex</code> × 3 + <code>bibtex</code> 。 这在现代世界根本行不通。
<code>latexmk</code> + <code>biber</code> (自动与 <code>latexmk</code> 一起使用) 是一个简单且优越组合。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; org-latex-compilers = (&#34;pdflatex&#34; &#34;xelatex&#34; &#34;lualatex&#34;), which are the possible values for %latex</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-latex-pdf-process</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;latexmk -f -pdf -%latex -shell-escape -interaction=nonstopmode -output-directory=%o %f&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>虽然上面的 <code>-%latex</code> 有点 hacky (<code>-pdflatex</code> 期望被赋予一个值)，但它允许我们保持
<code>org-latex-compilers</code> 不变。如果我打开一个使用 <code>#+LATEX_COMPILER</code> 的 org 文件，这很好，它应该仍然可以工作。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>复选框</p>
<p>我们可以假设在序言部分，定义了下面的各种自定义 <code>\checkbox...</code> 命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">+org-export-latex-fancy-item-checkboxes</span> <span class="p">(</span><span class="nv">text</span> <span class="nv">backend</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;latex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;\\\\item\\[{$\\\\\\(\\w+\\)$}\\]&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">fullmatch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\\\item[&#34;</span> <span class="p">(</span><span class="nb">pcase</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">fullmatch</span> <span class="mi">9</span> <span class="mi">-3</span><span class="p">)</span> <span class="c1">; content of capture group</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="s">&#34;square&#34;</span>   <span class="s">&#34;\\\\checkboxUnchecked&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="s">&#34;boxminus&#34;</span> <span class="s">&#34;\\\\checkboxTransitive&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="s">&#34;boxtimes&#34;</span> <span class="s">&#34;\\\\checkboxChecked&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="nv">_</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">fullmatch</span> <span class="mi">9</span> <span class="mi">-3</span><span class="p">)))</span> <span class="s">&#34;]&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">     <span class="nv">text</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-export-filter-item-functions</span>
</span></span><span class="line"><span class="cl">	     <span class="ss">&#39;+org-export-latex-fancy-item-checkboxes</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>类模板</p>
<p>页边空白处的节号，这可以用下面的 LaTeX 来完成。</p>
<p><a id="code-snippet--latex-hanging-secnum"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>renewcommand<span class="k">\\</span>sectionformat<span class="nb">{</span><span class="k">\\</span>llap<span class="nb">{</span><span class="k">\\</span>thesection<span class="k">\\</span>autodot<span class="k">\\</span>enskip<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand<span class="k">\\</span>subsectionformat<span class="nb">{</span><span class="k">\\</span>llap<span class="nb">{</span><span class="k">\\</span>thesubsection<span class="k">\\</span>autodot<span class="k">\\</span>enskip<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand<span class="k">\\</span>subsubsectionformat<span class="nb">{</span><span class="k">\\</span>llap<span class="nb">{</span><span class="k">\\</span>thesubsubsection<span class="k">\\</span>autodot<span class="k">\\</span>enskip<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>makeatletter
</span></span><span class="line"><span class="cl"><span class="k">\\</span>g@addto@macro<span class="k">\\</span>tableofcontents<span class="nb">{</span><span class="k">\\</span>clearpage<span class="k">\\</span>setcounter<span class="nb">{</span>page<span class="nb">}{</span>1<span class="nb">}</span><span class="k">\\</span>pagenumbering<span class="nb">{</span>arabic<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>makeatother
</span></span><span class="line"><span class="cl"><span class="k">\\</span>setcounter<span class="nb">{</span>page<span class="nb">}{</span>1<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>pagenumbering<span class="nb">{</span>Roman<span class="nb">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>超大的 <code>\chapter</code> 。</p>
<p><a id="code-snippet--latex-big-chapter"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>RedeclareSectionCommand[afterindent=false, beforeskip=0pt, afterskip=0pt, innerskip=0pt]<span class="nb">{</span>chapter<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>setkomafont<span class="nb">{</span>chapter<span class="nb">}{</span><span class="k">\\</span>normalfont<span class="k">\\</span>Huge<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand*<span class="nb">{</span><span class="k">\\</span>chapterheadstartvskip<span class="nb">}{</span><span class="k">\\</span>vspace*<span class="nb">{</span>0<span class="k">\\</span>baselineskip<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand*<span class="nb">{</span><span class="k">\\</span>chapterheadendvskip<span class="nb">}{</span><span class="k">\\</span>vspace*<span class="nb">{</span>0<span class="k">\\</span>baselineskip<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand*<span class="nb">{</span><span class="k">\\</span>chapterformat<span class="nb">}{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\\</span>fontsize<span class="nb">{</span>60<span class="nb">}{</span>30<span class="nb">}</span><span class="k">\\</span>selectfont<span class="k">\\</span>rlap<span class="nb">{</span><span class="k">\\</span>hspace<span class="nb">{</span>6pt<span class="nb">}</span><span class="k">\\</span>thechapter<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand*<span class="k">\\</span>chapterlinesformat[3]<span class="nb">{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\\</span>parbox[b]<span class="nb">{</span><span class="k">\\</span>dimexpr<span class="k">\\</span>textwidth-0.5em<span class="k">\\</span>relax<span class="nb">}{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>raggedleft<span class="nb">{{</span><span class="k">\\</span>large<span class="k">\\</span>scshape<span class="k">\\</span>bfseries<span class="k">\\</span>chapapp<span class="nb">}</span><span class="k">\\</span>vspace<span class="nb">{</span>-0.5ex<span class="nb">}</span><span class="k">\\</span>par<span class="k">\\</span>Huge#3<span class="nb">}}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>hfill<span class="k">\\</span>makebox[0pt][l]<span class="nb">{</span>#2<span class="nb">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在在 Org LaTeX 类中添加一些 <code>KOMA-Script</code> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">article-sections</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;\\subsubsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsubsection*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;\\paragraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\paragraph*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="s">&#34;\\subparagraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subparagraph*{%s}&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">book-sections</span> <span class="p">(</span><span class="nf">append</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;\\chapter{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\chapter*{%s}&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			      <span class="nv">article-sections</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">hanging-secnum-preamble</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;latex-hanging-secnum&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">big-chap-preamble</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;latex-big-chapter&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">setcdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;article&#34;</span> <span class="nv">org-latex-classes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\documentclass{scrartcl}&#34;</span> <span class="nv">hanging-secnum-preamble</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="o">,@</span><span class="nv">article-sections</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">setcdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;article&#34;</span> <span class="nv">org-latex-classes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\documentclass{scrartcl}&#34;</span> <span class="nv">hanging-secnum-preamble</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="o">,@</span><span class="nv">article-sections</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">setcdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;report&#34;</span> <span class="nv">org-latex-classes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\documentclass{scrartcl}&#34;</span> <span class="nv">hanging-secnum-preamble</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="o">,@</span><span class="nv">article-sections</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">setcdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;book&#34;</span> <span class="nv">org-latex-classes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\documentclass[twoside=false]{scrbook}&#34;</span>
</span></span><span class="line"><span class="cl">		     <span class="nv">big-chap-preamble</span> <span class="nv">hanging-secnum-preamble</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="o">,@</span><span class="nv">book-sections</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-latex-tables-booktabs</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-latex-hyperref-template</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;latex-fancy-hyperref&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-latex-reference-command</span> <span class="s">&#34;\\cref{%s}&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然而 <code>hyperref</code> 设置需要单独处理。</p>
<p><a id="code-snippet--latex-fancy-hyperref"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>providecolor<span class="nb">{</span>url<span class="nb">}{</span>HTML<span class="nb">}{</span>0077bb<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>providecolor<span class="nb">{</span>link<span class="nb">}{</span>HTML<span class="nb">}{</span>882255<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>providecolor<span class="nb">{</span>cite<span class="nb">}{</span>HTML<span class="nb">}{</span>999933<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>hypersetup<span class="nb">{</span>
</span></span><span class="line"><span class="cl">  pdfauthor=<span class="nb">{</span><span class="c">%a},
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  pdftitle=<span class="nb">{</span><span class="c">%t},
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  pdfkeywords=<span class="nb">{</span><span class="c">%k},
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  pdfsubject=<span class="nb">{</span><span class="c">%d},
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  pdfcreator=<span class="nb">{</span><span class="c">%c},
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  pdflang=<span class="nb">{</span><span class="c">%L},
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  breaklinks=true,
</span></span><span class="line"><span class="cl">  colorlinks=true,
</span></span><span class="line"><span class="cl">  linkcolor=link,
</span></span><span class="line"><span class="cl">  urlcolor=url,
</span></span><span class="line"><span class="cl">  citecolor=cite<span class="k">\n</span><span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>urlstyle<span class="nb">{</span>same<span class="nb">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>智能序言</p>
 <!--list-separator-->
<ul>
<li>
<p>功能优化</p>
<p>Caption 可以做一些调整，比如</p>
<ul>
<li>可以轻松拥有多个 Caption</li>
<li>指向图的链接带到图的顶部 (而不是底部)</li>
<li>Caption 标签可以稍微加粗一点</li>
<li>只有当跨越多行时，多行 Caption 应该向右一点</li>
</ul>
 <!--listend-->
<p><a id="code-snippet--org-latex-caption-preamble"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>usepackage<span class="nb">{</span>subcaption<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>usepackage[hypcap=true]<span class="nb">{</span>caption<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>setkomafont<span class="nb">{</span>caption<span class="nb">}{</span><span class="k">\\</span>sffamily<span class="k">\\</span>small<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>setkomafont<span class="nb">{</span>captionlabel<span class="nb">}{</span><span class="k">\\</span>upshape<span class="k">\\</span>bfseries<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>captionsetup<span class="nb">{</span>justification=raggedright,singlelinecheck=true<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>usepackage<span class="nb">{</span>capt-of<span class="nb">}</span> <span class="c">% required by Org
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>默认的复选框太丑了，用一些好看的替代品吧。</p>
<p><a id="code-snippet--org-latex-checkbox-preamble"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>newcommand<span class="nb">{</span><span class="k">\\</span>checkboxUnchecked<span class="nb">}{</span><span class="s">$</span><span class="nv">\\</span><span class="nb">square</span><span class="s">$</span><span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>newcommand<span class="nb">{</span><span class="k">\\</span>checkboxTransitive<span class="nb">}{</span><span class="k">\\</span>rlap<span class="nb">{</span><span class="k">\\</span>raisebox<span class="nb">{</span>-0.1ex<span class="nb">}{</span><span class="k">\\</span>hspace<span class="nb">{</span>0.35ex<span class="nb">}</span><span class="k">\\</span>Large<span class="k">\\</span>textbf -<span class="nb">}}</span><span class="s">$</span><span class="nv">\\</span><span class="nb">square</span><span class="s">$</span><span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>newcommand<span class="nb">{</span><span class="k">\\</span>checkboxChecked<span class="nb">}{</span><span class="k">\\</span>rlap<span class="nb">{</span><span class="k">\\</span>raisebox<span class="nb">{</span>0.2ex<span class="nb">}{</span><span class="k">\\</span>hspace<span class="nb">{</span>0.35ex<span class="nb">}</span><span class="k">\\</span>scriptsize <span class="k">\\</span>ding<span class="nb">{</span>52<span class="nb">}}}</span><span class="s">$</span><span class="nv">\\</span><span class="nb">square</span><span class="s">$</span><span class="nb">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>&ldquo;消息块&rdquo; 是一个不错的想法，就像 info/warning/error/success。LaTeX 中的宏可以创建它们。</p>
<p><a id="code-snippet--org-latex-box-preamble"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>ExplSyntaxOn
</span></span><span class="line"><span class="cl"><span class="k">\\</span>NewCoffin<span class="k">\\</span>Content
</span></span><span class="line"><span class="cl"><span class="k">\\</span>NewCoffin<span class="k">\\</span>SideRule
</span></span><span class="line"><span class="cl"><span class="k">\\</span>NewDocumentCommand<span class="nb">{</span><span class="k">\\</span>defsimplebox<span class="nb">}{</span>O<span class="nb">{</span><span class="k">\\</span>ding<span class="nb">{</span>117<span class="nb">}}</span> O<span class="nb">{</span>0.36em<span class="nb">}</span> m m m<span class="nb">}{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="c">% #1 ding, #2 ding offset, #3 name, #4 colour, #5 default label
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\\</span>definecolor<span class="nb">{</span>#3<span class="nb">}{</span>HTML<span class="nb">}{</span>#4<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>NewDocumentEnvironment<span class="nb">{</span>#3<span class="nb">}{</span> O<span class="nb">{</span>#5<span class="nb">}</span> <span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>vcoffin<span class="nb">_</span>set:Nnw <span class="k">\\</span>Content <span class="nb">{</span> <span class="k">\\</span>linewidth <span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>noindent <span class="k">\\</span>ignorespaces
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>par<span class="k">\\</span>vspace<span class="nb">{</span>-0.7<span class="k">\\</span>baselineskip<span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>textcolor<span class="nb">{</span>#3<span class="nb">}{</span>#1<span class="nb">}</span>~<span class="k">\\</span>textcolor<span class="nb">{</span>#3<span class="nb">}{</span><span class="k">\\</span>textbf<span class="nb">{</span>##1<span class="nb">}}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>vspace<span class="nb">{</span>-0.8<span class="k">\\</span>baselineskip<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>begin<span class="nb">{</span>addmargin<span class="nb">}</span>[1em]<span class="nb">{</span>1em<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>end<span class="nb">{</span>addmargin<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>vspace<span class="nb">{</span>-0.5<span class="k">\\</span>baselineskip<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>vcoffin<span class="nb">_</span>set<span class="nb">_</span>end:
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>SetHorizontalCoffin<span class="k">\\</span>SideRule<span class="nb">{</span><span class="k">\\</span>color<span class="nb">{</span>#3<span class="nb">}</span><span class="k">\\</span>rule<span class="nb">{</span>1pt<span class="nb">}{</span><span class="k">\\</span>CoffinTotalHeight<span class="k">\\</span>Content<span class="nb">}}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>JoinCoffins*<span class="k">\\</span>Content[l,t]<span class="k">\\</span>SideRule[l,t](#2,-0.7em)
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>noindent<span class="k">\\</span>TypesetCoffin<span class="k">\\</span>Content
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>vspace*<span class="nb">{</span><span class="k">\\</span>CoffinTotalHeight<span class="k">\\</span>Content<span class="nb">}</span><span class="k">\\</span>bigskip
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>vspace<span class="nb">{</span>-2<span class="k">\\</span>baselineskip<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>ExplSyntaxOff
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，我们会将这些内容传递到一些全局变量中，以便于访问。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-caption-preamble</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;org-latex-caption-preamble&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Preamble that improves captions.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-checkbox-preamble</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;org-latex-checkbox-preamble&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Preamble that improves checkboxes.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-box-preamble</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;org-latex-box-preamble&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Preamble that provides a macro for custom boxes.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
 <!--list-separator-->
<ul>
<li>
<p>内容-特征-序言关联</p>
<p>每个检测到的特征都会给出一个所需的「特征标志」列表。只需合并功能标志列表，不再需要避免 LaTeX 的重复。然后额外的层在特征标志和可用于实现该特征的规范之间形成双射。</p>
<figure class="invertible"><img src="/images/orgmode-latex-clever-preamble.svg"
                 alt="DAG showing how Org features flow through to LaTeX" width="55%"/><figcaption>
                    <p><span class="figure-number">Figure 1: </span>Org 功能、功能标志和 LaTeX 片段之间的关联</p>
                </figcaption>
        </figure>

<p>首先，我们将实现该模型的特征检测组件。我希望它能够使用尽可能多的状态信息，因此功能测试应该非常通用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-italic-quotes</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Make \&#34;quote\&#34; environments italic.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-par-sep</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Vertically seperate paragraphs, and remove indentation.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-conditional-features</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;\\[\\[\\(?:file\\|https?\\):\\(?:[^]]\\|\\\\\\]\\)+?\\.\\(?:eps\\|pdf\\|png\\|jpeg\\|jpg\\|jbig2\\)\\]\\]\\|\\\\includegraphics[\\[{]&#34;</span> <span class="o">.</span> <span class="nv">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;\\[\\[\\(?:file\\|https?\\):\\(?:[^]]+?\\|\\\\\\]\\)\\.svg\\]\\]\\|\\\\includesvg[\\[{]&#34;</span> <span class="o">.</span> <span class="nv">svg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;\\\\(\\|\\\\\\[\\|\\\\begin{\\(?:math\\|displaymath\\|equation\\|align\\|flalign\\|multiline\\|gather\\)[a-z]*\\*?}&#34;</span> <span class="o">.</span> <span class="nv">maths</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*|&#34;</span> <span class="o">.</span> <span class="nv">table</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;cref:\\|\\cref{\\|\\[\\[[^\\]+\n?[^\\]\\]\\]&#34;</span> <span class="o">.</span> <span class="nv">cleveref</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;[;\\\\]?\\b[A-Z][A-Z]+s?[^A-Za-z]&#34;</span> <span class="o">.</span> <span class="nv">acronym</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;\\+[^ ].*[^ ]\\+\\|_[^ ].*[^ ]_\\|\\\\uu?line\\|\\\\uwave\\|\\\\sout\\|\\\\xout\\|\\\\dashuline\\|\\dotuline\\|\\markoverwith&#34;</span> <span class="o">.</span> <span class="nv">underline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;:float wrap&#34;</span> <span class="o">.</span> <span class="nv">float-wrap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;:float sideways&#34;</span> <span class="o">.</span> <span class="nv">rotate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*#\\+caption:\\|\\\\caption&#34;</span> <span class="o">.</span> <span class="nv">caption</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;\\[\\[xkcd:&#34;</span> <span class="o">.</span> <span class="p">(</span><span class="nv">image</span> <span class="nv">caption</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">((</span><span class="nb">and</span> <span class="nv">org-latex-italic-quotes</span> <span class="s">&#34;^[ \t]*#\\+begin_quote\\|\\\\begin{quote}&#34;</span><span class="p">)</span> <span class="o">.</span> <span class="nv">italic-quotes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-latex-par-sep</span> <span class="o">.</span> <span class="nv">par-sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*\\(?:[-+*]\\|[0-9]+[.)]\\|[A-Za-z]+[.)]\\) \\[[ -X]\\]&#34;</span> <span class="o">.</span> <span class="nv">checkbox</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*#\\+begin_warning\\|\\\\begin{warning}&#34;</span> <span class="o">.</span> <span class="nv">box-warning</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*#\\+begin_info\\|\\\\begin{info}&#34;</span>       <span class="o">.</span> <span class="nv">box-info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*#\\+begin_notes\\|\\\\begin{notes}&#34;</span>     <span class="o">.</span> <span class="nv">box-notes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*#\\+begin_success\\|\\\\begin{success}&#34;</span> <span class="o">.</span> <span class="nv">box-success</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s">&#34;^[ \t]*#\\+begin_error\\|\\\\begin{error}&#34;</span>     <span class="o">.</span> <span class="nv">box-error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Org feature tests and associated LaTeX feature flags.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Alist where the car is a test for the presense of the feature,
</span></span></span><span class="line"><span class="cl"><span class="s">and the cdr is either a single feature symbol or list of feature symbols.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">When a string, it is used as a regex search in the buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">The feature is registered as present when there is a match.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">The car can also be a
</span></span></span><span class="line"><span class="cl"><span class="s">- symbol, the value of which is fetched
</span></span></span><span class="line"><span class="cl"><span class="s">- function, which is called with info as an argument
</span></span></span><span class="line"><span class="cl"><span class="s">- list, which is </span><span class="ss">`eval&#39;</span><span class="s">uated
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">If the symbol, function, or list produces a string: that is used as a regex
</span></span></span><span class="line"><span class="cl"><span class="s">search in the buffer. Otherwise any non-nil return value will indicate the
</span></span></span><span class="line"><span class="cl"><span class="s">existance of the feature.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后我们提供一种方法来生成提供这些功能的序言。除了
<code>org-latex-conditional-features</code> 中命名的特性之外，我们还将创建元特性，这些特性可能是其他特性所需要的 (<code>:requires</code>)，或者默认情况下是启用的
(<code>:eager t</code>)。为了进一步控制，我只能在某些其他功能处于启用状态 (<code>:when</code>) 并被其他功能屏蔽 (<code>:prevents</code>) 时使用某些功能。我将使用以 <code>.</code> 开头的元功能的约定，以及以 <code>!</code> 开头的 <code>:eager</code> 功能，使它们的性质更明显。</p>
<p>LaTeX 中的另一个考虑因素是加载顺序，这在某些情况下很重要。除此之外，有某种合理的排序是很好的。为此我将介绍一个 <code>:order</code> 关键字。使用它将按如下方式排列片段。</p>
<ul>
<li>
<p><code>-2</code> 嵌入文件设置</p>
</li>
<li>
<p><code>-1</code> 额外的文件嵌入</p>
</li>
<li>
<p><code>0</code> 排版</p>
<ul>
<li><code>0</code> 字体本身</li>
</ul>
<!--listend-->
<ul>
<li><code>0.2</code> 数学设置</li>
<li><code>0.3</code> 数学字体</li>
<li><code>0.4</code> 额外的文字整形 (<code>\acr</code>)</li>
<li><code>0.5-0.9</code> 其他文本修改，尝试将较短的片段放在首位</li>
</ul>
</li>
<li>
<p><code>1</code> (<em>default</em>)</p>
</li>
<li>
<p><code>2</code> 表和图</p>
</li>
<li>
<p><code>3</code> 其他短内容</p>
</li>
<li>
<p><code>4</code> 各种 boxes</p>
</li>
</ul>
 <!--listend-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-feature-implementations</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">((</span><span class="nv">image</span>         <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{graphicx}&#34;</span> <span class="nb">:order</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">svg</span>           <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage[inkscapelatex=false]{svg}&#34;</span> <span class="nb">:order</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">maths</span>         <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{amsmath,amsxtra,amsfonts,amssymb,amsthm,mathtools,upgreek,extarrows}\n\\usepackage[math-style=ISO]{unicode-math}&#34;</span> <span class="nb">:order</span> <span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">table</span>         <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{longtable}\n\\usepackage{booktabs}&#34;</span> <span class="nb">:order</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">cleveref</span>      <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage[capitalize]{cleveref}&#34;</span> <span class="nb">:order</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">; after bmc-maths</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">underline</span>     <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage[normalem]{ulem}&#34;</span> <span class="nb">:order</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">float-wrap</span>    <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{wrapfig}&#34;</span> <span class="nb">:order</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">rotate</span>        <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{rotating}&#34;</span> <span class="nb">:order</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">caption</span>       <span class="nb">:snippet</span> <span class="nv">org-latex-caption-preamble</span> <span class="nb">:order</span> <span class="mf">2.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; (microtype     :snippet &#34;\\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000]{microtype}\n&#34; :order 0.1)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">acronym</span>       <span class="nb">:snippet</span> <span class="s">&#34;\\newcommand{\\acr}[1]{\\protect\\textls*[110]{\\scshape #1}}\n\\newcommand{\\acrs}{\\protect\\scalebox{.91}[.84]{\\hspace{0.15ex}s}}&#34;</span> <span class="nb">:order</span> <span class="mf">0.4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">italic-quotes</span> <span class="nb">:snippet</span> <span class="s">&#34;\\renewcommand{\\quote}{\\list{}{\\rightmargin\\leftmargin}\\item\\relax\\em}\n&#34;</span> <span class="nb">:order</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">par-sep</span>       <span class="nb">:snippet</span> <span class="s">&#34;\\setlength{\\parskip}{\\baselineskip}\n\\setlength{\\parindent}{0pt}\n&#34;</span> <span class="nb">:order</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">.</span><span class="nv">pifont</span>       <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{pifont}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">.</span><span class="nv">xcoffins</span>     <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{xcoffins}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">checkbox</span>      <span class="nb">:requires</span> <span class="o">.</span><span class="nv">pifont</span> <span class="nb">:order</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">		   <span class="nb">:snippet</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">memq</span> <span class="ss">&#39;maths</span> <span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				      <span class="s">&#34;\\usepackage{amssymb} % provides \\square&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="nv">org-latex-checkbox-preamble</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">.</span><span class="nv">fancy-box</span>    <span class="nb">:requires</span> <span class="p">(</span><span class="o">.</span><span class="nv">pifont</span> <span class="o">.</span><span class="nv">xcoffins</span><span class="p">)</span> <span class="nb">:snippet</span> <span class="nv">org-latex-box-preamble</span> <span class="nb">:order</span> <span class="mf">3.9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">box-warning</span>   <span class="nb">:requires</span> <span class="o">.</span><span class="nv">fancy-box</span> <span class="nb">:snippet</span> <span class="s">&#34;\\defsimplebox{warning}{e66100}{Warning}&#34;</span> <span class="nb">:order</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">box-info</span>      <span class="nb">:requires</span> <span class="o">.</span><span class="nv">fancy-box</span> <span class="nb">:snippet</span> <span class="s">&#34;\\defsimplebox{info}{3584e4}{Information}&#34;</span> <span class="nb">:order</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">box-notes</span>     <span class="nb">:requires</span> <span class="o">.</span><span class="nv">fancy-box</span> <span class="nb">:snippet</span> <span class="s">&#34;\\defsimplebox{notes}{26a269}{Notes}&#34;</span> <span class="nb">:order</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">box-success</span>   <span class="nb">:requires</span> <span class="o">.</span><span class="nv">fancy-box</span> <span class="nb">:snippet</span> <span class="s">&#34;\\defsimplebox{success}{26a269}{\\vspace{-\\baselineskip}}&#34;</span> <span class="nb">:order</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">box-error</span>     <span class="nb">:requires</span> <span class="o">.</span><span class="nv">fancy-box</span> <span class="nb">:snippet</span> <span class="s">&#34;\\defsimplebox{error}{c01c28}{Important}&#34;</span> <span class="nb">:order</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;LaTeX features and details required to implement them.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">List where the car is the feature symbol, and the rest forms a plist with the
</span></span></span><span class="line"><span class="cl"><span class="s">following keys:
</span></span></span><span class="line"><span class="cl"><span class="s">- :snippet, which may be either
</span></span></span><span class="line"><span class="cl"><span class="s">  - a string which should be included in the preamble
</span></span></span><span class="line"><span class="cl"><span class="s">  - a symbol, the value of which is included in the preamble
</span></span></span><span class="line"><span class="cl"><span class="s">  - a function, which is evaluated with the list of feature flags as its
</span></span></span><span class="line"><span class="cl"><span class="s">    single argument. The result of which is included in the preamble
</span></span></span><span class="line"><span class="cl"><span class="s">  - a list, which is passed to </span><span class="ss">`eval&#39;</span><span class="s">, with a list of feature flags available
</span></span></span><span class="line"><span class="cl"><span class="s">    as \&#34;features\&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">- :requires, a feature or list of features that must be available
</span></span></span><span class="line"><span class="cl"><span class="s">- :when, a feature or list of features that when all available should cause this
</span></span></span><span class="line"><span class="cl"><span class="s">    to be automatically enabled.
</span></span></span><span class="line"><span class="cl"><span class="s">- :prevents, a feature or list of features that should be masked
</span></span></span><span class="line"><span class="cl"><span class="s">- :order, for when ordering is important. Lower values appear first.
</span></span></span><span class="line"><span class="cl"><span class="s">    The default is 0.
</span></span></span><span class="line"><span class="cl"><span class="s">- :eager, when non-nil the feature will be eagerly loaded, i.e. without being detected.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
 <!--list-separator-->
<ul>
<li>
<p>特征确定</p>
<p>现在我们已经定义了 <code>org-latex-conditional-features</code> ，我们需要使用它来提取在 Org 缓冲区中找到的特征列表。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-detect-features</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">buffer</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;List features from </span><span class="ss">`org-latex-conditional-features&#39;</span><span class="s"> detected in BUFFER.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">case-fold-search</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">delete-dups</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">mapcan</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">construct-feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">out</span> <span class="p">(</span><span class="nb">pcase</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">construct-feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="p">((</span><span class="nv">pred</span> <span class="nf">stringp</span><span class="p">)</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">construct-feature</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				    <span class="p">((</span><span class="nv">pred</span> <span class="nf">functionp</span><span class="p">)</span> <span class="p">(</span><span class="nf">funcall</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">construct-feature</span><span class="p">)</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				    <span class="p">((</span><span class="nv">pred</span> <span class="nf">listp</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">construct-feature</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">				    <span class="p">((</span><span class="nv">pred</span> <span class="nf">symbolp</span><span class="p">)</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">construct-feature</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">				    <span class="p">(</span><span class="nv">_</span> <span class="p">(</span><span class="ne">user-error</span> <span class="s">&#34;org-latex-conditional-features key %s unable to be used&#34;</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">construct-feature</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">			 <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">			       <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			       <span class="p">(</span><span class="nf">re-search-forward</span> <span class="nv">out</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			   <span class="nv">out</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">listp</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">construct-feature</span><span class="p">))</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">construct-feature</span><span class="p">)</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">construct-feature</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">	       <span class="nv">org-latex-conditional-features</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
 <!--list-separator-->
<ul>
<li>
<p>序言生成</p>
<p>一旦确定了所需功能的列表，我们希望使用 <code>org-latex-feature-implementations</code>
来生成 LaTeX，该 LaTeX 应该插入到序言中以提供这些功能。</p>
<p>首先，我们要在 <code>org-latex-feature-implementations</code> 中处理我们的关键字，以生成扩展的功能列表。我们将通过执行以下步骤来做到这一点。</p>
<ul>
<li>每个列出的功能的依赖项都添加到功能列表 (<code>:requires</code>) 中。</li>
<li>每个特性的 <code>:when</code> 条件，以及带有 <code>:eager t</code> 的可用特性，都会被评估，并相应地添加 / 删除</li>
<li><code>:prevents</code> 值中存在的任何特性都将被删除</li>
<li>功能列表清除重复项</li>
<li>特征列表按 <code>:order</code> (升序) 排序</li>
</ul>
 <!--listend-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-expand-features</span> <span class="p">(</span><span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;For each feature in FEATURES process :requires, :when, and :prevents keywords and sort according to :order.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">feature</span> <span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">feature</span> <span class="nv">org-latex-feature-implementations</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Feature %s not provided in org-latex-feature-implementations, ignoring.&#34;</span> <span class="nv">feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">features</span> <span class="p">(</span><span class="nv">remove</span> <span class="nv">feature</span> <span class="nv">features</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">current</span> <span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">while</span> <span class="nv">current</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">requirements</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assq</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">current</span><span class="p">)</span> <span class="nv">org-latex-feature-implementations</span><span class="p">))</span> <span class="nb">:requires</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">setcdr</span> <span class="nv">current</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">listp</span> <span class="nv">requirements</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nf">append</span> <span class="nv">requirements</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">current</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nf">cons</span> <span class="nv">requirements</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">current</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">current</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">current</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">potential-feature</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">append</span> <span class="nv">features</span> <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">feat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">						<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">feat</span><span class="p">)</span> <span class="nb">:eager</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">						  <span class="p">(</span><span class="nf">car</span> <span class="nv">feat</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">					      <span class="nv">org-latex-feature-implementations</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">prerequisites</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">potential-feature</span> <span class="nv">org-latex-feature-implementations</span><span class="p">))</span> <span class="nb">:when</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setf</span> <span class="nv">features</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">listp</span> <span class="nv">prerequisites</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="nv">cl-every</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">preq</span><span class="p">)</span> <span class="p">(</span><span class="nf">memq</span> <span class="nv">preq</span> <span class="nv">features</span><span class="p">))</span> <span class="nv">prerequisites</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="nf">memq</span> <span class="nv">prerequisites</span> <span class="nv">features</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			 <span class="p">(</span><span class="nf">append</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">potential-feature</span><span class="p">)</span> <span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		       <span class="p">(</span><span class="nf">delq</span> <span class="nv">potential-feature</span> <span class="nv">features</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">feature</span> <span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">prevents</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">feature</span> <span class="nv">org-latex-feature-implementations</span><span class="p">))</span> <span class="nb">:prevents</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setf</span> <span class="nv">features</span> <span class="p">(</span><span class="nv">cl-set-difference</span> <span class="nv">features</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">listp</span> <span class="nv">prevents</span><span class="p">)</span> <span class="nv">prevents</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">prevents</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">sort</span> <span class="p">(</span><span class="nv">delete-dups</span> <span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">feat1</span> <span class="nv">feat2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&lt;</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">feat1</span> <span class="nv">org-latex-feature-implementations</span><span class="p">))</span> <span class="nb">:order</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">feat2</span> <span class="nv">org-latex-feature-implementations</span><span class="p">))</span> <span class="nb">:order</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	      <span class="no">t</span> <span class="no">nil</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们有一个很好的最终要使用的特性列表，可以提取它们的片段并将结果连接在一起。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-generate-features-preamble</span> <span class="p">(</span><span class="nv">features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Generate the LaTeX preamble content required to provide FEATURES.
</span></span></span><span class="line"><span class="cl"><span class="s">This is done according to </span><span class="ss">`org-latex-feature-implementations&#39;</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">expanded-features</span> <span class="p">(</span><span class="nv">org-latex-expand-features</span> <span class="nv">features</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\n%% features: %s\n&#34;</span> <span class="nv">expanded-features</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">mapconcat</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">snippet</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">feature</span> <span class="nv">org-latex-feature-implementations</span><span class="p">))</span> <span class="nb">:snippet</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">		     <span class="p">(</span><span class="nb">pcase</span> <span class="nv">snippet</span>
</span></span><span class="line"><span class="cl">		       <span class="p">((</span><span class="nv">pred</span> <span class="nf">stringp</span><span class="p">)</span> <span class="nv">snippet</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		       <span class="p">((</span><span class="nv">pred</span> <span class="nf">functionp</span><span class="p">)</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">snippet</span> <span class="nv">features</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		       <span class="p">((</span><span class="nv">pred</span> <span class="nf">listp</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval</span> <span class="o">`</span><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">features</span> <span class="ss">&#39;,features</span><span class="p">))</span> <span class="p">(</span><span class="o">,@</span><span class="nv">snippet</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">		       <span class="p">((</span><span class="nv">pred</span> <span class="nf">symbolp</span><span class="p">)</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="nv">snippet</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		       <span class="p">(</span><span class="nv">_</span> <span class="p">(</span><span class="ne">user-error</span> <span class="s">&#34;org-latex-feature-implementations :snippet value %s unable to be used&#34;</span> <span class="nv">snippet</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		     <span class="s">&#34;\n&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		<span class="nv">expanded-features</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;% end features\n&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后需要建议 Org 实际使用这个生成的前导内容。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">info--tmp</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-latex-save-info</span> <span class="p">(</span><span class="nv">info</span> <span class="kp">&amp;optional</span> <span class="nv">t_</span> <span class="nv">s_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">org-latex-make-preamble</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">info--tmp</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-splice-latex-header-and-generated-preamble-a</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">tpl</span> <span class="nv">def-pkg</span> <span class="nv">pkg</span> <span class="nv">snippets-p</span> <span class="kp">&amp;optional</span> <span class="nv">extra</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Dynamically insert preamble content based on </span><span class="ss">`org-latex-conditional-preambles&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-splice-latex-header</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">header</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">tpl</span> <span class="nv">def-pkg</span> <span class="nv">pkg</span> <span class="nv">snippets-p</span> <span class="nv">extra</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">snippets-p</span> <span class="nv">header</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">concat</span> <span class="nv">header</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nv">org-latex-generate-features-preamble</span> <span class="p">(</span><span class="nv">org-latex-detect-features</span> <span class="no">nil</span> <span class="nv">info--tmp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;\n&#34;</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我对 <code>info--tmp</code> 的使用有点老套。 当我尝试将其上游化时，这应该会变得更加清晰，因为我可以通过直接修改 <code>org-latex-make-preamble</code> 来传递信息。</p>
</li>
</ul>
 <!--list-separator-->
<ul>
<li>
<p>减少默认包</p>
<p>由于上文添加，我们可以从 <code>org-latex-default-packages-alist</code> 中删除一些包。</p>
<p>默认值中也有一些过时的条目，具体来说</p>
<ul>
<li><code>grffile</code> 的功能内置于当前版本的 <code>graphicsx</code></li>
<li><code>textcomp</code> 的功能已经包含在 LaTeX 的核心中一段时间了</li>
</ul>
 <!--listend-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-latex-default-packages-alist</span>
</span></span><span class="line"><span class="cl">       <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;AUTO&#34;</span> <span class="s">&#34;inputenc&#34;</span> <span class="no">t</span> <span class="p">(</span><span class="s">&#34;pdflatex&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;T1&#34;</span> <span class="s">&#34;fontenc&#34;</span> <span class="no">t</span> <span class="p">(</span><span class="s">&#34;pdflatex&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;&#34;</span> <span class="s">&#34;xcolor&#34;</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">; Generally useful</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;&#34;</span> <span class="s">&#34;hyperref&#34;</span> <span class="no">nil</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>字体</p>
<p>中文字体不在设置之列，毕竟 <code>xeCJK</code> 是 <code>xelatex</code> 专有的包，而 <code>pdftex</code> 和
<code>luatex</code> 而且 texlive 并没有将相应的中文字体打包，这给设置中文字体带来一些不便。可以采用手动设置的方式，比如以下采用 <code>xeCJK</code> 的方式设置 Source CJK Family。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#+latex_compiler: xelatex
</span></span><span class="line"><span class="cl">#+latex_header: \usepackage{xeCJK}
</span></span><span class="line"><span class="cl">#+latex_header: \setCJKmainfont{Source Han Serif SC}
</span></span><span class="line"><span class="cl">#+latex_header: \setCJKsansfont{Source Han Sans SC}
</span></span><span class="line"><span class="cl">#+latex_header: \setCJKmonofont{Source Han Mono SC}
</span></span></code></pre></td></tr></table>
</div>
</div><p>首先，将创建一个默认状态变量并将字体集注册为 <code>#+options</code> 的一部分。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-default-fontset</span> <span class="ss">&#39;alegreya</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Fontset from </span><span class="ss">`org-latex-fontsets&#39;</span><span class="s"> to use by default.
</span></span></span><span class="line"><span class="cl"><span class="s">As cm (computer modern) is TeX&#39;s default, that causes nothing
</span></span></span><span class="line"><span class="cl"><span class="s">to be added to the document.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">If \&#34;nil\&#34; no custom fonts will ever be used.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">eval</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">cl-pushnew</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:latex-font-set</span> <span class="no">nil</span> <span class="s">&#34;fontset&#34;</span> <span class="nv">org-latex-default-fontset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">org-export-backend-options</span> <span class="p">(</span><span class="nv">org-export-get-backend</span> <span class="ss">&#39;latex</span><span class="p">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后需要一个函数来生成应用字体集的 LaTeX 片段。如果可以为单个样式完成此操作并使用不同样式作为主要文档字体，那就太好了。如果字体集的各个字体分别定义为
<code>:serif</code>、<code>:sans</code>、<code>:mono</code> 和 <code>:maths}</code>。 我可以使用它们为完整字体集的子集生成
LaTeX。然后，如果我不让任何字体集名称中包含 <code>-</code>，我可以使用 <code>-sans</code> 和 <code>-mono</code>
作为指定要使用的文档字体的后缀。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-fontset-entry</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get the fontset spec of the current file.
</span></span></span><span class="line"><span class="cl"><span class="s">Has format \&#34;name\&#34; or \&#34;name-style\&#34; where &#39;name&#39; is one of
</span></span></span><span class="line"><span class="cl"><span class="s">the cars in </span><span class="ss">`org-latex-fontsets&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">fontset-spec</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">symbol-name</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">			 <span class="p">(</span><span class="nf">mapcar</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">opt-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			    <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nv">org-export--parse-option-keyword</span> <span class="nv">opt-line</span> <span class="ss">&#39;latex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				       <span class="nb">:latex-font-set</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nv">cdar</span> <span class="p">(</span><span class="nv">org-collect-keywords</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;OPTIONS&#34;</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">	      <span class="nv">org-latex-default-fontset</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">fontset-spec</span> <span class="s">&#34;-&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">fontset-spec</span> <span class="s">&#34;-&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;:&#34;</span> <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">fontset-spec</span> <span class="s">&#34;-&#34;</span><span class="p">))))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-fontset</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">desired-styles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Generate a LaTeX preamble snippet which applies the current fontset for DESIRED-STYLES.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">fontset-spec</span> <span class="p">(</span><span class="nv">org-latex-fontset-entry</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">fontset</span> <span class="p">(</span><span class="nv">alist-get</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">fontset-spec</span><span class="p">)</span> <span class="nv">org-latex-fontsets</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">fontset</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">mapconcat</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">style</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">fontset</span> <span class="nv">style</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">fontset</span> <span class="nv">style</span><span class="p">)</span> <span class="s">&#34;\n&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">desired-styles</span>
</span></span><span class="line"><span class="cl">	  <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">memq</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">fontset-spec</span><span class="p">)</span> <span class="nv">desired-styles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nb">pcase</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">fontset-spec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">:serif</span> <span class="s">&#34;\\renewcommand{\\familydefault}{\\rmdefault}\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">:sans</span> <span class="s">&#34;\\renewcommand{\\familydefault}{\\sfdefault}\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">:mono</span> <span class="s">&#34;\\renewcommand{\\familydefault}{\\ttdefault}\n&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Font-set %s is not provided in org-latex-fontsets&#34;</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">fontset-spec</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在所有的功能都已经实现了，我们应该把它挂到我们的序言生成中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-conditional-features</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-latex-default-fontset</span> <span class="o">.</span> <span class="nv">custom-font</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-feature-implementations</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">custom-font</span> <span class="nb">:snippet</span> <span class="p">(</span><span class="nv">org-latex-fontset</span> <span class="nb">:serif</span> <span class="nb">:sans</span> <span class="nb">:mono</span><span class="p">)</span> <span class="nb">:order</span> <span class="mi">0</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-feature-implementations</span> <span class="o">&#39;</span><span class="p">(</span><span class="o">.</span><span class="nv">custom-maths-font</span> <span class="nb">:eager</span> <span class="no">t</span> <span class="nb">:when</span> <span class="p">(</span><span class="nv">custom-font</span> <span class="nv">maths</span><span class="p">)</span> <span class="nb">:snippet</span> <span class="p">(</span><span class="nv">org-latex-fontset</span> <span class="nb">:maths</span><span class="p">)</span> <span class="nb">:order</span> <span class="mf">0.3</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，我们只需要添加一些字体。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-fontsets</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">((</span><span class="nv">cm</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">; computer modern</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="err">##</span> <span class="no">nil</span><span class="p">)</span> <span class="c1">; no font set</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">alegreya</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage[osf]{Alegreya}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage{AlegreyaSans}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.88]{sourcecodepro}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{newtxsf}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">biolinum</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage[osf]{libertineRoman}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage[sfdefault,osf]{biolinum}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.88]{sourcecodepro}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{newtxsf}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">fira</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage[sfdefault,scale=0.85]{FiraSans}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.80]{FiraMono}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{newtxsf} % change to firamath in future?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">kp</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage{kpfonts}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">newpx</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage{newpxtext}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage{gillius}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.9]{sourcecodepro}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage[varbb]{newpxmath}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">noto</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage[osf]{noto-serif}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage[osf]{noto-sans}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.96]{noto-mono}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{notomath}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">plex</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage{plex-serif}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage{plex-sans}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.95]{plex-mono}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{newtxmath}&#34;</span><span class="p">)</span> <span class="c1">; may be plex-based in future</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">source</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage[osf,semibold]{sourceserifpro}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:sans</span> <span class="s">&#34;\\usepackage[osf,semibold]{sourcesanspro}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:mono</span> <span class="s">&#34;\\usepackage[scale=0.92]{sourcecodepro}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{newtxmath}&#34;</span><span class="p">)</span> <span class="c1">; may be sourceserifpro-based in future</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">times</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:serif</span> <span class="s">&#34;\\usepackage{newtxtext}&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">:maths</span> <span class="s">&#34;\\usepackage{newtxmath}&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Alist of fontset specifications.
</span></span></span><span class="line"><span class="cl"><span class="s">Each car is the name of the fontset (which cannot include \&#34;-\&#34;).
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Each cdr is a plist with (optional) keys :serif, :sans, :mono, and :maths.
</span></span></span><span class="line"><span class="cl"><span class="s">A key&#39;s value is a LaTeX snippet which loads such a font.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>封面</p>
<p>要制作漂亮的封面，想到的一个简单方法就是重新定义 <code>\maketitle</code> 。为了精确控制定位，我们将使用 <code>tikz</code> 包，然后添加 Tikz 库 <code>calc</code> 和 <code>shape.geometric</code> 来为背景做一些漂亮的装饰。</p>
<p>首先为序言设置必要的补充。 这将完成以下任务：</p>
<ul>
<li>加载所需的包</li>
<li>重新定义 <code>\maketitle</code></li>
<li>用 Tikz 画一个 <code>Org</code> 图标，用在封面上 (这是一个小彩蛋)</li>
<li>通过重新定义 <code>\tableofcontents</code> 在目录之后开始一个新页面</li>
</ul>
 <!--listend-->
<p><a id="code-snippet--latex-cover-page"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>usepackage<span class="nb">{</span>tikz<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>usetikzlibrary<span class="nb">{</span>shapes.geometric<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>usetikzlibrary<span class="nb">{</span>calc<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\\</span>newsavebox<span class="k">\\</span>orgicon
</span></span><span class="line"><span class="cl"><span class="k">\\</span>begin<span class="nb">{</span>lrbox<span class="nb">}{</span><span class="k">\\</span>orgicon<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>begin<span class="nb">{</span>tikzpicture<span class="nb">}</span>[y=0.80pt, x=0.80pt, inner sep=0pt, outer sep=0pt]
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>path[fill=black!6] (16.15,24.00) .. controls (15.58,24.00) and (13.99,20.69) .. (12.77,18.06)arc(215.55:180.20:2.19) .. controls (12.33,19.91) and (11.27,19.09) .. (11.43,18.05) .. controls (11.36,18.09) and (10.17,17.83) .. (10.17,17.82) .. controls (9.94,18.75) and (9.37,19.44) .. (9.02,18.39) .. controls (8.32,16.72) and (8.14,15.40) .. (9.13,13.80) .. controls (8.22,9.74) and (2.18,7.75) .. (2.81,4.47) .. controls (2.99,4.47) and (4.45,0.99) .. (9.15,2.41) .. controls (14.71,3.99) and (17.77,0.30) .. (18.13,0.04) .. controls (18.65,-0.49) and (16.78,4.61) .. (12.83,6.90) .. controls (10.49,8.18) and (11.96,10.38) .. (12.12,11.15) .. controls (12.12,11.15) and (14.00,9.84) .. (15.36,11.85) .. controls (16.58,11.53) and (17.40,12.07) .. (18.46,11.69) .. controls (19.10,11.41) and (21.79,11.58) .. (20.79,13.08) .. controls (20.79,13.08) and (21.71,13.90) .. (21.80,13.99) .. controls (21.97,14.75) and (21.59,14.91) .. (21.47,15.12) .. controls (21.44,15.60) and (21.04,15.79) .. (20.55,15.44) .. controls (19.45,15.64) and (18.36,15.55) .. (17.83,15.59) .. controls (16.65,15.76) and (15.67,16.38) .. (15.67,16.38) .. controls (15.40,17.19) and (14.82,17.01) .. (14.09,17.32) .. controls (14.70,18.69) and (14.76,19.32) .. (15.50,21.32) .. controls (15.76,22.37) and (16.54,24.00) .. (16.15,24.00) -- cycle(7.83,16.74) .. controls (6.83,15.71) and (5.72,15.70) .. (4.05,15.42) .. controls (2.75,15.19) and (0.39,12.97) .. (0.02,10.68) .. controls (-0.02,10.07) and (-0.06,8.50) .. (0.45,7.18) .. controls (0.94,6.05) and (1.27,5.45) .. (2.29,4.85) .. controls (1.41,8.02) and (7.59,10.18) .. (8.55,13.80) -- (8.55,13.80) .. controls (7.73,15.00) and (7.80,15.64) .. (7.83,16.74) -- cycle;
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>end<span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>end<span class="nb">{</span>lrbox<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\\</span>makeatletter
</span></span><span class="line"><span class="cl"><span class="k">\\</span>renewcommand<span class="k">\\</span>maketitle<span class="nb">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>thispagestyle<span class="nb">{</span>empty<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>hyphenpenalty=10000 <span class="c">% hyphens look bad in titles
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\\</span>renewcommand<span class="nb">{</span><span class="k">\\</span>baselinestretch<span class="nb">}{</span>1.1<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>let<span class="k">\\</span>oldtoday<span class="k">\\</span>today
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>renewcommand<span class="nb">{</span><span class="k">\\</span>today<span class="nb">}{</span><span class="k">\\</span>LARGE<span class="k">\\</span>number<span class="k">\\</span>year<span class="k">\\\\\\</span>large<span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>ifcase <span class="k">\\</span>month <span class="k">\\</span>or Jan<span class="k">\\</span>or Feb<span class="k">\\</span>or Mar<span class="k">\\</span>or Apr<span class="k">\\</span>or May <span class="k">\\</span>or Jun<span class="k">\\</span>or Jul<span class="k">\\</span>or Aug<span class="k">\\</span>or Sep<span class="k">\\</span>or Oct<span class="k">\\</span>or Nov<span class="k">\\</span>or Dec<span class="k">\\</span>fi
</span></span><span class="line"><span class="cl">    ~<span class="k">\\</span>number<span class="k">\\</span>day<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>begin<span class="nb">{</span>tikzpicture<span class="nb">}</span>[remember picture,overlay]
</span></span><span class="line"><span class="cl">    <span class="c">%% Background Polygons %%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>foreach <span class="k">\\</span>i in <span class="nb">{</span>2.5,...,22<span class="nb">}</span> <span class="c">% bottom left
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="nb">{</span><span class="k">\\</span>node[rounded corners,black!3.5,draw,regular polygon,regular polygon sides=6, minimum size=<span class="k">\\</span>i cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.west</span><span class="o">)+(</span><span class="m">2</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="o">-</span><span class="m">4</span><span class="nb">.</span><span class="m">2</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span> ;<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>foreach <span class="k">\\</span>i in <span class="nb">{</span>0.5,...,22<span class="nb">}</span> <span class="c">% top left
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="nb">{</span><span class="k">\\</span>node[rounded corners,black!5,draw,regular polygon,regular polygon sides=6, minimum size=<span class="k">\\</span>i cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.north west</span><span class="o">)+(</span><span class="m">2</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="m">2</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span> ;<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>node[rounded corners,fill=black!4,regular polygon,regular polygon sides=6, minimum size=5.5 cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.north west</span><span class="o">)+(</span><span class="m">2</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="m">2</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>foreach <span class="k">\\</span>i in <span class="nb">{</span>0.5,...,24<span class="nb">}</span> <span class="c">% top right
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="nb">{</span><span class="k">\\</span>node[rounded corners,black!2,draw,regular polygon,regular polygon sides=6, minimum size=<span class="k">\\</span>i cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.north east</span><span class="o">)+(</span><span class="m">0</span><span class="nb">,</span><span class="o">-</span><span class="m">8</span><span class="nb">.</span><span class="m">5</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span> ;<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>node[fill=black!3,rounded corners,regular polygon,regular polygon sides=6, minimum size=2.5 cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.north east</span><span class="o">)+(</span><span class="m">0</span><span class="nb">,</span><span class="o">-</span><span class="m">8</span><span class="nb">.</span><span class="m">5</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>foreach <span class="k">\\</span>i in <span class="nb">{</span>21,...,3<span class="nb">}</span> <span class="c">% bottom right
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="nb">{</span><span class="k">\\</span>node[black!3,rounded corners,draw,regular polygon,regular polygon sides=6, minimum size=<span class="k">\\</span>i cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.south east</span><span class="o">)+(-</span><span class="m">1</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="m">0</span><span class="nb">.</span><span class="m">75</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span> ;<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>node[fill=black!3,rounded corners,regular polygon,regular polygon sides=6, minimum size=2 cm,ultra thick] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.south east</span><span class="o">)+(-</span><span class="m">1</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="m">0</span><span class="nb">.</span><span class="m">75</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>node[align=center, scale=1.4] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.south east</span><span class="o">)+(-</span><span class="m">1</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="m">0</span><span class="nb">.</span><span class="m">75</span><span class="o">)</span><span class="s">$</span>) <span class="nb">{</span><span class="k">\\</span>usebox<span class="k">\\</span>orgicon<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="c">%% Text %%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\\</span>node[left, align=right, black, text width=0.8<span class="k">\\</span>paperwidth, minimum height=3cm, rounded corners,font=<span class="k">\\</span>Huge<span class="k">\\</span>bfseries] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.north east</span><span class="o">)+(-</span><span class="m">2</span><span class="nb">,</span><span class="o">-</span><span class="m">8</span><span class="nb">.</span><span class="m">5</span><span class="o">)</span><span class="s">$</span>)
</span></span><span class="line"><span class="cl">    <span class="nb">{</span><span class="k">\\</span>@title<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>node[left, align=right, black, text width=0.8<span class="k">\\</span>paperwidth, minimum height=2cm, rounded corners, font=<span class="k">\\</span>Large] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.north east</span><span class="o">)+(-</span><span class="m">2</span><span class="nb">,</span><span class="o">-</span><span class="m">11</span><span class="nb">.</span><span class="m">8</span><span class="o">)</span><span class="s">$</span>)
</span></span><span class="line"><span class="cl">    <span class="nb">{</span><span class="k">\\</span>scshape <span class="k">\\</span>@author<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>renewcommand<span class="nb">{</span><span class="k">\\</span>baselinestretch<span class="nb">}{</span>0.75<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>node[align=center,rounded corners,fill=black!3,text=black,regular polygon,regular polygon sides=6, minimum size=2.5 cm,inner sep=0, font=<span class="k">\\</span>Large<span class="k">\\</span>bfseries ] at (<span class="s">$</span><span class="o">(</span><span class="nb">current page.west</span><span class="o">)+(</span><span class="m">2</span><span class="nb">.</span><span class="m">5</span><span class="nb">,</span><span class="o">-</span><span class="m">4</span><span class="nb">.</span><span class="m">2</span><span class="o">)</span><span class="s">$</span>)
</span></span><span class="line"><span class="cl">    <span class="nb">{</span><span class="k">\\</span>@date<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>end<span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>let<span class="k">\\</span>today<span class="k">\\</span>oldtoday
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>clearpage<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>makeatother
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们有了一个不错的封面页，我们只需要不时使用它。将此添加到 <code>#+options</code> 感觉最合适。让封面选项接受 auto 作为值，然后根据字数决定是否应使用封面。然后我们只想插入一个 LaTeX 片段在封面中来调整标题格式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-cover-page</span> <span class="ss">&#39;auto</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;When t, use a cover page by default.
</span></span></span><span class="line"><span class="cl"><span class="s">When auto, use a cover page when the document&#39;s wordcount exceeds
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="ss">`org-latex-cover-page-wordcount-threshold&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Set with #+option: coverpage:{yes,auto,no} in org buffers.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-cover-page-wordcount-threshold</span> <span class="mi">5000</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Document word count at which a cover page will be used automatically.
</span></span></span><span class="line"><span class="cl"><span class="s">This condition is applied when cover page option is set to auto.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-subtitle-coverpage-format</span> <span class="s">&#34;\\\\\\bigskip\n\\LARGE\\mdseries\\itshape\\color{black!80} %s\\par&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Variant of </span><span class="ss">`org-latex-subtitle-format&#39;</span><span class="s"> to use with the cover page.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-latex-cover-page-maketitle</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;latex-cover-page&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;LaTeX snippet for the preamble that sets \\maketitle to produce a cover page.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">eval</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">cl-pushnew</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:latex-cover-page</span> <span class="no">nil</span> <span class="s">&#34;coverpage&#34;</span> <span class="nv">org-latex-cover-page</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">org-export-backend-options</span> <span class="p">(</span><span class="nv">org-export-get-backend</span> <span class="ss">&#39;latex</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-cover-page-p</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Whether a cover page should be used when exporting this Org file.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">pcase</span> <span class="p">(</span><span class="nf">car</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nf">delq</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nf">mapcar</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">opt-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">plist-get</span> <span class="p">(</span><span class="nv">org-export--parse-option-keyword</span> <span class="nv">opt-line</span> <span class="ss">&#39;latex</span><span class="p">)</span> <span class="nb">:latex-cover-page</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nv">cdar</span> <span class="p">(</span><span class="nv">org-collect-keywords</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;OPTIONS&#34;</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="ss">&#39;t</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="ss">&#39;auto</span> <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nv">count-words</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span> <span class="nv">org-latex-cover-page-wordcount-threshold</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">_</span> <span class="no">nil</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-latex-set-coverpage-subtitle-format-a</span> <span class="p">(</span><span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set the subtitle format when a cover page is being used.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">org-latex-template</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-latex-cover-page-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setf</span> <span class="nv">info</span> <span class="p">(</span><span class="nf">plist-put</span> <span class="nv">info</span> <span class="nb">:latex-subtitle-format</span> <span class="nv">org-latex-subtitle-coverpage-format</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-feature-implementations</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">cover-page</span> <span class="nb">:snippet</span> <span class="nv">org-latex-cover-page-maketitle</span> <span class="nb">:order</span> <span class="mi">9</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-conditional-features</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">org-latex-cover-page-p</span><span class="p">)</span> <span class="o">.</span> <span class="nv">cover-page</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>或许之后可以再加一些不同的封面。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>代码</p>
<p>来个序言区模板，主要采用 <code>tcblisting</code> 生成主题 box</p>
<p><a id="code-snippet--latex-tcblisting-code-preamble"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\\</span>usepackage<span class="nb">{</span>accsupp<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>usepackage[most,breakable,minted]<span class="nb">{</span>tcolorbox<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>definecolor<span class="nb">{</span>solarized-light-background<span class="nb">}{</span>HTML<span class="nb">}{</span>FDF6E3<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>definecolor<span class="nb">{</span>solarized-light-frame<span class="nb">}{</span>HTML<span class="nb">}{</span>EEE8D6<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>definecolor<span class="nb">{</span>solarized-light-title<span class="nb">}{</span>HTML<span class="nb">}{</span>979797<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>definecolor<span class="nb">{</span>solarized-light-lineno<span class="nb">}{</span>HTML<span class="nb">}{</span>237D99<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>newcommand<span class="nb">{</span><span class="k">\\</span>SetFancyVerbLine<span class="nb">}{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>renewcommand<span class="nb">{</span><span class="k">\\</span>theFancyVerbLine<span class="nb">}{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\\</span>protect<span class="k">\\</span>BeginAccSupp<span class="nb">{</span>ActualText=<span class="nb">{}}</span><span class="k">\\</span>sffamily<span class="k">\\</span>textcolor<span class="nb">{</span>solarized-light-lineno<span class="nb">}{</span><span class="k">\\</span>scriptsize<span class="k">\\</span>oldstylenums<span class="nb">{</span><span class="k">\\</span>arabic<span class="nb">{</span>FancyVerbLine<span class="nb">}}}</span><span class="k">\\</span>protect<span class="k">\\</span>EndAccSupp<span class="nb">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\\</span>newenvironment<span class="nb">{</span>orglisting<span class="nb">}</span>[2][]<span class="nb">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>SetFancyVerbLine
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>tcblisting<span class="nb">{</span>
</span></span><span class="line"><span class="cl">    frame empty,
</span></span><span class="line"><span class="cl">    enhanced jigsaw,
</span></span><span class="line"><span class="cl">    drop fuzzy shadow,
</span></span><span class="line"><span class="cl">    breakable,
</span></span><span class="line"><span class="cl">    center,
</span></span><span class="line"><span class="cl">    width=<span class="k">\\</span>linewidth,
</span></span><span class="line"><span class="cl">    bottom=1mm, top=1mm, left=6mm,
</span></span><span class="line"><span class="cl">    fonttitle=<span class="k">\\</span>bfseries,
</span></span><span class="line"><span class="cl">    listing only,
</span></span><span class="line"><span class="cl">    listing engine=minted,
</span></span><span class="line"><span class="cl">    colback=solarized-light-background,
</span></span><span class="line"><span class="cl">    colframe=solarized-light-frame,
</span></span><span class="line"><span class="cl">    coltitle=solarized-light-title,
</span></span><span class="line"><span class="cl">    minted style=solarized-light,
</span></span><span class="line"><span class="cl">    minted language=#2,
</span></span><span class="line"><span class="cl">    minted options=<span class="nb">{</span>
</span></span><span class="line"><span class="cl">      breaklines=t,
</span></span><span class="line"><span class="cl">      breakbefore=.,
</span></span><span class="line"><span class="cl">      samepage=nil,
</span></span><span class="line"><span class="cl">      encoding=utf8,
</span></span><span class="line"><span class="cl">      fontsize=<span class="k">\\</span>small,
</span></span><span class="line"><span class="cl">      mathescape=t,
</span></span><span class="line"><span class="cl">      escapeinside=,
</span></span><span class="line"><span class="cl">      autogobble=t,
</span></span><span class="line"><span class="cl">      breakautoindent=t,
</span></span><span class="line"><span class="cl">      tabsize=4,
</span></span><span class="line"><span class="cl">      numbersep=2mm,
</span></span><span class="line"><span class="cl">      <span class="c">% numbers=left,
</span></span></span><span class="line"><span class="cl"><span class="c"></span>      numberblanklines=t,
</span></span><span class="line"><span class="cl">      firstline=1,
</span></span><span class="line"><span class="cl">      firstnumber=1,
</span></span><span class="line"><span class="cl">      <span class="c">% lastline=,
</span></span></span><span class="line"><span class="cl"><span class="c"></span>      showspaces=nil,
</span></span><span class="line"><span class="cl">      space=<span class="k">\\</span>textvisiblespace, <span class="c">%% only showspaces=true
</span></span></span><span class="line"><span class="cl"><span class="c"></span>      obeytabs=nil,
</span></span><span class="line"><span class="cl">      showtabs=nil,
</span></span><span class="line"><span class="cl">      #1
</span></span><span class="line"><span class="cl">    <span class="nb">}</span>,
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">}{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\\</span>endtcblisting
</span></span><span class="line"><span class="cl"><span class="nb">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置一下自己的代码渲染方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-latex-listings</span> <span class="ss">&#39;tcblisting</span>
</span></span><span class="line"><span class="cl">       <span class="nv">org-latex-tcblisting-code-preamble</span> <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;&lt;latex-tcblisting-code-preamble&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改一下导出代码块的行为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-latex-src-block-tcblisting</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Like </span><span class="ss">`org-latex-src-block&#39;</span><span class="s">, but supporting an tcblisting backend&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-latex-src-block</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;tcblisting</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-listings</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ginshio/org-latex-scr-block</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ginshio/org-latex-scr-block</span> <span class="p">(</span><span class="nv">src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">lang</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:language</span> <span class="nv">src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">attributes</span> <span class="p">(</span><span class="nv">org-export-read-attribute</span> <span class="nb">:attr_latex</span> <span class="nv">src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">float</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">attributes</span> <span class="nb">:float</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">num-start</span> <span class="p">(</span><span class="nv">org-export-get-loc</span> <span class="nv">src-block</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">retain-labels</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:retain-labels</span> <span class="nv">src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">caption</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:caption</span> <span class="nv">src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">caption-above-p</span> <span class="p">(</span><span class="nv">org-latex--caption-above-p</span> <span class="nv">src-block</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">caption-str</span> <span class="p">(</span><span class="nv">org-latex--caption/label-string</span> <span class="nv">src-block</span> <span class="nv">info</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">placement</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-unbracket-string</span> <span class="s">&#34;[&#34;</span> <span class="s">&#34;]&#34;</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">attributes</span> <span class="nb">:placement</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-default-figure-position</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">float-env</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">	   <span class="p">((</span><span class="nv">string=</span> <span class="s">&#34;multicolumn&#34;</span> <span class="nf">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\begin{listing*}[%s]\n%s%%s\n%s\\end{listing*}&#34;</span>
</span></span><span class="line"><span class="cl">		    <span class="nv">placement</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nb">if</span> <span class="nv">caption-above-p</span> <span class="nv">caption-str</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nb">if</span> <span class="nv">caption-above-p</span> <span class="s">&#34;&#34;</span> <span class="nv">caption-str</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nv">caption</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\begin{listing}[%s]\n%s%%s\n%s\\end{listing}&#34;</span>
</span></span><span class="line"><span class="cl">		    <span class="nv">placement</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nb">if</span> <span class="nv">caption-above-p</span> <span class="nv">caption-str</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nb">if</span> <span class="nv">caption-above-p</span> <span class="s">&#34;&#34;</span> <span class="nv">caption-str</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">((</span><span class="nv">string=</span> <span class="s">&#34;t&#34;</span> <span class="nf">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\begin{listing}[%s]\n&#34;</span> <span class="nv">placement</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="s">&#34;%s\n\\end{listing}&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="no">t</span> <span class="s">&#34;%s&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">options</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-minted-options</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">body</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nf">format</span>
</span></span><span class="line"><span class="cl">	   <span class="s">&#34;\\begin{orglisting}[%s]{%s}\n%s\\end{orglisting}&#34;</span>
</span></span><span class="line"><span class="cl">	   <span class="c1">;; Options.</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nv">org-latex--make-option-string</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">num-start</span><span class="p">)</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;linenos&#34;</span> <span class="nv">options</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		 <span class="nv">options</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nf">append</span>
</span></span><span class="line"><span class="cl">		<span class="o">`</span><span class="p">((</span><span class="s">&#34;linenos&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="s">&#34;firstnumber&#34;</span> <span class="o">,</span><span class="p">(</span><span class="nf">number-to-string</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">num-start</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">		<span class="nv">options</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">local-options</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">attributes</span> <span class="nb">:options</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nb">and</span> <span class="nv">local-options</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;,&#34;</span> <span class="nv">local-options</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	   <span class="c1">;; Language.</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nf">assq</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">lang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-minted-langs</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nf">downcase</span> <span class="nv">lang</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	   <span class="c1">;; Source code.</span>
</span></span><span class="line"><span class="cl">	   <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">code-info</span> <span class="p">(</span><span class="nv">org-export-unravel-code</span> <span class="nv">src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		  <span class="p">(</span><span class="nv">max-width</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">apply</span> <span class="ss">&#39;max</span>
</span></span><span class="line"><span class="cl">			  <span class="p">(</span><span class="nf">mapcar</span> <span class="ss">&#39;length</span>
</span></span><span class="line"><span class="cl">				  <span class="p">(</span><span class="nv">org-split-string</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">code-info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">						    <span class="s">&#34;\n&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">org-export-format-code</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nf">car</span> <span class="nv">code-info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">loc</span> <span class="nv">_num</span> <span class="nv">ref</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">		 <span class="nv">loc</span>
</span></span><span class="line"><span class="cl">		 <span class="p">(</span><span class="nb">when</span> <span class="nv">ref</span>
</span></span><span class="line"><span class="cl">		   <span class="c1">;; Ensure references are flushed to the right,</span>
</span></span><span class="line"><span class="cl">		   <span class="c1">;; separated with 6 spaces from the widest line</span>
</span></span><span class="line"><span class="cl">		   <span class="c1">;; of code.</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">make-string</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">max-width</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">loc</span><span class="p">))</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="sc">?\s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;(%s)&#34;</span> <span class="nv">ref</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">	      <span class="no">nil</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">retain-labels</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">code-info</span><span class="p">)))))))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Return value.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="nv">float-env</span> <span class="nv">body</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>内联代码块的行为相对更好修改</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-latex-inline-src-block-tcblisting</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">inline-src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Like </span><span class="ss">`org-latex-inline-src-block&#39;</span><span class="s">, but supporting an tcblisting backend&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-latex-inline-src-block</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;tcblisting</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-listings</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; (funcall orig-fn inline-src-block contents (plist-put info :latex-listings &#39;minted))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ginshio/org-latex-inline-src-block</span> <span class="nv">inline-src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">inline-src-block</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">ginshio/org-latex-inline-src-block</span> <span class="p">(</span><span class="nv">inline-src-block</span> <span class="nv">_contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">code</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:value</span> <span class="nv">inline-src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">separator</span> <span class="p">(</span><span class="nv">org-latex--find-verb-separator</span> <span class="nv">code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">org-lang</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:language</span> <span class="nv">inline-src-block</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">mint-lang</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nf">assq</span> <span class="p">(</span><span class="nf">intern</span> <span class="nv">org-lang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				    <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-minted-langs</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nf">downcase</span> <span class="nv">org-lang</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">options</span> <span class="p">(</span><span class="nv">org-latex--make-option-string</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:latex-minted-options</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\mintinline%s{%s}{%s}&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">options</span> <span class="s">&#34;&#34;</span><span class="p">)</span> <span class="s">&#34;&#34;</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;[%s]&#34;</span> <span class="nv">options</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">mint-lang</span> <span class="nv">code</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>最终将其添加到智能序言中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-conditional-features</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;^[ \t]*#\\+begin_src\\|^[ \t]*#\\+BEGIN_SRC\\|src_[A-Za-z]&#34;</span> <span class="o">.</span> <span class="nv">tcblisting-code-preamble</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-feature-implementations</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">tcblisting-code-preamble</span> <span class="nb">:snippet</span> <span class="nv">org-latex-tcblisting-code-preamble</span> <span class="nb">:order</span> <span class="mi">99</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>有一个问题，就是代码中的所有引号有问题。</p>
</li>
</ul>
<!--list-separator-->
<ul>
<li>
<p>使 verbatim 与 code 不同</p>
<p>区分 <code>verbatim</code> 和 <code>verb</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-latex-text-markup-alist</span>
</span></span><span class="line"><span class="cl">       <span class="o">&#39;</span><span class="p">((</span><span class="nv">bold</span> <span class="o">.</span> <span class="s">&#34;\\textbf{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">code</span> <span class="o">.</span> <span class="nv">protectedtexttt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">italic</span> <span class="o">.</span> <span class="s">&#34;\\emph{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">strike-through</span> <span class="o">.</span> <span class="s">&#34;\\sout{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">underline</span> <span class="o">.</span> <span class="s">&#34;\\uline{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nv">verbatim</span> <span class="o">.</span> <span class="nv">verb</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="幻灯片导出" class="headerLink">
    <a href="#%e5%b9%bb%e7%81%af%e7%89%87%e5%af%bc%e5%87%ba" class="header-mark"></a>幻灯片导出</h4><p>如果能使用不同的主题就很好了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-beamer-theme</span> <span class="s">&#34;[progressbar=foot]metropolis&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-beamer-p</span> <span class="p">(</span><span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;beamer</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:back-end</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-export-backend-name</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:back-end</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-conditional-features</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-beamer-p</span> <span class="o">.</span> <span class="nv">beamer</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-feature-implementations</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">beamer</span> <span class="nb">:requires</span> <span class="o">.</span><span class="nv">missing-koma</span> <span class="nb">:prevents</span> <span class="p">(</span><span class="nv">italic-quotes</span> <span class="nv">condensed-lists</span><span class="p">))</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-feature-implementations</span> <span class="o">&#39;</span><span class="p">(</span><span class="o">.</span><span class="nv">missing-koma</span> <span class="nb">:snippet</span> <span class="s">&#34;\\usepackage{scrextend}&#34;</span> <span class="nb">:order</span> <span class="mi">2</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>而且我认为将演示文稿分成几个部分是很自然的，例如简介、概述…… 所以让我们将标题级别设置为 <code>2</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-beamer-frame-level</span> <span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ascii-导出" class="headerLink">
    <a href="#ascii-%e5%af%bc%e5%87%ba" class="header-mark"></a>ASCII 导出</h4><p>ASCII 导出通常不错，我认为从改进中收益的主要方面是 LaTeX 片段的外观，我们可以使用一个很好的程序来创建更好的 unicode 表示。它叫做 <code>latex2text</code> ，它是
<code>pylatexenc</code> 的一部分。因此将使用 <code>pip</code> 安装它。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo python3 -m pip install pylatexenc
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装后，我们可以覆盖 <code>(org-ascii-latex-fragment)</code> 和
<code>(org-ascii-latex-environment)</code> 函数，它们非常方便
&mdash; 只需提取内容并缩进。我们只会在设置 <code>utf-8</code> 时做一些不同的事情。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-ascii</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">setq!</span> <span class="nv">org-ascii-charset</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">org-ascii-convert-latex</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Use latex2text to convert LaTeX elements to unicode.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-ascii-latex-environment-unicode-a</span> <span class="p">(</span><span class="nv">latex-environment</span> <span class="nv">_contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Transcode a LATEX-ENVIRONMENT element from Org to ASCII, converting to unicode.
</span></span></span><span class="line"><span class="cl"><span class="s">CONTENTS is nil.  INFO is a plist holding contextual
</span></span></span><span class="line"><span class="cl"><span class="s">information.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:override</span> <span class="nf">#&#39;</span><span class="nv">org-ascii-latex-environment</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-latex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-ascii--justify-element</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">org-remove-indentation</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">latex</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:value</span> <span class="nv">latex-environment</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">unicode</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:ascii-charset</span><span class="p">)</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			     <span class="nv">org-ascii-convert-latex</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="nv">doom-call-process</span> <span class="s">&#34;latex2text&#34;</span> <span class="s">&#34;-q&#34;</span> <span class="s">&#34;--code&#34;</span> <span class="nv">latex</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">unicode</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">; utf-8 set, and sucessfully ran latex2text</span>
</span></span><span class="line"><span class="cl">	      <span class="p">(</span><span class="nf">cdr</span> <span class="nv">unicode</span><span class="p">)</span> <span class="nv">latex</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">       <span class="nv">latex-environment</span> <span class="nv">info</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-ascii-latex-fragment-unicode-a</span> <span class="p">(</span><span class="nv">latex-fragment</span> <span class="nv">_contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Transcode a LATEX-FRAGMENT object from Org to ASCII, converting to unicode.
</span></span></span><span class="line"><span class="cl"><span class="s">CONTENTS is nil.  INFO is a plist holding contextual
</span></span></span><span class="line"><span class="cl"><span class="s">information.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:override</span> <span class="nf">#&#39;</span><span class="nv">org-ascii-latex-fragment</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:with-latex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">latex</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:value</span> <span class="nv">latex-fragment</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="nv">unicode</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:ascii-charset</span><span class="p">)</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="nv">org-ascii-convert-latex</span>
</span></span><span class="line"><span class="cl">			     <span class="p">(</span><span class="nv">doom-call-process</span> <span class="s">&#34;latex2text&#34;</span> <span class="s">&#34;-q&#34;</span> <span class="s">&#34;--code&#34;</span> <span class="nv">latex</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">unicode</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">unicode</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">; utf-8 set, and sucessfully ran latex2text</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nf">cdr</span> <span class="nv">unicode</span><span class="p">)</span> <span class="nv">latex</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="markdown-导出" class="headerLink">
    <a href="#markdown-%e5%af%bc%e5%87%ba" class="header-mark"></a>Markdown 导出</h4><p>由于 <em><a href="https://github.com/commonmark/commonmark-spec/wiki/markdown-flavors" target="_blank" rel="noopener noreferrer">Markdown 实现的多样性</a></em> ，实际上并没有标准的表格规范……或标准的任何东西。因为 <code>org-md</code> 表现的与众不同，它只是对所有这些非标准化元素 (很多) 使用 HTML。</p>
<p>似乎大多数 Markdown 解析器都专注于 TeX 样式的语法 (<code>$</code> 和 <code>$$</code>)。不幸的是，为了获得良好的渲染，最好兼容它们。 <code>ox-md</code> 没有为此提供转码器，因此必须自己创建并将它们推送到 <code>md</code> 转码器列表中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-md</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-md-latex-fragment</span> <span class="p">(</span><span class="nv">latex-fragment</span> <span class="nv">_contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Transcode a LATEX-FRAGMENT object from Org to Markdown.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">frag</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:value</span> <span class="nv">latex-fragment</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">       <span class="p">((</span><span class="nv">string-match-p</span> <span class="s">&#34;^\\\\(&#34;</span> <span class="nv">frag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;$&#34;</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">frag</span> <span class="mi">2</span> <span class="mi">-2</span><span class="p">)</span> <span class="s">&#34;$&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">((</span><span class="nv">string-match-p</span> <span class="s">&#34;^\\\\\\[&#34;</span> <span class="nv">frag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;$$&#34;</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">frag</span> <span class="mi">2</span> <span class="mi">-2</span><span class="p">)</span> <span class="s">&#34;$$&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;unrecognised fragment: %s&#34;</span> <span class="nv">frag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">frag</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-md-latex-environment</span> <span class="p">(</span><span class="nv">latex-environment</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Transcode a LATEX-ENVIRONMENT object from Org to Markdown.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;$$\n&#34;</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nv">org-html-latex-environment</span> <span class="nv">latex-environment</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="s">&#34;$$\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-utf8-entity</span> <span class="p">(</span><span class="nv">entity</span> <span class="nv">_contents</span> <span class="nv">_info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Transcode an ENTITY object from Org to utf-8.
</span></span></span><span class="line"><span class="cl"><span class="s">CONTENTS are the definition itself.  INFO is a plist holding
</span></span></span><span class="line"><span class="cl"><span class="s">contextual information.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:utf-8</span> <span class="nv">entity</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">;; We can&#39;t let this be immediately parsed and evaluated,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; because eager macro-expansion tries to call as-of-yet</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; undefined functions.</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; NOTE in the near future this shouldn&#39;t be required</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">eval</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">extra-transcoder</span>
</span></span><span class="line"><span class="cl">	     <span class="o">&#39;</span><span class="p">((</span><span class="nv">latex-fragment</span> <span class="o">.</span> <span class="nv">org-md-latex-fragment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">latex-environment</span> <span class="o">.</span> <span class="nv">org-md-latex-environment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	       <span class="p">(</span><span class="nv">entity</span> <span class="o">.</span> <span class="nv">org-utf8-entity</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">member</span> <span class="nv">extra-transcoder</span> <span class="p">(</span><span class="nv">org-export-backend-transcoders</span>
</span></span><span class="line"><span class="cl">					<span class="p">(</span><span class="nv">org-export-get-backend</span> <span class="ss">&#39;md</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nb">push</span> <span class="nv">extra-transcoder</span> <span class="p">(</span><span class="nv">org-export-backend-transcoders</span>
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="nv">org-export-get-backend</span> <span class="ss">&#39;md</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">defadvice!</span> <span class="nv">org-md-plain-text-unicode-a</span> <span class="p">(</span><span class="nv">orig-fn</span> <span class="nv">text</span> <span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Locally rebind </span><span class="ss">`org-html-special-string-regexps&#39;</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">org-md-plain-text</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-html-special-string-regexps</span>
</span></span><span class="line"><span class="cl">	   <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;\\\\-&#34;</span> <span class="o">.</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="s">&#34;---\\([^-]\\|$\\)&#34;</span> <span class="o">.</span> <span class="s">&#34;—\\1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="s">&#34;--\\([^-]\\|$\\)&#34;</span> <span class="o">.</span> <span class="s">&#34;–\\1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="s">&#34;\\.\\.\\.&#34;</span> <span class="o">.</span> <span class="s">&#34;…&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="s">&#34;-&gt;&#34;</span> <span class="o">.</span> <span class="s">&#34;→&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="p">(</span><span class="s">&#34;&lt;-&#34;</span> <span class="o">.</span> <span class="s">&#34;←&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig-fn</span> <span class="nv">text</span> <span class="p">(</span><span class="nf">plist-put</span> <span class="nv">info</span> <span class="nb">:with-smart-quotes</span> <span class="no">nil</span><span class="p">)))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当我想在某处粘贴导出的 Markdown 时，最好使用 unicode 字符 <code>---</code> 而不是
<code>&amp;#x2014;</code> 。为此，只需要在本地重新绑定提供的 alist。而
<code>org-md-plain-text-unicode-a</code> 就是解决这个问题的。</p>
<h4 id="hugo" class="headerLink">
    <a href="#hugo" class="header-mark"></a>Hugo</h4><p>我用 hugo 的主要原因是就是可以用 Org Mode 来写作，之后交给 <a href="https://ox-hugo.scripter.co/" target="_blank" rel="noopener noreferrer">ox-hugo</a> 就好。需要尽量减少 hugo 所带来的额外语法，这样可以让我们仅用 Org 编辑，发布不同的文件。</p>
<p>我使用的 Hugo 主题是 <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer">DoIt</a>，<code>authors</code> 字段接受数组类型，而 <code>ox-hugo</code> 默认导出
<code>author</code> 字段为数组类型，对于该问题可以参考该 <a href="https://github.com/kaushalmodi/ox-hugo/issues/608#issuecomment-1086950058" target="_blank" rel="noopener noreferrer">issue</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#+hugo_front_matter_key_replace: author&gt;authors
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="LaTeX" class="headerLink">
    <a href="#LaTeX" class="header-mark"></a>LaTeX</h3><figure><img src="https://imgs.xkcd.com/comics/file_extensions.png"/>
</figure>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">LaTeX-biblatex-use-Biber</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-variables</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">LaTeX-section-label</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;part&#34;</span> <span class="o">.</span> <span class="s">&#34;part:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					      <span class="p">(</span><span class="s">&#34;chapter&#34;</span> <span class="o">.</span> <span class="s">&#34;chap:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					      <span class="p">(</span><span class="s">&#34;section&#34;</span> <span class="o">.</span> <span class="s">&#34;sec:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					      <span class="p">(</span><span class="s">&#34;subsection&#34;</span> <span class="o">.</span> <span class="s">&#34;subsec:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					      <span class="p">(</span><span class="s">&#34;subsubsection&#34;</span> <span class="o">.</span> <span class="s">&#34;subsubsec:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&#39;</span><span class="p">(</span><span class="nv">TeX-auto-local</span> <span class="s">&#34;auto&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&#39;</span><span class="p">(</span><span class="nv">TeX-command-extra-options</span> <span class="s">&#34;-shell-escape&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">after!</span> <span class="nv">latex</span>
</span></span><span class="line"><span class="cl">  <span class="nv">&lt;&lt;tex-conf&gt;&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="编译" class="headerLink">
    <a href="#%e7%bc%96%e8%af%91" class="header-mark"></a>编译</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">TeX-save-query</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">       <span class="nv">TeX-show-compilation</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">       <span class="nv">LaTeX-clean-intermediate-suffixes</span> <span class="p">(</span><span class="nf">append</span> <span class="nv">TeX-clean-default-intermediate-suffixes</span>
</span></span><span class="line"><span class="cl">						 <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;\\.acn&#34;</span> <span class="s">&#34;\\.acr&#34;</span> <span class="s">&#34;\\.alg&#34;</span> <span class="s">&#34;\\.glg&#34;</span>
</span></span><span class="line"><span class="cl">						   <span class="s">&#34;\\.ist&#34;</span> <span class="s">&#34;\\.listing&#34;</span> <span class="s">&#34;\\.fdb_latexmk&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;TeX-command-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;LatexMk (XeLaTeX)&#34;</span> <span class="s">&#34;latexmk -pdf -xelatex -8bit %S%(mode) %(file-line-error) %(extraopts) %t&#34;</span> <span class="nv">TeX-run-latexmk</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">				 <span class="p">(</span><span class="nv">plain-tex-mode</span> <span class="nv">latex-mode</span> <span class="nv">doctex-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				 <span class="nb">:help</span> <span class="s">&#34;Run LatexMk (XeLaTeX)&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="引用" class="headerLink">
    <a href="#%e5%bc%95%e7%94%a8" class="header-mark"></a>引用</h4><p>如果 <code>bib</code> 中有你不想要的某些字段，可以通过一下方法去除 (导言区)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-latex" data-lang="latex"><span class="line"><span class="cl"><span class="k">\AtEveryBibitem</span><span class="nb">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\clearfield</span><span class="nb">{</span>note<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\ifentrytype</span><span class="nb">{</span>book<span class="nb">}{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\clearfield</span><span class="nb">{</span>url<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\clearfield</span><span class="nb">{</span>isbn<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}{}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\ifentrytype</span><span class="nb">{</span>article<span class="nb">}{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\clearfield</span><span class="nb">{</span>url<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}{}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\ifentrytype</span><span class="nb">{</span>thesis<span class="nb">}{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\clearfield</span><span class="nb">{</span>url<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}{}</span>
</span></span><span class="line"><span class="cl"><span class="nb">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="视觉" class="headerLink">
    <a href="#%e8%a7%86%e8%a7%89" class="header-mark"></a>视觉</h4><p>增强一点点视觉效果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">setcar</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;⋆&#34;</span> <span class="nv">LaTeX-fold-math-spec-list</span><span class="p">)</span> <span class="s">&#34;★&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">setq!</span> <span class="nv">TeX-fold-math-spec-list</span>
</span></span><span class="line"><span class="cl">       <span class="o">`</span><span class="p">(</span><span class="c1">;; missing/better symbols</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;≤&#34;</span> <span class="p">(</span><span class="s">&#34;le&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;≥&#34;</span> <span class="p">(</span><span class="s">&#34;ge&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;≠&#34;</span> <span class="p">(</span><span class="s">&#34;ne&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; convenience shorts -- these don&#39;t work nicely ATM</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; (&#34;‹&#34; (&#34;left&#34;))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; (&#34;›&#34; (&#34;right&#34;))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; private macros</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℝ&#34;</span> <span class="p">(</span><span class="s">&#34;RR&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℕ&#34;</span> <span class="p">(</span><span class="s">&#34;NN&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℤ&#34;</span> <span class="p">(</span><span class="s">&#34;ZZ&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℚ&#34;</span> <span class="p">(</span><span class="s">&#34;QQ&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℂ&#34;</span> <span class="p">(</span><span class="s">&#34;CC&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℙ&#34;</span> <span class="p">(</span><span class="s">&#34;PP&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;ℍ&#34;</span> <span class="p">(</span><span class="s">&#34;HH&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;𝔼&#34;</span> <span class="p">(</span><span class="s">&#34;EE&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;𝑑&#34;</span> <span class="p">(</span><span class="s">&#34;dd&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; known commands</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;&#34;</span> <span class="p">(</span><span class="s">&#34;phantom&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">num</span> <span class="nv">den</span><span class="p">)</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">TeX-string-single-token-p</span> <span class="nv">num</span><span class="p">)</span> <span class="p">(</span><span class="nv">TeX-string-single-token-p</span> <span class="nv">den</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				 <span class="p">(</span><span class="nf">concat</span> <span class="nv">num</span> <span class="s">&#34;／&#34;</span> <span class="nv">den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			       <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;❪&#34;</span> <span class="nv">num</span> <span class="s">&#34;／&#34;</span> <span class="nv">den</span> <span class="s">&#34;❫&#34;</span><span class="p">)))</span> <span class="p">(</span><span class="s">&#34;frac&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;√&#34;</span> <span class="p">(</span><span class="nv">TeX-fold-parenthesize-as-necessary</span> <span class="nv">arg</span><span class="p">)))</span> <span class="p">(</span><span class="s">&#34;sqrt&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;⭡&#34;</span> <span class="p">(</span><span class="nv">TeX-fold-parenthesize-as-necessary</span> <span class="nv">arg</span><span class="p">)))</span> <span class="p">(</span><span class="s">&#34;vec&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;‘{1}’&#34;</span> <span class="p">(</span><span class="s">&#34;text&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; private commands</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;|{1}|&#34;</span> <span class="p">(</span><span class="s">&#34;abs&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;‖{1}‖&#34;</span> <span class="p">(</span><span class="s">&#34;norm&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;⌊{1}⌋&#34;</span> <span class="p">(</span><span class="s">&#34;floor&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;⌈{1}⌉&#34;</span> <span class="p">(</span><span class="s">&#34;ceil&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;⌊{1}⌉&#34;</span> <span class="p">(</span><span class="s">&#34;round&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;𝑑{1}/𝑑{2}&#34;</span> <span class="p">(</span><span class="s">&#34;dv&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;∂{1}/∂{2}&#34;</span> <span class="p">(</span><span class="s">&#34;pdv&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; fancification</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;{1}&#34;</span> <span class="p">(</span><span class="s">&#34;mathrm&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-offset-roman-chars</span> <span class="mi">119743</span> <span class="nv">word</span><span class="p">))</span> <span class="p">(</span><span class="s">&#34;mathbf&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-offset-roman-chars</span> <span class="mi">119951</span> <span class="nv">word</span><span class="p">))</span> <span class="p">(</span><span class="s">&#34;mathcal&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-offset-roman-chars</span> <span class="mi">120003</span> <span class="nv">word</span><span class="p">))</span> <span class="p">(</span><span class="s">&#34;mathfrak&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-offset-roman-chars</span> <span class="mi">120055</span> <span class="nv">word</span><span class="p">))</span> <span class="p">(</span><span class="s">&#34;mathbb&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-offset-roman-chars</span> <span class="mi">120159</span> <span class="nv">word</span><span class="p">))</span> <span class="p">(</span><span class="s">&#34;mathsf&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nv">string-offset-roman-chars</span> <span class="mi">120367</span> <span class="nv">word</span><span class="p">))</span> <span class="p">(</span><span class="s">&#34;mathtt&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="nv">TeX-fold-macro-spec-list</span>
</span></span><span class="line"><span class="cl">       <span class="o">&#39;</span><span class="p">(</span><span class="c1">;; as the defaults</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;[f]&#34;</span> <span class="p">(</span><span class="s">&#34;footnote&#34;</span> <span class="s">&#34;marginpar&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;[c]&#34;</span> <span class="p">(</span><span class="s">&#34;cite&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;[l]&#34;</span> <span class="p">(</span><span class="s">&#34;label&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;[r]&#34;</span> <span class="p">(</span><span class="s">&#34;ref&#34;</span> <span class="s">&#34;pageref&#34;</span> <span class="s">&#34;eqref&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;[i]&#34;</span> <span class="p">(</span><span class="s">&#34;index&#34;</span> <span class="s">&#34;glossary&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;...&#34;</span> <span class="p">(</span><span class="s">&#34;dots&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;{1}&#34;</span> <span class="p">(</span><span class="s">&#34;emph&#34;</span> <span class="s">&#34;textit&#34;</span> <span class="s">&#34;textsl&#34;</span> <span class="s">&#34;textmd&#34;</span> <span class="s">&#34;textrm&#34;</span> <span class="s">&#34;textsf&#34;</span> <span class="s">&#34;texttt&#34;</span>
</span></span><span class="line"><span class="cl">		 <span class="s">&#34;textbf&#34;</span> <span class="s">&#34;textsc&#34;</span> <span class="s">&#34;textup&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; tweaked defaults</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;©&#34;</span> <span class="p">(</span><span class="s">&#34;copyright&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;®&#34;</span> <span class="p">(</span><span class="s">&#34;textregistered&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;™&#34;</span>  <span class="p">(</span><span class="s">&#34;texttrademark&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;[1]:||►&#34;</span> <span class="p">(</span><span class="s">&#34;item&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;❡❡ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;part&#34;</span> <span class="s">&#34;part*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;❡ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;chapter&#34;</span> <span class="s">&#34;chapter*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;§ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;section&#34;</span> <span class="s">&#34;section*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;§§ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;subsection&#34;</span> <span class="s">&#34;subsection*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;§§§ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;subsubsection&#34;</span> <span class="s">&#34;subsubsection*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;¶ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;paragraph&#34;</span> <span class="s">&#34;paragraph*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;¶¶ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;subparagraph&#34;</span> <span class="s">&#34;subparagraph*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">;; extra</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;⬖ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;begin&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="s">&#34;⬗ {1}&#34;</span> <span class="p">(</span><span class="s">&#34;end&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	 <span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">string-offset-roman-chars</span> <span class="p">(</span><span class="nv">offset</span> <span class="nv">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Shift the codepoint of each character in WORD by OFFSET with an extra -6 shift if the letter is lowercase&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">apply</span> <span class="ss">&#39;string</span>
</span></span><span class="line"><span class="cl">	 <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="p">(</span><span class="nv">string-offset-apply-roman-char-exceptions</span>
</span></span><span class="line"><span class="cl">		    <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;=</span> <span class="nv">c</span> <span class="mi">97</span><span class="p">)</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">c</span> <span class="mi">6</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">offset</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		 <span class="nv">word</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">string-offset-roman-char-exceptions</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">(</span><span class="c1">;; lowercase serif</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119892</span> <span class="o">.</span>  <span class="mi">8462</span><span class="p">)</span> <span class="c1">; ℎ</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; lowercase caligraphic</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119994</span> <span class="o">.</span> <span class="mi">8495</span><span class="p">)</span> <span class="c1">; ℯ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119996</span> <span class="o">.</span> <span class="mi">8458</span><span class="p">)</span> <span class="c1">; ℊ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120004</span> <span class="o">.</span> <span class="mi">8500</span><span class="p">)</span> <span class="c1">; ℴ</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; caligraphic</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119965</span> <span class="o">.</span> <span class="mi">8492</span><span class="p">)</span> <span class="c1">; ℬ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119968</span> <span class="o">.</span> <span class="mi">8496</span><span class="p">)</span> <span class="c1">; ℰ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119969</span> <span class="o">.</span> <span class="mi">8497</span><span class="p">)</span> <span class="c1">; ℱ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119971</span> <span class="o">.</span> <span class="mi">8459</span><span class="p">)</span> <span class="c1">; ℋ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119972</span> <span class="o">.</span> <span class="mi">8464</span><span class="p">)</span> <span class="c1">; ℐ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119975</span> <span class="o">.</span> <span class="mi">8466</span><span class="p">)</span> <span class="c1">; ℒ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119976</span> <span class="o">.</span> <span class="mi">8499</span><span class="p">)</span> <span class="c1">; ℳ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">119981</span> <span class="o">.</span> <span class="mi">8475</span><span class="p">)</span> <span class="c1">; ℛ</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; fraktur</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120070</span> <span class="o">.</span> <span class="mi">8493</span><span class="p">)</span> <span class="c1">; ℭ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120075</span> <span class="o">.</span> <span class="mi">8460</span><span class="p">)</span> <span class="c1">; ℌ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120076</span> <span class="o">.</span> <span class="mi">8465</span><span class="p">)</span> <span class="c1">; ℑ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120085</span> <span class="o">.</span> <span class="mi">8476</span><span class="p">)</span> <span class="c1">; ℜ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120092</span> <span class="o">.</span> <span class="mi">8488</span><span class="p">)</span> <span class="c1">; ℨ</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; blackboard</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120122</span> <span class="o">.</span> <span class="mi">8450</span><span class="p">)</span> <span class="c1">; ℂ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120127</span> <span class="o">.</span> <span class="mi">8461</span><span class="p">)</span> <span class="c1">; ℍ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120133</span> <span class="o">.</span> <span class="mi">8469</span><span class="p">)</span> <span class="c1">; ℕ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120135</span> <span class="o">.</span> <span class="mi">8473</span><span class="p">)</span> <span class="c1">; ℙ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120136</span> <span class="o">.</span> <span class="mi">8474</span><span class="p">)</span> <span class="c1">; ℚ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120137</span> <span class="o">.</span> <span class="mi">8477</span><span class="p">)</span> <span class="c1">; ℝ</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">120145</span> <span class="o">.</span> <span class="mi">8484</span><span class="p">)</span> <span class="c1">; ℤ</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;An alist of deceptive codepoints, and then where the glyph actually resides.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">string-offset-apply-roman-char-exceptions</span> <span class="p">(</span><span class="nv">char</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Sometimes the codepoint doesn&#39;t contain the char you expect.
</span></span></span><span class="line"><span class="cl"><span class="s">Such special cases should be remapped to another value, as given in </span><span class="ss">`string-offset-roman-char-exceptions&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">char</span> <span class="nv">string-offset-roman-char-exceptions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">char</span> <span class="nv">string-offset-roman-char-exceptions</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nv">char</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">TeX-fold-parenthesize-as-necessary</span> <span class="p">(</span><span class="nv">tokens</span> <span class="kp">&amp;optional</span> <span class="nv">suppress-left</span> <span class="nv">suppress-right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Add ❪ ❫ parenthesis as if multiple LaTeX tokens appear to be present&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">TeX-string-single-token-p</span> <span class="nv">tokens</span><span class="p">)</span> <span class="nv">tokens</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nb">if</span> <span class="nv">suppress-left</span> <span class="s">&#34;&#34;</span> <span class="s">&#34;❪&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">tokens</span>
</span></span><span class="line"><span class="cl">	    <span class="p">(</span><span class="nb">if</span> <span class="nv">suppress-right</span> <span class="s">&#34;&#34;</span> <span class="s">&#34;❫&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">TeX-string-single-token-p</span> <span class="p">(</span><span class="nv">teststring</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return t if TESTSTRING appears to be a single token, nil otherwise&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">string-match-p</span> <span class="s">&#34;^\\\\?\\w+$&#34;</span> <span class="nv">teststring</span><span class="p">)</span> <span class="no">t</span> <span class="no">nil</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然数学界定符不需要强调</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="c1">;; Making \( \) less visible</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defface</span> <span class="nv">unimportant-latex-face</span>
</span></span><span class="line"><span class="cl">  <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="nb">:inherit</span> <span class="nv">font-lock-comment-face</span> <span class="nb">:weight</span> <span class="nv">extra-light</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Face used to make \\(\\), \\[\\] less visible.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:group</span> <span class="ss">&#39;LaTeX-math</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">font-lock-add-keywords</span>
</span></span><span class="line"><span class="cl"> <span class="ss">&#39;latex-mode</span>
</span></span><span class="line"><span class="cl"> <span class="o">`</span><span class="p">((</span><span class="s">&#34;\\\\[]()[]&#34;</span> <span class="mi">0</span> <span class="ss">&#39;unimportant-latex-face</span> <span class="nv">prepend</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> <span class="ss">&#39;end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; (font-lock-add-keywords</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  &#39;latex-mode</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  &#39;((&#34;\\\\[[:word:]]+&#34; 0 &#39;font-lock-keyword-face prepend))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  &#39;end)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="fixes" class="headerLink">
    <a href="#fixes" class="header-mark"></a>Fixes</h4><p>Emacs28</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="nv">EMACS28+</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;latex-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">TeX-latex-mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="markdown" class="headerLink">
    <a href="#markdown" class="header-mark"></a>Markdown</h3><p>Doom 默认的 Markdown 是 <code>GFM</code> (GitHub Flavored Markdown)，不过有了 <code>Emacs</code> 和
<code>Org Mode</code> 谁还用 <code>Markdown</code> 。但是 <code>toc-org-mode</code> 依然可以使用。</p>
<p>可以采用如下方式支持 Markdown。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># TOC         &lt;!-- :TOC: --&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="c-plus-plus" class="headerLink">
    <a href="#c-plus-plus" class="header-mark"></a>C++</h3><p>tcc 也是 C++</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;auto-mode-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;\\.tcc\\&#39;&#34;</span> <span class="o">.</span> <span class="nv">c++-mode</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 04-30</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/2022/doom_emacs_configuration/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://gitlab.com/GinShio/ginshio.gitlab.io/issues/new?issue[title]=[BUG]%20Doom+Emacs+%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6&issue[description]=[POST](https://blog.ginshio.org/2022/doom_emacs_configuration/)%0A%0A##%20Isseus%0A target="_blank" rel="noopener noreferrer">报告问题</a>
                    </span></div>
            <div class="post-info-share">
                <span><a href="#" title="分享到 Twitter" data-sharer="twitter" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-title="Doom Emacs 配置文件" data-hashtags="Doom,OrgMode"><i class="fab fa-twitter fa-fw"></i></a><a href="#" title="分享到 Facebook" data-sharer="facebook" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-hashtag="Doom"><i class="fab fa-facebook-square fa-fw"></i></a><a href="#" title="分享到 Linkedin" data-sharer="linkedin" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/"><i class="fab fa-linkedin fa-fw"></i></a><a href="#" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-title="Doom Emacs 配置文件" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="#" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-title="Doom Emacs 配置文件"><i class="fab fa-hacker-news fa-fw"></i></a><a href="#" title="分享到 Line" data-sharer="line" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-title="Doom Emacs 配置文件"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="#" title="分享到 Telegram" data-sharer="telegram" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-title="Doom Emacs 配置文件" data-web><i class="fab fa-telegram-plane fa-fw"></i></a><a href="#" class="weixin" title="分享到 微信" data-sharer="weixin" data-url="https://blog.ginshio.org/2022/doom_emacs_configuration/" data-title="Doom Emacs 配置文件" data-web><i class="fab fa-weixin fa-fw"></i><img src="https://api.oick.cn/qrcode/api.php?size=256&amp;text=https://blog.ginshio.org/2022/doom_emacs_configuration/" title="Doom Emacs 配置文件">
    </a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/doom/">Doom</a>,&nbsp;<a href="/tags/orgmode/">OrgMode</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022/hp_printer_driver/" class="prev" rel="prev" title="openSUSE 下 HP 打印机配置"><i class="fas fa-angle-left fa-fw"></i>openSUSE 下 HP 打印机配置</a>
            <a href="/2022/compilerprinciple_005/" class="next" rel="next" title="语法分析 2">语法分析 2<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.111.3">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.3.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.ginshio.org/" target="_blank" rel="noopener noreferrer"> </a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div><script>
                    if('serviceWorker' in navigator) {
                        navigator.serviceWorker
                            .register('/sw.min.js', { scope: '/' })
                            .then(function(registration) {
                            });
                
                        navigator.serviceWorker
                            .ready
                            .then(function(registration) {
                            });
                    }
                </script></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/gitalk/gitalk.min.b250718923eb2b3c2ba2de589fcc7f623ebf3efa17f0e501e7de204156024b108524ffafaf0958fd09d3b68cf0412999.css" integrity="sha384-slBxiSPrKzwrot5Yn8x/Yj6/PvoX8OUB594gQVYCSxCFJP&#43;vrwlY/QnTtozwQSmZ"><link rel="stylesheet" href="/lib/katex/katex.min.bcaaee8fe6b5dd4f321c8900c8680ad49dc0ad32f3ac51816c1734b43a7869dfc4c9ec0449e5c4fc8bfaec08fc80a674.css" integrity="sha384-vKruj&#43;a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.1f5388069d157848068f2228e33a72016ef3233cfb0afc2940343e446a708357e5b391b470f94c0e1c80745c331651ca.css" integrity="sha384-H1OIBp0VeEgGjyIo4zpyAW7zIzz7CvwpQDQ&#43;RGpwg1fls5G0cPlMDhyAdFwzFlHK">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.1f5388069d157848068f2228e33a72016ef3233cfb0afc2940343e446a708357e5b391b470f94c0e1c80745c331651ca.css" integrity="sha384-H1OIBp0VeEgGjyIo4zpyAW7zIzz7CvwpQDQ&#43;RGpwg1fls5G0cPlMDhyAdFwzFlHK"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":12},"comment":{"gitalk":{"admin":["GinShio"],"clientID":"96cbbb15f26bebd9141b","clientSecret":"29c7df99d6e1806113996333163a9476027ff1fa","id":"2022-04-08T22:13:23+08:00","owner":"GinShio","repo":"ginshio.github.io","title":"Doom Emacs 配置文件"}},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"ABF13CGNA0","algoliaIndex":"ginshio_blog","algoliaSearchKey":"51cf3425aba132c091b477c3d5e06eea","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"sharerjs":true,"table":{"sort":true}};</script><script type="text/javascript" src="/lib/gitalk/gitalk.min.1420a0c0459673bc6824e7ba713f1e0ec1540e86491daf1b6149a7af9cd3f396c86b9182d03e4c727faefae17b746033.js" integrity="sha384-FCCgwEWWc7xoJOe6cT8eDsFUDoZJHa8bYUmnr5zT85bIa5GC0D5Mcn&#43;u&#43;uF7dGAz"></script><script type="text/javascript" src="/js/gitalk.min.js" defer></script><script type="text/javascript" src="/lib/tablesort/tablesort.min.d120034e53740430f5243f8e25b646e7bdcca97780e02962c37e3adefb264c1b457f8fc397698851f42e32d7168bdd1e.js" integrity="sha384-0SADTlN0BDD1JD&#43;OJbZG573MqXeA4Cliw3463vsmTBtFf4/Dl2mIUfQuMtcWi90e"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.094758c1816ef1698123c876e7b739ac27751905f428bfb349857a93244d636b615bb42a43298a19f4c2235587c33bf2.js" integrity="sha384-CUdYwYFu8WmBI8h257c5rCd1GQX0KL&#43;zSYV6kyRNY2thW7QqQymKGfTCI1WHwzvy"></script><script type="text/javascript" src="/lib/sharer/sharer.min.0097b33812ac4873e9a2e0813de400c9ea9b07e223998d3cbc38a89bdfa3f45cc344689061a836fcd6f4c120eed429b4.js" integrity="sha384-AJezOBKsSHPpouCBPeQAyeqbB&#43;IjmY08vDiom9&#43;j9FzDRGiQYag2/Nb0wSDu1Cm0"></script><script type="text/javascript" src="/lib/katex/katex.min.3f04544ff62a6e71239193b4cd9c4da9cc400ab5defa3efae94d9a997720320e78e7baef7b663b23a6494a6d80d264b8.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe&#43;j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.f95071777afa5e0511c9caad675d7b9d8c38e0e39c21ac79e99e1d09159bc723edd0aa1a875b87a0ad28e3efd1444d39.js" integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.c30ff9f376878715a4cf90c4567e8e2ad36221a2e2da20513595df251898d408bbb6727d517a44b32bce2135694e5e00.js" integrity="sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.453374f1ad005c88a83c1715a2c12a3d47ca2beacfa7e875c7f8b347bc4c91d332bb091c64259dc4ef914b0205b495cd.js" integrity="sha384-RTN08a0AXIioPBcVosEqPUfKK&#43;rPp&#43;h1x/izR7xMkdMyuwkcZCWdxO&#43;RSwIFtJXN" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-J5NHMZLLDX', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-J5NHMZLLDX" async></script><script>
			var _hmt = _hmt || [];
			(function() {
			  var hm = document.createElement("script");
			  hm.src = "https://hm.baidu.com/hm.js?9370523af547bac6b97e9c3b1461cd16";
			  var s = document.getElementsByTagName("script")[0]; 
			  s.parentNode.insertBefore(hm, s);
			})();
		</script></div>
</body>

</html>