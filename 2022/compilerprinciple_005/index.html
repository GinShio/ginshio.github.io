

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>语法分析 2 - iris</title><meta name="Description" content="GinShio | 编译原理第四章 4.4 读书笔记"><meta property="og:title" content="语法分析 2" />
<meta property="og:description" content="GinShio | 编译原理第四章 4.4 读书笔记" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.ginshio.org/2022/compilerprinciple_005/" /><meta property="og:image" content="https://blog.ginshio.org/avatar.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-12T22:23:17+08:00" />
<meta property="article:modified_time" content="2022-04-30T15:09:59+08:00" /><meta property="og:site_name" content="iris | GinShio的个人博客" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.ginshio.org/avatar.webp"/>

<meta name="twitter:title" content="语法分析 2"/>
<meta name="twitter:description" content="GinShio | 编译原理第四章 4.4 读书笔记"/>
<meta name="application-name" content="iris">
<meta name="apple-mobile-web-app-title" content="iris">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.ginshio.org/2022/compilerprinciple_005/" /><link rel="prev" href="https://blog.ginshio.org/2022/doom_emacs_configuration/" /><link rel="next" href="https://blog.ginshio.org/2022/compilerprinciple_006/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.1d6e6517c44074bf1c692657d249d106a5e98bb9db25f7773715b24eda7aa575354611c095c23092aa17916f1b5be527.css" integrity="sha384-HW5lF8RAdL8caSZX0knRBqXpi7nbJfd3NxWyTtp6pXU1RhHAlcIwkqoXkW8bW&#43;Un"><link rel="stylesheet" href="/css/color.34e5eb0ed3195c558eb6994b94f6ce01b4d7121bda08365c4f94b70d178301efdb761cb63c963c02c67c45152c3c9498.css" integrity="sha384-NOXrDtMZXFWOtplLlPbOAbTXEhvaCDZcT5S3DReDAe/bdhy2PJY8AsZ8RRUsPJSY"><link rel="stylesheet" href="/css/style.min.71903c93e482438bcb694a21934b32795f3f9dc2c7076dadfa66ca836805f90335eae546d168ddaa1c5de8eda3532d79.css" integrity="sha384-cZA8k&#43;SCQ4vLaUohk0syeV8/ncLHB22t&#43;mbKg2gF&#43;QM16uVG0Wjdqhxd6O2jUy15"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.2cba216129d7b04299cad0e4a8bb0eb317de61d6e2489778de53950bfcb59fa58d01a258c9e2675ffa3c07c058996f2d.css" integrity="sha384-LLohYSnXsEKZytDkqLsOsxfeYdbiSJd43lOVC/y1n6WNAaJYyeJnX/o8B8BYmW8t">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.2cba216129d7b04299cad0e4a8bb0eb317de61d6e2489778de53950bfcb59fa58d01a258c9e2675ffa3c07c058996f2d.css" integrity="sha384-LLohYSnXsEKZytDkqLsOsxfeYdbiSJd43lOVC/y1n6WNAaJYyeJnX/o8B8BYmW8t"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.1aedca555d87f5dfb2038403a5507b55c3b284994056b717774b61123af82b39df6853cb7b4c50272a2757138d6b8642.css" integrity="sha384-Gu3KVV2H9d&#43;yA4QDpVB7VcOyhJlAVrcXd0thEjr4KznfaFPLe0xQJyonVxONa4ZC">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.1aedca555d87f5dfb2038403a5507b55c3b284994056b717774b61123af82b39df6853cb7b4c50272a2757138d6b8642.css" integrity="sha384-Gu3KVV2H9d&#43;yA4QDpVB7VcOyhJlAVrcXd0thEjr4KznfaFPLe0xQJyonVxONa4ZC"></noscript>
    
    
    
    <meta name="google-site-verification" content="fbzw9fQcZyEFrrrUtxLfzYW-qhZ5TMEZKHHSp9NeLBw" /><meta name="msvalidate.01" content="EC9CEC799D42793C414AE7BDB0D0205C" /><meta name="yandex-verification" content="c0b808dd3e49f730" /><meta name="baidu-site-verification" content="code-RhPhu2ccLc" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "语法分析 2",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.ginshio.org\/2022\/compilerprinciple_005\/"
        },"image": ["https:\/\/blog.ginshio.org\/screenshot.png"],"genre": "posts","keywords": "Note, DragonBook, SyntacticAnalysis","wordcount":  4489 ,
        "url": "https:\/\/blog.ginshio.org\/2022\/compilerprinciple_005\/","datePublished": "2022-04-12T22:23:17+08:00","dateModified": "2022-04-30T15:09:59+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "GinShio","logo": "https:\/\/blog.ginshio.org\/avatar.webp"},"authors": [{
                        "@type": "Person",
                        "name": "GinShio"                    
                    }],"description": "GinShio | 编译原理第四章 4.4 读书笔记"
    }
    </script><script src="//instant.page/5.1.1" defer type="module" integrity="sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme; }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('light' === 'light' || 'light' === 'dark' || 'light' === 'black') setTheme('light'), saveTheme('light'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="iris"><span class="header-title-pre"><i class="fas fa-terminal"></i></span>iris</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class="fa fa-archive faa-wrench"></i> 归档 </a><a class="menu-item" href="/tags/"><i class="fa fa-tag faa-wrench"></i> 标签 </a><a class="menu-item" href="/categories/"><i class="fa fa-folder-open faa-wrench"></i> 分类 </a><a class="menu-item" href="/series/"><i class="fas fa-object-group"></i> 系列 </a><a class="menu-item" href="/about/"><i class="fa fa-info-circle faa-wrench"></i> 关于 </a><a class="menu-item" href="/links/"><i class="fa fa-user-friends faa-wrench"></i> 友人帐 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="iris"><span class="header-title-pre"><i class="fas fa-terminal"></i></span>iris</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title=""><i class="fa fa-archive faa-wrench"></i>归档</a><a class="menu-item" href="/tags/" title=""><i class="fa fa-tag faa-wrench"></i>标签</a><a class="menu-item" href="/categories/" title=""><i class="fa fa-folder-open faa-wrench"></i>分类</a><a class="menu-item" href="/series/" title=""><i class="fas fa-object-group"></i>系列</a><a class="menu-item" href="/about/" title=""><i class="fa fa-info-circle faa-wrench"></i>关于</a><a class="menu-item" href="/links/" title=""><i class="fa fa-user-friends faa-wrench"></i>友人帐</a><a href="#" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#递归下降的语法分析">递归下降的语法分析</a>
      <ul>
        <li><a href="#一个简单的示例">一个简单的示例</a></li>
        <li><a href="#first-与-follow">FIRST 与 FOLLOW</a></li>
        <li><a href="#计算-first">计算 FIRST</a></li>
        <li><a href="#计算-follow">计算 FOLLOW</a></li>
        <li><a href="#示例的-first-和-follow-计算">示例的 FIRST 和 FOLLOW 计算</a></li>
      </ul>
    </li>
    <li><a href="#ll--1--文法">LL(1) 文法</a>
      <ul>
        <li><a href="#预测分析器的转换图">预测分析器的转换图</a></li>
        <li><a href="#ll--1--文法判断">LL(1) 文法判断</a></li>
        <li><a href="#构造-ll--1--文法预测分析表">构造 LL(1) 文法预测分析表</a></li>
      </ul>
    </li>
    <li><a href="#非递归的预测分析">非递归的预测分析</a></li>
    <li><a href="#预测分析中的错误恢复">预测分析中的错误恢复</a>
      <ul>
        <li><a href="#panic-模式">panic 模式</a></li>
        <li><a href="#短语层次恢复">短语层次恢复</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">语法分析 2</h1><h2 class="single-subtitle">自顶向下语法分析</h2><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><i class="author fas fa-user-circle fa-fw"></i><span class='screen-reader-text'>  </span><a href='https://blog.ginshio.org/authors/ginshio'>GinShio</a></span>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/compilerprinciple/"><i class="far fa-folder fa-fw"></i>CompilerPrinciple</a></span>&nbsp;<span class="post-category">和</span>&nbsp;<span class="post-series">系列 <a href="/series/%E9%BE%99%E4%B9%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="far fa-list-alt fa-fw"></i>龙书学习笔记</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="04-12">04-12</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="04-30">04-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4489 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;</div>
        </div><div class="details series-nav open">
                                <div class="details-summary series-title">
                                    <span>系列 - 龙书学习笔记</span>
                                    <span><i class="details-icon fas fa-angle-right"></i></span>
                                </div>
                                <div class="details-content series-content">
                                    <nav>
                                        <ul>
                                                    <li><a href="/2020/compilerprinciple_001/">编译器与程序设计语言</a></li>
                                                    <li><a href="/2020/compilerprinciple_002/">词法分析 1</a></li>
                                                    <li><a href="/2020/compilerprinciple_003/">词法分析 2</a></li>
                                                    <li><a href="/2020/compilerprinciple_004/">语法分析 1</a></li><li><span class="active">语法分析 2</span></li>
                                                    <li><a href="/2022/compilerprinciple_006/">语法分析 3</a></li>
                                                    <li><a href="/2022/compilerprinciple_007/">语法制导翻译</a></li>
                                                    <li><a href="/2022/compilerprinciple_008/">中间代码生成</a></li></ul>
                                    </nav>
                                </div>
                            </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#递归下降的语法分析">递归下降的语法分析</a>
      <ul>
        <li><a href="#一个简单的示例">一个简单的示例</a></li>
        <li><a href="#first-与-follow">FIRST 与 FOLLOW</a></li>
        <li><a href="#计算-first">计算 FIRST</a></li>
        <li><a href="#计算-follow">计算 FOLLOW</a></li>
        <li><a href="#示例的-first-和-follow-计算">示例的 FIRST 和 FOLLOW 计算</a></li>
      </ul>
    </li>
    <li><a href="#ll--1--文法">LL(1) 文法</a>
      <ul>
        <li><a href="#预测分析器的转换图">预测分析器的转换图</a></li>
        <li><a href="#ll--1--文法判断">LL(1) 文法判断</a></li>
        <li><a href="#构造-ll--1--文法预测分析表">构造 LL(1) 文法预测分析表</a></li>
      </ul>
    </li>
    <li><a href="#非递归的预测分析">非递归的预测分析</a></li>
    <li><a href="#预测分析中的错误恢复">预测分析中的错误恢复</a>
      <ul>
        <li><a href="#panic-模式">panic 模式</a></li>
        <li><a href="#短语层次恢复">短语层次恢复</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>自顶向下语法可以被看作输入串构造语法分析树的问题，从语法分析树的根结点开始，深度优先创建这棵树的各个结点。</p>
<p>对于输入 <strong>id</strong> <code>+</code> <strong>id</strong> <code>*</code> <strong>id</strong>，可以根据最左推导序列产生语法分析树序列：
\[\begin{aligned}
E &amp;\rightarrow TE^{&rsquo;}\\
E^{&rsquo;} &amp;\rightarrow +\ T\ E^{&rsquo;}\,|\,\varepsilon\\
T &amp;\rightarrow FT^{&rsquo;}\\
T^{&rsquo;} &amp;\rightarrow *\ F\ T^{&rsquo;}\,|\,\varepsilon\\
F &amp;\rightarrow (\ E\ )\,|\,\textbf{id}\\
\end{aligned}\]</p>
<p>根据左推导有如下自顶向下分析过程</p>
<figure><img src="/images/id-plus-id-multi-id-example-lm-top-down.svg"/>
</figure>

<h2 id="递归下降的语法分析" class="headerLink">
    <a href="#%e9%80%92%e5%bd%92%e4%b8%8b%e9%99%8d%e7%9a%84%e8%af%ad%e6%b3%95%e5%88%86%e6%9e%90" class="header-mark"></a>递归下降的语法分析</h2><p>递归下降的语法分析由一组过程组成，每个非终结符有一个对应的过程，程序的执行从开始符号对应的过程开始，如果这个过程扫描了整个输入串，就停止执行并宣布语法分析完成。</p>
<p>通用递归下降分析技术可能需要回溯，即重复扫描输入串。在 PL 构造进行语法分析时很少回溯，因此需要回溯的语法分析器并不常见。自然语言分析的场合，回溯也不高效，因此更加倾向基于表格的语法分析方法，如 DP 或 Earley 方法。</p>
<h3 id="一个简单的示例" class="headerLink">
    <a href="#%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e7%a4%ba%e4%be%8b" class="header-mark"></a>一个简单的示例</h3><p>考虑文法 \[\begin{aligned} S &amp;\rightarrow c\,A\,d\\ A &amp;\rightarrow a\,b \ |\ a\\ \end{aligned}\]
自顶向下构造串 \(w=cad\)，初始结点指向 w 的第一个字符，即标号为 S 的结点指向 c，将会得到图 <a href="#figure--fig:top-down-parsing-process-example" rel="">1</a> (a) 中的树，字符c 匹配。</p>
<p><a id="figure--fig:top-down-parsing-process-example"></a></p>
<figure><img src="/images/top-down-parsing-process-example.svg"
         alt="Figure 1: 自顶向下语法分析器过程"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>自顶向下语法分析器过程</p>
        </figcaption>
</figure>

<p>将 <em>A</em> 用 \(\textit{A} \rightarrow ab\) 展开得到图
<a href="#figure--fig:top-down-parsing-process-example" rel="">1</a> (b) 的树，第二个字符 a 匹配，此时指针推进到第三个字符 d。由于 b 与 d 不匹配，将报告失败，并回到 A 开始尝试之前未进行的且有可能匹配的其他产生式，图 <a href="#figure--fig:top-down-parsing-process-example" rel="">1</a> (c) 所示。</p>
<p>左递归的文法会让递归下降语法分析器陷入死循环，即使有回溯也是如此。</p>
<h3 id="first-与-follow" class="headerLink">
    <a href="#first-%e4%b8%8e-follow" class="header-mark"></a>FIRST 与 FOLLOW</h3><p>自顶向下的语法分析器构造都可以采用 FIRST 和 FOLLOW 来实现。这两个函数让我们可以根据下一个输入符来选择如何应用产生式。而 painc 恢复可以由 FOLLOW 产生的词法单元合集作为同步词法单元。</p>
<p>\(\texttt{FIRST}(\alpha)\) 被定义为可以从 \(\alpha\) 推导得到的串的首符号集合。如果 \(\alpha
\xRightarrow{*}\varepsilon\)，那么 \(\varepsilon\) 也在 \(\texttt{FIRST}(\alpha)\) 中。在之前的示例中，就是 \(\textit{A} \xRightarrow{*} c\gamma\)，因此 \(c\) 在 \(\texttt{FIRST}(\alpha)\) 中，如图 <a href="#figure--fig:top-down-parsing-process-example-follow-and-first" rel="">2</a> 所示。</p>
<p><a id="figure--fig:top-down-parsing-process-example-follow-and-first"></a></p>
<figure><img src="/images/top-down-parsing-process-example-follow-and-first.svg"
         alt="Figure 2: 终结符 c 在 FIRST(A) 中且 a 在 FOLLOW(A) 中"/><figcaption>
            <p><span class="figure-number">Figure 2: </span>终结符 c 在 <code>FIRST</code>(<em>A</em>) 中且 a 在 <code>FOLLOW</code>(<em>A</em>) 中</p>
        </figcaption>
</figure>

<p>考虑两个 A 的产生式 \(\textit{A} \rightarrow \alpha\,|\,\beta\)，其中 \(\texttt{FIRST}(\alpha)\) 和
\(\texttt{FIRST}(\beta)\) 是不相交的集合。那么只需要查看下一个输入符号 a 就可以选择产生式。因为 a 只能出现在 \(\texttt{FIRST}(\alpha)\) 或 \(\texttt{FIRST}(\beta)\) 中，但不能同时出现在两个集合中。</p>
<p>对于非终结符 <em>A</em>，\(\texttt{FOLLOW}(\textit{A})\) 被定义为可能在某些句型中紧跟在
<em>A</em> 右边的终结符的集合。如图
<a href="#figure--fig:top-down-parsing-process-example-follow-and-first" rel="">2</a> 所示
\(\textit{S}\xRightarrow{*}\alpha\textit{A}a\beta\) 的推导，\(\alpha\) 和 \(\beta\) 是文法符号串，终结符 a 在 \(\texttt{FOLLOW}(\textit{A})\) 中。</p>
<h3 id="计算-first" class="headerLink">
    <a href="#%e8%ae%a1%e7%ae%97-first" class="header-mark"></a>计算 FIRST</h3><p>计算各个文法符号 <em>X</em> 的 \(\texttt{FRIST}(\textit{X})\) 时，不断应用以下规则，直到没有新的终结符或 \(\varepsilon\) 可以被加入。</p>
<ol>
<li>如果 <em>X</em> 是一个终结符，那么 \(\texttt{FIRST}(\textit{X})=\textit{X}\)</li>
<li>如果 <em>X</em> 是一个非终结符，且 \(\textit{X} \rightarrow
\textit{Y}_{1}\textit{Y}_{2}\cdots\textit{Y}_{k} (k \ge 1)\) 是一个产生式
<ol>
<li>如果对于某个 i，a 在\(\texttt{FIRST}(\textit{Y}_{i})\) 中且 \(\varepsilon\) 在所有的 \(\texttt{FIRST}(\textit{Y}_{1})\)、
\(\texttt{FIRST}(\textit{Y}_{2})\)、\(\cdots\)、
\(\texttt{FIRST}(\textit{Y}_{i-1})\) 中，那么就把 a 加入到
\(\texttt{FIRST}(\textit{X})\) 中，即
\(\textit{Y}_{1}\cdots\textit{Y}_{i-1}\xRightarrow{*}\varepsilon\)</li>
<li>如果对于所有的 \(j=1, 2, \cdots, k\)，\(\varepsilon\) 在
\(\texttt{FIRST}(\textit{Y}_{j})\) 中，那么将 \(\varepsilon\) 加入到
\(\texttt{FIRST}(\textit{X})\) 中。</li>
<li>如果 \(\textit{Y}_{1}\) 不能推导出 \(\varepsilon\)，那么我们就不再向
\(\texttt{FIRST}(\textit{X})\) 中加入任何符号，但如果
\(\textit{Y}_{1}\xRightarrow{*}\varepsilon\)，就加上
\(\texttt{FIRST}(\textit{Y}_{2})\)，依此类推。</li>
</ol>
</li>
<li>如果 \(\textit{X}\rightarrow\varepsilon\) 是一个产生式，那么将 \(\varepsilon\) 加入到
\(\texttt{FIRST}(\textit{X})\) 中</li>
</ol>
<p>简单地说，计算任何串 \(\textit{X}_{1}\textit{X}_{2}\cdots\textit{X}_{n}\) 的 <code>FIRST</code>
集合：向 \(\texttt{FIRST}(\textit{X}_{1}\textit{X}_{2}\cdots\textit{X}_{n})\) 加入
\(\texttt{FIRST}(\textit{X}_{1})\) 的所有非 \(\varepsilon\) 运算符，如果 \(\varepsilon\) 在
\(\texttt{FIRST}(\textit{X}_{1})\) 中，那么加入
\(\texttt{FIRST}(\textit{X}_{2})\) 的所有非 \(\varepsilon\) 运算符，如果 \(\varepsilon\) 在
\(\texttt{FIRST}(\textit{X}_{1})\) 和 \(\texttt{FIRST}(\textit{X}_{2})\) 中则加入 \(\texttt{FIRST}(\textit{X}_{3})\) 的所有非 \(\varepsilon\) 运算符，依此类推。</p>
<h3 id="计算-follow" class="headerLink">
    <a href="#%e8%ae%a1%e7%ae%97-follow" class="header-mark"></a>计算 FOLLOW</h3><p>计算各个文法符号 <em>X</em> 的 \(\texttt{FRIST}(\textit{X})\) 时，不断应用以下规则，直到没有新的终结符可以被加入。</p>
<ol>
<li>将 <code>$</code> 放到 \(\texttt{FOLLOW}(\textit{S})\) 中，其中 <em>S</em> 是开始符号，而 <code>$</code>
是输入右端的结束符号</li>
<li>如果存在一个产生式 \(\textit{A}\rightarrow\alpha\textit{B}\beta\)，那么 \(\texttt{FIRST}(\beta)\)
中除 \(\varepsilon\) 外的所有符号都在 \(\texttt{FOLLOW}(\textit{B})\) 中</li>
<li>如果存在一个产生式 \(\textit{A}\rightarrow\alpha\textit{B}\)，或存在产生式
\(\textit{A}\rightarrow\alpha\textit{B}\beta\) 且 \(\texttt{FIRST}(\beta)\) 包含 \(\varepsilon\)，那么
\(\texttt{FOLLOW}(\textit{A})\) 中的所有符号都在
\(\texttt{FOLLOW}(\textit{B})\) 中。</li>
</ol>
<h3 id="示例的-first-和-follow-计算" class="headerLink">
    <a href="#%e7%a4%ba%e4%be%8b%e7%9a%84-first-%e5%92%8c-follow-%e8%ae%a1%e7%ae%97" class="header-mark"></a>示例的 FIRST 和 FOLLOW 计算</h3><p>对于示例 <strong>id</strong> <code>+</code> <strong>id</strong> <code>*</code> <strong>id</strong>，我们可以如此计算 FIRST 与 FOLLOW。</p>
<ol>
<li>\(\texttt{FIRST}(\textit{F})\ =\ \texttt{FIRST}(\textit{T})\ =\
\texttt{FIRST}(\textit{E})\ =\ \{(,\textbf{id}\}\)。<em>F</em> 的产生式以终结符
<strong>id</strong> 和左括号开头；<em>T</em> 只有 <em>F</em> 开头的产生式，<em>F</em> 不能推出 \(\varepsilon\)，因此
\(\texttt{FIRST}(\textit{T})\) 与 \(\texttt{FIRST}(\textit{F})\) 必然相同；对 \(\texttt{FIRST}(\textit{E})\) 论据相同。</li>
<li>\(\texttt{FIRST}(\textit{E}^{&rsquo;}) = \{+, \varepsilon\}\)。\(\textit{E}^{&rsquo;}\) 的两个产生式中，一个以 \(+\) 开头，而另一个为 \(\varepsilon\)。只要有一个 \(\varepsilon\) 我们就将其加入 <code>FIRST</code> 中。</li>
<li>\(\texttt{FIRST}(\textit{T}^{&rsquo;}) = \{*, \varepsilon\}\)。论据同 2。</li>
<li>\(\texttt{FOLLOW}(\textit{E}) = \texttt{FOLLOW}(\textit{E}^{&rsquo;}) = \{), \$\}\)。因为 <em>E</em> 是开始符号，因此 \(\texttt{FOLLOW(\textit{E})}\) 一定包含 \(\$\)。产生式 <em>(E)</em> 说明了右括号为什么在 <code>FOLLOW</code> 当中。对于 \(\textit{E}^{&rsquo;}\)，非终结符只出现在了 <em>E</em> 产生式的尾部，因此 \(\texttt{FOLLOW}(\textit{E})\) 必然与
\(\texttt{FOLLOW}(\textit{E}^{&rsquo;})\) 相同。</li>
<li>\(\texttt{FOLLOW}(\textit{T}) = \texttt{FOLLOW}(\textit{T}^{&rsquo;}) = \{+, ),
\$\}\)。在所有产生式体中 <em>T</em> 只有 \(\textit{E}^{&rsquo;}\) 跟在后面，因此
\(\texttt{FIRST}(\textit{E}^{&rsquo;})\) 中除 \(\varepsilon\) 外所有符号都在
\(\texttt{FOLLOW}(\textit{T})\) 中。另外 \(\texttt{FIRST}(\textit{E}^{&rsquo;})\)
包含 \(\varepsilon\) (即 \(\textit{E}^{&rsquo;} \xRightarrow[lm]{} \varepsilon\))，且 <em>E</em> 产生体中
\(\textit{E}^{&rsquo;}\) 跟在 <em>T</em> 之后，因此 \(\texttt{FOLLOW}(\textit{E})\) 中的所有符号出现在 \(\texttt{FOLLOW}(\textit{T})\) 中。而 \(\textit{T}^{&rsquo;}\) 只出现在 <em>T</em> 产生式的末尾，因此 \(\texttt{FOLLOW}(\textit{T}) =
\texttt{FOLLOW}(\textit{T}^{&rsquo;})\)</li>
<li>\(\texttt{FOLLOW}(\textit{F}) = \{+, *, ), \$\}\)。论据同 5。</li>
</ol>
<h2 id="ll--1--文法" class="headerLink">
    <a href="#ll--1--%e6%96%87%e6%b3%95" class="header-mark"></a>LL(1) 文法</h2><p>LL(1) 文法，表示从左向右扫描输入，产生最左推导的文法，而 <code>1</code> 表示每一步只需要向前看一个输入符号来决定语法分析动作。</p>
<p>LL(1) 文法我们可以构造除预测分析器，即不需要回溯的递归下降语法。但是需要注意的是，左递归文法和二义性文法都不是 LL(1) 的。</p>
<h3 id="预测分析器的转换图" class="headerLink">
    <a href="#%e9%a2%84%e6%b5%8b%e5%88%86%e6%9e%90%e5%99%a8%e7%9a%84%e8%bd%ac%e6%8d%a2%e5%9b%be" class="header-mark"></a>预测分析器的转换图</h3><p>转换图有助于将预测分析器可视化，构造一个文法的转换图，首先要消除左递归，然后对文法提取左公因子，之后对每个非终结符 A 进行：</p>
<ol>
<li>创建一个初始状态和结束状态</li>
<li>对每个产生式 \(\textit{A} \rightarrow \textit{X}_{1}\textit{X}_{2}\cdots\textit{X}_{n}\)
创建一个从初始状态到结束状态的路经</li>
</ol>
<p>预测分析器的转换图与词法分析器的转换图是不同的：分析器对每个非终结符都有图，边的标号可以是词法单元也可以是非终结符；词法分析器表示下一个输入符号输入时应该执行的转换。</p>
<figure><img src="/images/predictive-analyzer-transformation-graph-for-e-and-e-skim.svg"/>
</figure>

<h3 id="ll--1--文法判断" class="headerLink">
    <a href="#ll--1--%e6%96%87%e6%b3%95%e5%88%a4%e6%96%ad" class="header-mark"></a>LL(1) 文法判断</h3><p>当且仅当文法 G 的任意两个不同的表达式 \(\textit{A} \rightarrow \alpha\,|\,\beta\) 满足以下条件时，G
是 LL(1) 文法：</p>
<ol>
<li>不存在终结符 a 使得 \(\alpha\) 和 \(\beta\) 都能够推导出以 a 开头的串</li>
<li>\(\alpha\) 和 \(\beta\) 中最多只有一个可以推导出空</li>
<li>如果 \(\beta \xRightarrow{*} \varepsilon\)，那么 \(\alpha\) 不能推导出任何以
\(\texttt{FOLLOW}(\textit{A})\) 中某个终结符开头的串。反之亦然。</li>
</ol>
<p>前两个条件说明 \(\texttt{FIRST}(\alpha)\) 和 \(\texttt{FIRST}(\beta)\) 是不相交的集合。第三个条件说明，如果 \(\varepsilon\) 在 \(\texttt{FIRST}(\beta)\) 中，那么 \(\texttt{FIRST}(\alpha)\)
与 \(\texttt{FOLLOW}(\textit{A})\) 是不相交的集合。</p>
<h3 id="构造-ll--1--文法预测分析表" class="headerLink">
    <a href="#%e6%9e%84%e9%80%a0-ll--1--%e6%96%87%e6%b3%95%e9%a2%84%e6%b5%8b%e5%88%86%e6%9e%90%e8%a1%a8" class="header-mark"></a>构造 LL(1) 文法预测分析表</h3><p>预测分析表是构造 LL(1) 文法预测分析器的重要方法。也需要用到 \(\texttt{FIRST}\)
和 \(\texttt{FOLLOW}\) 函数。</p>
<div class="verse">
<p>输入：文法 G<br />
输出：预测分析表 M<br />
方法：对于文法 G 每个产生式 \(\textit{A} \rightarrow \alpha\) 有<br />
  1. 对于 \(\texttt{FIRST}(\alpha)\) 中的每个终结符 a，将 \(\textit{A} \rightarrow \alpha\) 加入到 \(\textit{M}[\textit{A}, a]\) 中<br />
  2. 如果 \(\varepsilon\) 在 \(\texttt{FIRST}(\alpha)\) 中，那么对于 \(\texttt{FOLLOW}(\textit{A})\) 中的每个终结符 b，将 \(\textit{A} \rightarrow \alpha\) 加入到 \(\textit{M}[\textit{A}, b]\) 中。如果 \(\$\) 也在 \(\texttt{FOLLOW}(\textit{A})\) 中，那也将 \(\textit{A} \rightarrow \alpha\) 加入到 \(\textit{M}[\textit{A}, \$]\) 中<br /></p>
</div>
<p>对于示例 <strong>id</strong> <code>+</code> <strong>id</strong> <code>*</code> <strong>id</strong> 可以构造出如下分析表</p>
<table>
<thead>
<tr>
<th>非终结符</th>
<th><strong>id</strong></th>
<th><code>+</code></th>
<th><code>*</code></th>
<th><code>(</code></th>
<th><code>)</code></th>
<th><code>$</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><em>E</em></td>
<td>\(\textit{E} \rightarrow \textit{TE}^{&rsquo;}\)</td>
<td></td>
<td></td>
<td>\(\textit{E} \rightarrow \textit{TE}^{&rsquo;}\)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>\(\textit{E}^{&rsquo;}\)</td>
<td></td>
<td>\(\textit{E}^{&rsquo;} \rightarrow + \textit{TE}^{&rsquo;}\)</td>
<td></td>
<td></td>
<td>\(\textit{E}^{&rsquo;} \rightarrow \varepsilon\)</td>
<td>\(\textit{E}^{&rsquo;} \rightarrow \varepsilon\)</td>
</tr>
<tr>
<td><em>T</em></td>
<td>\(\textit{T} \rightarrow \textit{FT}^{&rsquo;}\)</td>
<td></td>
<td></td>
<td>\(\textit{T} \rightarrow \textit{FT}^{&rsquo;}\)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>\(\textit{T}^{&rsquo;}\)</td>
<td></td>
<td>\(\textit{T}^{&rsquo;} \rightarrow \varepsilon\)</td>
<td>\(\textit{T}^{&rsquo;} \rightarrow * \textit{FT}^{&rsquo;}\)</td>
<td></td>
<td>\(\textit{T}^{&rsquo;} \rightarrow \varepsilon\)</td>
<td>\(\textit{T}^{&rsquo;} \rightarrow \varepsilon\)</td>
</tr>
<tr>
<td><em>F</em></td>
<td>\(\textit{F} \rightarrow \textbf{id}\)</td>
<td></td>
<td></td>
<td>\(\textit{F} \rightarrow (\textit{E})\)</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>如果一个文法是左递归或有二义性的，那么 M 中至少会包含一个多重定义的条目。比如悬空-else 文法
\[\begin{aligned}
\textit{S} &amp;\rightarrow i\textit{E}t\textit{SS}^{&rsquo;}\ |\ a\\
\textit{S}^{&rsquo;} &amp;\rightarrow e\textit{S}\ |\ \varepsilon\\
\textit{E} &amp;\rightarrow b\\
\end{aligned}\]</p>
<p>它的分析表如下</p>
<table>
<thead>
<tr>
<th>非终结符</th>
<th>a</th>
<th>b</th>
<th>e</th>
<th>i</th>
<th>t</th>
<th>\(\$\)</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>S</em></td>
<td>\(\textit{S} \rightarrow a\)</td>
<td></td>
<td></td>
<td>\(\textit{S} \rightarrow i\textit{E}t\textit{SS}^{&rsquo;}\)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>\(\textit{S}^{&rsquo;}\)</td>
<td></td>
<td></td>
<td>\(\textit{S}^{&rsquo;} \rightarrow \varepsilon\), \(\textit{S}^{&rsquo;} \rightarrow e\textit{S}\)</td>
<td></td>
<td></td>
<td>\(\textit{S}^{&rsquo;} \rightarrow \varepsilon\)</td>
</tr>
<tr>
<td><em>E</em></td>
<td></td>
<td>\(\textit{E} \rightarrow b\)</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>可以看到 \(\textit{M}[\textit{S}^{&rsquo;}, e]\) 不止一个条目，LL(1) 文法预测分析表会披露出文法中存在的二义性。</p>
<h2 id="非递归的预测分析" class="headerLink">
    <a href="#%e9%9d%9e%e9%80%92%e5%bd%92%e7%9a%84%e9%a2%84%e6%b5%8b%e5%88%86%e6%9e%90" class="header-mark"></a>非递归的预测分析</h2><p>构造递归的预测分析是隐式使用栈，可以采用迭代的方式显示使用栈，如果 w 是已匹配完成的输入部分，那么栈中保存的文法符号序列 \(\alpha\) 满足
\[S \xRightarrow[lm]{*}w\alpha.\]</p>
<p>由分析表驱动的语法分析器有一个输入缓冲区，一个包含了文法符号序列的栈，一个预测分析表，以及一个输出流。</p>
<figure><img src="/images/analysis-table-driven-predictive-analyzer-model.svg"/>
</figure>

<p>它的输入缓冲区中包含要进行语法分析的串，串后面跟着结束标记\(\$\)。我们复用符号
\(\$\)来标记栈底，在开始时刻栈中\(\$\)的上方的开始符号S。</p>
<p>预测分析程序考虑栈顶符号 <em>X</em> 和当前输入符号 a，如果 <em>X</em> 是非终结符，查询分析表
\(\textit{M}[\textit{X}, a]\) 来选择一个 <em>X</em> 的产生式；否则检查终结符 <em>X</em> 和当前输入符 a 是否匹配。语法分析器的行为可以用配置 (configuration) 来描述，
configuration 描述了栈中的内容和余下的输入。</p>
<div class="verse">
<p>输入：一个串 w，文法 G 的预测分析表 <em>M</em><br />
输出：如果 w 在 \(\textit{L}(\textit{G})\) 中，输出 w 的最左推导，否则输出错误提示<br />
方法：最初输入缓冲区中是 \(w\$\)，而 G 开始符号 <em>S</em> 位于栈顶，它下面是 \(\$\)。<br /></p>
</div>
<p>算法如下：
#+begin_verse
设置 ip (输入指针) 使其指向 w 的第一个符号;
令 <em>X</em> 为栈顶符号;
<strong>while</strong> (\(\textit{X} \ne \$\)) {
<strong>if</strong> (<em>X</em> == ip 指向的符号 a) {
执行出栈操作;
将 ip 向前移动一个位置;
} <strong>else if</strong> (<em>X</em> 是一个终结符 <strong>or</strong> \(\textit{M}[\textit{X}, a]\) 是一个报错条目) {
error();
} <strong>else if</strong> (\(\textit{M}[\textit{X}, a] = \textit{X} \rightarrow Y_{1}Y_{2}\cdots Y_{k}\)) {
输出产生式 \(\textit{X} \rightarrow Y_{1}Y_{2}\cdots Y_{k}\);
执行出栈操作;
将 \(Y_{1}Y_{2}\cdots Y_{k}\) 入栈，其中 \(Y_{1}\) 位于栈顶;
}
令 <em>X</em> 为栈顶符号;
}
#+end_vers</p>
<p>在之前已经有了示例 <strong>id</strong> <code>+</code> <strong>id</strong> <code>*</code> <strong>id</strong> 的预测分析表了，现在展示以下其执行步骤</p>
<table>
<thead>
<tr>
<th>已匹配</th>
<th>栈</th>
<th>输入</th>
<th>操作</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>\(\textit{E}\$\)</td>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\$\)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>\(\textit{TE}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{E}\rightarrow\textit{TE}^{&rsquo;}\)</td>
</tr>
<tr>
<td></td>
<td>\(\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{T}\rightarrow\textit{FT}^{&rsquo;}\)</td>
</tr>
<tr>
<td></td>
<td>\(\textbf{id}\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{F}\rightarrow\textbf{id}\)</td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>\(\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}*\textbf{id}\$\)</td>
<td>匹配 <strong>id</strong></td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>\(\textit{E}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{T}^{&rsquo;}\rightarrow\varepsilon\)</td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>\(+\textit{TE}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{E}^{&rsquo;}\rightarrow+\textit{TE}^{&rsquo;}\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\)</td>
<td>\(\textit{TE}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}*\textbf{id}\$\)</td>
<td>匹配 \(+\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\)</td>
<td>\(\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{T}\rightarrow\textit{FT}^{&rsquo;}\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\)</td>
<td>\(\textbf{id}\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}*\textbf{id}\$\)</td>
<td>输出 \(\textit{F}\rightarrow\textbf{id}\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}\)</td>
<td>\(\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(*\textbf{id}\$\)</td>
<td>匹配 <strong>id</strong></td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}\)</td>
<td>\(*\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(*\textbf{id}\$\)</td>
<td>输出 \(\textit{T}^{&rsquo;}\rightarrow*\textit{FT}^{&rsquo;}\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}*\)</td>
<td>\(\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}\$\)</td>
<td>匹配 \(*\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}*\)</td>
<td>\(\textbf{id}\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}\$\)</td>
<td>输出 \(\textit{F}\rightarrow\textbf{id}\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\)</td>
<td>\(\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\$\)</td>
<td>匹配 <strong>id</strong></td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\)</td>
<td>\(\textit{E}^{&rsquo;}\$\)</td>
<td>\(\$\)</td>
<td>输出 \(\textit{T}^{&rsquo;}\rightarrow\varepsilon\)</td>
</tr>
<tr>
<td>\(\textbf{id}+\textbf{id}*\textbf{id}\)</td>
<td>\(\$\)</td>
<td>\(\$\)</td>
<td>输出 \(\textit{E}^{&rsquo;}\rightarrow\varepsilon\)</td>
</tr>
</tbody>
</table>
<h2 id="预测分析中的错误恢复" class="headerLink">
    <a href="#%e9%a2%84%e6%b5%8b%e5%88%86%e6%9e%90%e4%b8%ad%e7%9a%84%e9%94%99%e8%af%af%e6%81%a2%e5%a4%8d" class="header-mark"></a>预测分析中的错误恢复</h2><p>当栈顶的终结符和下一个输入不匹配时，或当前非终结符 <em>A</em> 处于栈顶但
\(\textit{M}[\textit{A}, a]\) 为 <strong>error</strong> 时，预测分析器就会检测到语法错误。</p>
<h3 id="panic-模式" class="headerLink">
    <a href="#panic-%e6%a8%a1%e5%bc%8f" class="header-mark"></a>panic 模式</h3><p>panic 模式的错误恢复是基于以下思想：语法分析器忽略输入中的一些符号，直到输入中出现同步词法单元。这依赖于同步集合的选取。选取原则是使得语法分析器能够从实践中可能遇到的错误中快速恢复。有一些启发式的规则：</p>
<ol>
<li>将 \(\texttt{FOLLOW}(\textit{A})\) 中的所有符号都放在非终结符 <em>A</em> 的同步集合中。如果不断忽略一些词法单元，直到碰到了 \(\texttt{FOLLOW}(\textit{A})\)
中的某个元素，再将 <em>A</em> 从栈中弹出，可能语法分析器就能继续进行了。</li>
<li>只用 \(\texttt{FOLLOW}(\textit{A})\) 是不够的。如 C 语言采用分号结尾，而遗漏分号可能导致语法分析器忽略下一个语句开头的关键字。我们可以将较高层次的开始符加入到较低层次的同步集合中。</li>
<li>如果将 \(\texttt{FIRST}(\textit{A})\) 加入到非终结符 <em>A</em> 的同步集合，那么当其中符号出现在输入中，可能可以根据 <em>A</em> 继续进行语法分析</li>
<li>如果一个非终结符可以产生空串，那么可以将空串作为默认值使用。这么做可能会推迟错误检测，但不会遗漏。并且减少需要考虑的非终结符数量。</li>
<li>如果栈顶的一个终结符不能和输入匹配，最简单的方法是将其弹出栈，发出消息称已经插入这个终结符，并继续语法分析。这个方法是将其他词法单元的合集作为同步集合。</li>
</ol>
<p>因此我们可以将 <code>FOLLOW</code> 作为同步词法单元，重绘预测分析表，示例 <strong>id</strong> <code>+</code> <strong>id</strong> <code>*</code>
<strong>id</strong> 的预测分析表如下</p>
<table>
<thead>
<tr>
<th>非终结符</th>
<th><strong>id</strong></th>
<th><code>+</code></th>
<th><code>*</code></th>
<th><code>(</code></th>
<th><code>)</code></th>
<th><code>$</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><em>E</em></td>
<td>\(\textit{E} \rightarrow \textit{TE}^{&rsquo;}\)</td>
<td></td>
<td></td>
<td>\(\textit{E} \rightarrow \textit{TE}^{&rsquo;}\)</td>
<td>synch</td>
<td>synch</td>
</tr>
<tr>
<td>\(\textit{E}^{&rsquo;}\)</td>
<td></td>
<td>\(\textit{E}^{&rsquo;} \rightarrow + \textit{TE}^{&rsquo;}\)</td>
<td></td>
<td></td>
<td>\(\textit{E}^{&rsquo;} \rightarrow \varepsilon\)</td>
<td>\(\textit{E}^{&rsquo;} \rightarrow \varepsilon\)</td>
</tr>
<tr>
<td><em>T</em></td>
<td>\(\textit{T} \rightarrow \textit{FT}^{&rsquo;}\)</td>
<td>synch</td>
<td></td>
<td>\(\textit{T} \rightarrow \textit{FT}^{&rsquo;}\)</td>
<td>synch</td>
<td>synch</td>
</tr>
<tr>
<td>\(\textit{T}^{&rsquo;}\)</td>
<td></td>
<td>\(\textit{T}^{&rsquo;} \rightarrow \varepsilon\)</td>
<td>\(\textit{T}^{&rsquo;} \rightarrow * \textit{FT}^{&rsquo;}\)</td>
<td></td>
<td>\(\textit{T}^{&rsquo;} \rightarrow \varepsilon\)</td>
<td>\(\textit{T}^{&rsquo;} \rightarrow \varepsilon\)</td>
</tr>
<tr>
<td><em>F</em></td>
<td>\(\textit{F} \rightarrow \textbf{id}\)</td>
<td>synch</td>
<td>synch</td>
<td>\(\textit{F} \rightarrow (\textit{E})\)</td>
<td>synch</td>
<td>synch</td>
</tr>
</tbody>
</table>
<p>如果输入串是 \(+\textbf{id}*+\textbf{id}\) 这样的错误输入，可以得到如此语法分析过程</p>
<table>
<thead>
<tr>
<th>已匹配</th>
<th>栈</th>
<th>输入</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>\(\textit{E}\$\)</td>
<td>\(+\textbf{id}*+\textbf{id}\$\)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>\(\textit{E}\$\)</td>
<td>\(\textbf{id}*+\textbf{id}\$\)</td>
<td>错误，\(+\)略过</td>
</tr>
<tr>
<td></td>
<td>\(\textit{TE}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}*+\textbf{id}\$\)</td>
<td>输出 \(\textit{E}\rightarrow\textit{TE}^{&rsquo;}\)</td>
</tr>
<tr>
<td></td>
<td>\(\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}*+\textbf{id}\$\)</td>
<td>输出 \(\textit{T}\rightarrow\textit{FT}^{&rsquo;}\)</td>
</tr>
<tr>
<td></td>
<td>\(\textbf{id}\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}*+\textbf{id}\$\)</td>
<td>输出 \(\textit{F}\rightarrow\textbf{id}\)</td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>\(\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(*+\textbf{id}\$\)</td>
<td>匹配 <strong>id</strong></td>
</tr>
<tr>
<td><strong>id</strong></td>
<td>\(*\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(*+\textbf{id}\$\)</td>
<td>输出 \(\textit{T}^{&rsquo;}\rightarrow*\textit{FT}^{&rsquo;}\)</td>
</tr>
<tr>
<td>\(\textbf{id}*\)</td>
<td>\(\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}\$\)</td>
<td>匹配 *</td>
</tr>
<tr>
<td>\(\textbf{id}*\)</td>
<td>\(\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}\$\)</td>
<td>\(\textit{M}[\textit{F},+]\), 弹出 <em>F</em></td>
</tr>
<tr>
<td>\(\textbf{id}*\)</td>
<td>\(\textit{E}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}\$\)</td>
<td>输出 \(\textit{T}^{&rsquo;}\rightarrow\varepsilon\)</td>
</tr>
<tr>
<td>\(\textbf{id}*\)</td>
<td>\(+\textit{TE}^{&rsquo;}\$\)</td>
<td>\(+\textbf{id}\$\)</td>
<td>输出 \(\textit{E}^{&rsquo;}\rightarrow+\textit{TE}^{&rsquo;}\)</td>
</tr>
<tr>
<td>\(\textbf{id}*+\)</td>
<td>\(\textit{TE}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}\$\)</td>
<td>匹配 \(+\)</td>
</tr>
<tr>
<td>\(\textbf{id}*+\)</td>
<td>\(\textit{FT}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}\$\)</td>
<td>输出 \(\textit{T}\rightarrow\textit{FT}^{&rsquo;}\)</td>
</tr>
<tr>
<td>\(\textbf{id}*+\)</td>
<td>\(\textbf{id}\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\textbf{id}\$\)</td>
<td>输出 \(\textit{F}\rightarrow\textbf{id}\)</td>
</tr>
<tr>
<td>\(\textbf{id}*+\textbf{id}\)</td>
<td>\(\textit{T}^{&rsquo;}\textit{E}^{&rsquo;}\$\)</td>
<td>\(\$\)</td>
<td>匹配 <strong>id</strong></td>
</tr>
<tr>
<td>\(\textbf{id}*+\textbf{id}\)</td>
<td>\(\textit{E}^{&rsquo;}\$\)</td>
<td>\(\$\)</td>
<td>输出 \(\textit{T}^{&rsquo;}\rightarrow\varepsilon\)</td>
</tr>
<tr>
<td>\(\textbf{id}*+\textbf{id}\)</td>
<td>\(\$\)</td>
<td>\(\$\)</td>
<td>输出 \(\textit{E}^{&rsquo;}\rightarrow\varepsilon\)</td>
</tr>
</tbody>
</table>
<h3 id="短语层次恢复" class="headerLink">
    <a href="#%e7%9f%ad%e8%af%ad%e5%b1%82%e6%ac%a1%e6%81%a2%e5%a4%8d" class="header-mark"></a>短语层次恢复</h3><p>在预测分析表的空白条目中填入过程指针，即可用过程改变、插入或删除输入的符号，并发出适当的错误消息，或执行一些栈操作 (改变栈符号或压入新符号)。</p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 04-30</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/2022/compilerprinciple_005/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://gitlab.com/GinShio/ginshio.gitlab.io/issues/new?issue[title]=[BUG]%20%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90+2&issue[description]=[POST](https://blog.ginshio.org/2022/compilerprinciple_005/)%0A%0A##%20Isseus%0A target="_blank" rel="noopener noreferrer">报告问题</a>
                    </span></div>
            <div class="post-info-share">
                <span><a href="#" title="分享到 Twitter" data-sharer="twitter" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-title="语法分析 2" data-hashtags="Note,DragonBook,SyntacticAnalysis"><i class="fab fa-twitter fa-fw"></i></a><a href="#" title="分享到 Facebook" data-sharer="facebook" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-hashtag="Note"><i class="fab fa-facebook-square fa-fw"></i></a><a href="#" title="分享到 Linkedin" data-sharer="linkedin" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/"><i class="fab fa-linkedin fa-fw"></i></a><a href="#" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-title="语法分析 2" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="#" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-title="语法分析 2"><i class="fab fa-hacker-news fa-fw"></i></a><a href="#" title="分享到 Line" data-sharer="line" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-title="语法分析 2"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="#" title="分享到 Telegram" data-sharer="telegram" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-title="语法分析 2" data-web><i class="fab fa-telegram-plane fa-fw"></i></a><a href="#" class="weixin" title="分享到 微信" data-sharer="weixin" data-url="https://blog.ginshio.org/2022/compilerprinciple_005/" data-title="语法分析 2" data-web><i class="fab fa-weixin fa-fw"></i><img src="https://api.oick.cn/qrcode/api.php?size=256&amp;text=https://blog.ginshio.org/2022/compilerprinciple_005/" title="语法分析 2">
    </a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/note/">Note</a>,&nbsp;<a href="/tags/dragonbook/">DragonBook</a>,&nbsp;<a href="/tags/syntacticanalysis/">SyntacticAnalysis</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022/doom_emacs_configuration/" class="prev" rel="prev" title="Doom Emacs 配置文件"><i class="fas fa-angle-left fa-fw"></i>Doom Emacs 配置文件</a>
            <a href="/2022/compilerprinciple_006/" class="next" rel="next" title="语法分析 3">语法分析 3<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.111.3">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.3.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.ginshio.org/" target="_blank" rel="noopener noreferrer"> </a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div><script>
                    if('serviceWorker' in navigator) {
                        navigator.serviceWorker
                            .register('/sw.min.js', { scope: '/' })
                            .then(function(registration) {
                            });
                
                        navigator.serviceWorker
                            .ready
                            .then(function(registration) {
                            });
                    }
                </script></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/gitalk/gitalk.min.b250718923eb2b3c2ba2de589fcc7f623ebf3efa17f0e501e7de204156024b108524ffafaf0958fd09d3b68cf0412999.css" integrity="sha384-slBxiSPrKzwrot5Yn8x/Yj6/PvoX8OUB594gQVYCSxCFJP&#43;vrwlY/QnTtozwQSmZ"><link rel="stylesheet" href="/lib/katex/katex.min.bcaaee8fe6b5dd4f321c8900c8680ad49dc0ad32f3ac51816c1734b43a7869dfc4c9ec0449e5c4fc8bfaec08fc80a674.css" integrity="sha384-vKruj&#43;a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.1f5388069d157848068f2228e33a72016ef3233cfb0afc2940343e446a708357e5b391b470f94c0e1c80745c331651ca.css" integrity="sha384-H1OIBp0VeEgGjyIo4zpyAW7zIzz7CvwpQDQ&#43;RGpwg1fls5G0cPlMDhyAdFwzFlHK">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.1f5388069d157848068f2228e33a72016ef3233cfb0afc2940343e446a708357e5b391b470f94c0e1c80745c331651ca.css" integrity="sha384-H1OIBp0VeEgGjyIo4zpyAW7zIzz7CvwpQDQ&#43;RGpwg1fls5G0cPlMDhyAdFwzFlHK"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":12},"comment":{"gitalk":{"admin":["GinShio"],"clientID":"96cbbb15f26bebd9141b","clientSecret":"29c7df99d6e1806113996333163a9476027ff1fa","id":"2022-04-12T22:23:17+08:00","owner":"GinShio","repo":"ginshio.github.io","title":"语法分析 2"}},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"ABF13CGNA0","algoliaIndex":"ginshio_blog","algoliaSearchKey":"51cf3425aba132c091b477c3d5e06eea","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"sharerjs":true,"table":{"sort":true}};</script><script type="text/javascript" src="/lib/gitalk/gitalk.min.1420a0c0459673bc6824e7ba713f1e0ec1540e86491daf1b6149a7af9cd3f396c86b9182d03e4c727faefae17b746033.js" integrity="sha384-FCCgwEWWc7xoJOe6cT8eDsFUDoZJHa8bYUmnr5zT85bIa5GC0D5Mcn&#43;u&#43;uF7dGAz"></script><script type="text/javascript" src="/js/gitalk.min.js" defer></script><script type="text/javascript" src="/lib/tablesort/tablesort.min.d120034e53740430f5243f8e25b646e7bdcca97780e02962c37e3adefb264c1b457f8fc397698851f42e32d7168bdd1e.js" integrity="sha384-0SADTlN0BDD1JD&#43;OJbZG573MqXeA4Cliw3463vsmTBtFf4/Dl2mIUfQuMtcWi90e"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.094758c1816ef1698123c876e7b739ac27751905f428bfb349857a93244d636b615bb42a43298a19f4c2235587c33bf2.js" integrity="sha384-CUdYwYFu8WmBI8h257c5rCd1GQX0KL&#43;zSYV6kyRNY2thW7QqQymKGfTCI1WHwzvy"></script><script type="text/javascript" src="/lib/sharer/sharer.min.0097b33812ac4873e9a2e0813de400c9ea9b07e223998d3cbc38a89bdfa3f45cc344689061a836fcd6f4c120eed429b4.js" integrity="sha384-AJezOBKsSHPpouCBPeQAyeqbB&#43;IjmY08vDiom9&#43;j9FzDRGiQYag2/Nb0wSDu1Cm0"></script><script type="text/javascript" src="/lib/katex/katex.min.3f04544ff62a6e71239193b4cd9c4da9cc400ab5defa3efae94d9a997720320e78e7baef7b663b23a6494a6d80d264b8.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe&#43;j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.f95071777afa5e0511c9caad675d7b9d8c38e0e39c21ac79e99e1d09159bc723edd0aa1a875b87a0ad28e3efd1444d39.js" integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.c30ff9f376878715a4cf90c4567e8e2ad36221a2e2da20513595df251898d408bbb6727d517a44b32bce2135694e5e00.js" integrity="sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.453374f1ad005c88a83c1715a2c12a3d47ca2beacfa7e875c7f8b347bc4c91d332bb091c64259dc4ef914b0205b495cd.js" integrity="sha384-RTN08a0AXIioPBcVosEqPUfKK&#43;rPp&#43;h1x/izR7xMkdMyuwkcZCWdxO&#43;RSwIFtJXN" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-J5NHMZLLDX', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-J5NHMZLLDX" async></script><script>
			var _hmt = _hmt || [];
			(function() {
			  var hm = document.createElement("script");
			  hm.src = "https://hm.baidu.com/hm.js?9370523af547bac6b97e9c3b1461cd16";
			  var s = document.getElementsByTagName("script")[0]; 
			  s.parentNode.insertBefore(hm, s);
			})();
		</script></div>
</body>

</html>